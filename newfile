<?php
session_start();

/*
Î‘Î Î‘Î™Î¤ÎŸÎ¥ÎœÎ•ÎÎ‘ Î Î•Î”Î™Î‘ Î“Î™Î‘ Î¤Î— Î’Î‘Î£Î— Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î:

Î Î¯Î½Î±ÎºÎ±Ï‚: users
- ÎœÎ—Î¤Î¡Î©ÎŸ (VARCHAR)
- ÎŸÎÎŸÎœÎ‘ (VARCHAR)
- Î•Î Î©ÎÎ¥ÎœÎŸ (VARCHAR)
- PIN (VARCHAR)
- ADMINISTRATOR (INT) - 1 Î³Î¹Î± admin, 0 Î³Î¹Î± Î±Ï€Î»ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·
- Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£ (INT) - 1 Î³Î¹Î± Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿, 0 Î³Î¹Î± Î±Ï€Î»ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·
- GDYE (INT) - 1 Î³Î¹Î± Î“Î”Î¥Î• Î³ÏÎ±Ï†ÎµÎ¯Î¿, 0 Î³Î¹Î± Î±Ï€Î»ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·

Î Î¯Î½Î±ÎºÎ±Ï‚: requests
- id (AUTO_INCREMENT)
- mitroo (VARCHAR)
- typos (VARCHAR)
- imerominia (DATE)
- wres (INT)
- meres (INT)
- logos (TEXT)
- topos_dianysis (VARCHAR)
- proistamenos_egkrisi (VARCHAR)
- status (VARCHAR) - Î”Ï…Î½Î±Ï„Î­Ï‚ Ï„Î¹Î¼Î­Ï‚: Î•ÎšÎšÎ¡Î•ÎœÎ•Î™, Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•, Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—, Î‘Î ÎŸÎ¡Î¡Î™Î¦Î˜Î—ÎšÎ•, Î£Î¥ÎÎ•ÎÎÎŸÎ—Î£Î—
- submitted_at (DATETIME)
- modification_reason (TEXT)
- consultation_message (TEXT)
- rejection_reason (TEXT)

Î Î¯Î½Î±ÎºÎ±Ï‚: adeies_ypoloipa
- ÎœÎ—Î¤Î¡Î©ÎŸ (VARCHAR)
- ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ (VARCHAR)
- YPOTLIPO_HMERES (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£ (INT)
- Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£ (INT)
- Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î (INT)
- PREVIOUS_YEAR_KANONIKI (INT) - Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚
- PREVIOUS_YEAR_VRAHEIA (INT) - Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚
- Î•Î¤ÎŸÎ£ (INT)
- TELEUTAIA_ENIMEROSI (DATE)

Î Î¯Î½Î±ÎºÎ±Ï‚: system_settings
- setting_name (VARCHAR)
- setting_value (VARCHAR)
- updated_by (VARCHAR)
- updated_at (DATETIME)

Î”Î™ÎšÎ‘Î™Î©ÎœÎ‘Î¤Î‘ Î§Î¡Î—Î£Î¤Î©Î:
- ADMINISTRATOR = 1: Î Î»Î®ÏÎ· Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± (Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½, ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚, Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·/Î±Ï†Î±Î¯ÏÎµÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½, backup/restore)
- Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£ = 1: ÎˆÎ³ÎºÏÎ¹ÏƒÎ·/Î±Ï€ÏŒÏÏÎ¹ÏˆÎ· Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½, ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚, Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (ÎÎ•ÎŸ)
- GDYE = 1: Î ÏÎ¿Î²Î¿Î»Î® ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î±Î´ÎµÎ¹ÏÎ½ Î³Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·

Î•Î¤Î—Î£Î™Î‘ Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘:
- ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®: 30 Î·Î¼Î­ÏÎµÏ‚ + 4 Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚
- Î’ÏÎ±Ï‡ÎµÎ¯Î±: 7 Î·Î¼Î­ÏÎµÏ‚ + 4 Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚
- ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î¼ÏŒÎ½Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚
*/

// Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "fragarian_db";

// Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
try {
    $pdo = new PDO("mysql:host=$servername;dbname=$dbname;charset=utf8mb4", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch(PDOException $e) {
    die("Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚: " . $e->getMessage());
}

// Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¯Ï‡Î¹ÏƒÎ· Ï„ÏÏ€Ï‰Î½ Î±Î´ÎµÎ¹ÏÎ½ Î¼Îµ Ï€ÎµÎ´Î¯Î± Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
$leave_types_mapping = [
    'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£',
    'Î’Î¡Î‘Î§Î•Î™Î‘' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£',
    'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—_Î ÎŸÎ¡Î•Î™Î‘' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£',
    'Î’Î¡Î‘Î§Î•Î™Î‘_Î ÎŸÎ¡Î•Î™Î‘' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£',
    'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£',
    'Î£Î§ÎŸÎ›Î™ÎšÎ—_Î•Î Î™Î”ÎŸÎ£Î—' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£',
    'Î‘ÎÎ‘Î¡Î¡Î©Î¤Î™ÎšÎ—' => 'special_handling',
    'Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎ—' => 'special_handling',
    'ÎœÎ‘ÎšÎ¡Î‘Î£_Î”Î™Î‘Î¡ÎšÎ•Î™Î‘Î£' => 'special_handling',
    'Î£Î§ÎŸÎ›Î™ÎšÎ—_Î”ÎŸÎšÎ™ÎœÎ©Î' => 'special_handling',
    'Î•ÎÎ•Î¤Î‘Î£Î•Î©Î' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î',
    'ÎœÎ—Î¤Î¡ÎŸÎ¤Î—Î¤Î‘Î£' => 'special_handling',
    'Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£' => 'special_handling',
    'Î™Î‘Î¤Î¡Î™ÎšÎ—_Î‘ÎÎ‘Î Î‘Î¡Î‘Î“Î©Î“Î—' => 'special_handling',
    'Î“Î‘ÎœÎŸÎ£' => 'fixed_days',
    'Î Î•ÎÎ˜ÎŸÎ£' => 'fixed_days',
    'ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£',
    'Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î' => 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î',
    'Î•Î Î™Î Î¡ÎŸÎ£Î˜Î•Î¤Î—_Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£' => 'special_handling'
];

// Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î»Î®ÏˆÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
function getSystemSetting($pdo, $setting_name, $default = null) {
    try {
        $stmt = $pdo->prepare("SELECT setting_value FROM system_settings WHERE setting_name = ?");
        $stmt->execute([$setting_name]);
        $result = $stmt->fetchColumn();
        return $result !== false ? $result : $default;
    } catch(Exception $e) {
        return $default;
    }
}

// Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
function updateSystemSetting($pdo, $setting_name, $value, $updated_by) {
    try {
        $stmt = $pdo->prepare("INSERT INTO system_settings (setting_name, setting_value, updated_by, updated_at) VALUES (?, ?, ?, NOW()) ON DUPLICATE KEY UPDATE setting_value = ?, updated_by = ?, updated_at = NOW()");
        return $stmt->execute([$setting_name, $value, $updated_by, $value, $updated_by]);
    } catch(Exception $e) {
        return false;
    }
}

// Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿Ï‚ authentication
function checkAuth() {
    if (!isset($_SESSION['user_mitroo'])) {
        header("Location: " . $_SERVER['PHP_SELF'] . "?page=login");
        exit();
    }
}

// Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½
function isAdmin($pdo, $mitroo) {
    $stmt = $pdo->prepare("SELECT ADMINISTRATOR FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
    $stmt->execute([$mitroo]);
    $result = $stmt->fetchColumn();
    return $result == 1;
}

function isManager($pdo, $mitroo) {
    $stmt = $pdo->prepare("SELECT Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£ FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
    $stmt->execute([$mitroo]);
    $result = $stmt->fetchColumn();
    return $result == 1;
}

// Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î¯Ï€Î¿Ï… Î¬Î´ÎµÎ¹Î±Ï‚ (ÎÎ•Î•Î£ Î¤Î™ÎœÎ•Î£)
function checkLeaveBalance($pdo, $mitroo, $leave_type, $days_requested, $travel_days = 0, $hours_requested = 0) {
    global $leave_types_mapping;
    
    $current_year = date('Y');
    $current_month = date('n');
    
    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ³Î³ÏÎ±Ï†Î® Î³Î¹Î± Ï„Î¿Î½ Ï…Ï€Î¬Î»Î»Î·Î»Î¿
    $stmt = $pdo->prepare("SELECT * FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND (Î•Î¤ÎŸÎ£ = ? OR Î•Î¤ÎŸÎ£ IS NULL) LIMIT 1");
    $stmt->execute([$mitroo, $current_year]);
    $balance_data = $stmt->fetch();
    
    if (!$balance_data) {
        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î±Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î¼Îµ Ï„Î± Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ‘ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±
        $stmt = $pdo->prepare("SELECT ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
        $stmt->execute([$mitroo]);
        $user = $stmt->fetch();
        
        if ($user) {
            $full_name = $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'];
            $stmt = $pdo->prepare("INSERT INTO adeies_ypoloipa (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ, YPOTLIPO_HMERES, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î, PREVIOUS_YEAR_KANONIKI, PREVIOUS_YEAR_VRAHEIA, Î•Î¤ÎŸÎ£, TELEUTAIA_ENIMEROSI) VALUES (?, ?, 30, 30, 7, 4, 4, 9, ?, 8, 14, 22, 10, 0, 0, ?, CURDATE())");
            $stmt->execute([$mitroo, $full_name, $current_month, $current_year]);
            
            $balance_data = [
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£' => 30,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£' => 7,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£' => 4,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£' => 4,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£' => 9,
                'Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£' => $current_month,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£' => 8,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î' => 14,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£' => 22,
                'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î' => 10,
                'PREVIOUS_YEAR_KANONIKI' => 0,
                'PREVIOUS_YEAR_VRAHEIA' => 0
            ];
        } else {
            return ['status' => false, 'message' => 'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï…Ï€Î¬Î»Î»Î·Î»Î¿Ï‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î·Ï„ÏÏÎ¿'];
        }
    }
    
    // Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎŸÎ£ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î²Î¬ÏƒÎµÎ¹ Ï„ÏÏ€Î¿Ï… Î¬Î´ÎµÎ¹Î±Ï‚
    if ($leave_type == 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—') {
        $current_balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'];
        $previous_balance = $balance_data['PREVIOUS_YEAR_KANONIKI'] ?? 0;
        $travel_balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'];
        
        $total_available = $current_balance + $previous_balance;
        
        if ($total_available >= $days_requested && $travel_balance >= $travel_days) {
            return ['status' => true, 'current_balance' => $current_balance, 'previous_balance' => $previous_balance, 'travel_balance' => $travel_balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $current_balance Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Î­Ï„Î¿Ï…Ï‚ + $previous_balance Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… = $total_available ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬, Î Î¿ÏÎµÎ¯Î±: $travel_balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif ($leave_type == 'Î’Î¡Î‘Î§Î•Î™Î‘') {
        $current_balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'];
        $previous_balance = $balance_data['PREVIOUS_YEAR_VRAHEIA'] ?? 0;
        $travel_balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£'];
        
        $total_available = $current_balance + $previous_balance;
        
        if ($days_requested < 1) {
            return ['status' => false, 'message' => 'Î— Î²ÏÎ±Ï‡ÎµÎ¯Î± Î¬Î´ÎµÎ¹Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 1 Î·Î¼Î­ÏÎ±'];
        }
        
        if ($total_available >= $days_requested && $travel_balance >= $travel_days) {
            return ['status' => true, 'current_balance' => $current_balance, 'previous_balance' => $previous_balance, 'travel_balance' => $travel_balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $current_balance Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Î­Ï„Î¿Ï…Ï‚ + $previous_balance Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… = $total_available ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬, Î Î¿ÏÎµÎ¯Î±: $travel_balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif ($leave_type == 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—') {
        $last_month = $balance_data['Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£'];
        if ($last_month != $current_month) {
            $stmt = $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£ = 9, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£ = ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND Î•Î¤ÎŸÎ£ = ?");
            $stmt->execute([$current_month, $mitroo, $current_year]);
            $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'] = 9;
        }
        
        $hours_balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'];
        
        if ($hours_balance >= $hours_requested) {
            return ['status' => true, 'current_balance' => $hours_balance . ' ÏÏÎµÏ‚ (Î¼Î®Î½Î±Ï‚ ' . date('m/Y') . ')'];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $hours_balance ÏÏÎµÏ‚ Î³Î¹Î± Ï„Î¿Î½ Î¼Î®Î½Î± " . date('m/Y')];
        }
        
    } elseif ($leave_type == 'Î£Î§ÎŸÎ›Î™ÎšÎ—_Î•Î Î™Î”ÎŸÎ£Î—') {
        $balance = $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£'];
        
        if ($balance >= $days_requested) {
            return ['status' => true, 'current_balance' => $balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÏƒÏ‡Î¿Î»Î¹ÎºÎ®Ï‚ ÎµÏ€Î¯Î´Î¿ÏƒÎ·Ï‚. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif ($leave_type == 'Î•ÎÎ•Î¤Î‘Î£Î•Î©Î') {
        $balance = isset($balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î']) ? $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î'] : 14;
        
        if ($balance >= $days_requested) {
            return ['status' => true, 'current_balance' => $balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎµÎ¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif ($leave_type == 'ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘') {
        $balance = isset($balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£']) ? $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£'] : 22;
        
        if ($balance >= $days_requested) {
            return ['status' => true, 'current_balance' => $balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î½Î¿ÏƒÎ·Î»ÎµÎ¯Î±Ï‚. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif ($leave_type == 'Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î') {
        $balance = isset($balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î']) ? $balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î'] : 10;
        
        if ($balance >= $days_requested) {
            return ['status' => true, 'current_balance' => $balance];
        } else {
            return ['status' => false, 'message' => "Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ Î±ÏƒÎ¸Î­Î½ÎµÎ¹Î±Ï‚ Ï„Î­ÎºÎ½Ï‰Î½. Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚: $balance Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif (in_array($leave_type, ['Î“Î‘ÎœÎŸÎ£', 'Î Î•ÎÎ˜ÎŸÎ£'])) {
        if ($days_requested == 5) {
            return ['status' => true, 'current_balance' => '5 Î·Î¼Î­ÏÎµÏ‚ (ÏƒÏ„Î±Î¸ÎµÏÎ® Î¬Î´ÎµÎ¹Î±)'];
        } else {
            return ['status' => false, 'message' => "Î— Î¬Î´ÎµÎ¹Î± $leave_type ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î±Î¸ÎµÏÎ¬ 5 Î·Î¼Î­ÏÎµÏ‚"];
        }
        
    } elseif (in_array($leave_type, ['Î‘ÎÎ‘Î¡Î¡Î©Î¤Î™ÎšÎ—', 'Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎ—', 'ÎœÎ‘ÎšÎ¡Î‘Î£_Î”Î™Î‘Î¡ÎšÎ•Î™Î‘Î£', 'Î£Î§ÎŸÎ›Î™ÎšÎ—_Î”ÎŸÎšÎ™ÎœÎ©Î', 'ÎœÎ—Î¤Î¡ÎŸÎ¤Î—Î¤Î‘Î£', 'Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£', 'Î™Î‘Î¤Î¡Î™ÎšÎ—_Î‘ÎÎ‘Î Î‘Î¡Î‘Î“Î©Î“Î—', 'Î•Î Î™Î Î¡ÎŸÎ£Î˜Î•Î¤Î—_Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£'])) {
        return ['status' => true, 'current_balance' => 'Î•Î¹Î´Î¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚ - Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î­Î³ÎºÏÎ¹ÏƒÎ· Î±Ï€ÏŒ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿'];
        
    } else {
        return ['status' => false, 'message' => 'ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿Ï‚ Ï„ÏÏ€Î¿Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚'];
    }
}

// ÎÎ•Î‘ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Database Backup
function createDatabaseBackup($pdo) {
    try {
        $tables = ['users', 'requests', 'adeies_ypoloipa', 'system_settings'];
        $backup_content = "-- Database Backup Created: " . date('Y-m-d H:i:s') . "\n";
        $backup_content .= "-- Leave Management System v3.1\n\n";
        
        foreach ($tables as $table) {
            $backup_content .= "-- Table: $table\n";
            $backup_content .= "DROP TABLE IF EXISTS `$table`;\n";
            
            // Get table structure
            $result = $pdo->query("SHOW CREATE TABLE `$table`");
            $row = $result->fetch();
            $backup_content .= $row[1] . ";\n\n";
            
            // Get table data
            $result = $pdo->query("SELECT * FROM `$table`");
            $rows = $result->fetchAll();
            
            if (!empty($rows)) {
                $columns = array_keys($rows[0]);
                $backup_content .= "INSERT INTO `$table` (`" . implode('`, `', $columns) . "`) VALUES\n";
                
                $values = [];
                foreach ($rows as $row) {
                    $escaped_values = array_map(function($value) use ($pdo) {
                        return $value === null ? 'NULL' : $pdo->quote($value);
                    }, array_values($row));
                    $values[] = "(" . implode(', ', $escaped_values) . ")";
                }
                
                $backup_content .= implode(",\n", $values) . ";\n\n";
            }
        }
        
        $filename = 'backup_' . date('Y-m-d_H-i-s') . '.sql';
        $filepath = __DIR__ . '/backups/' . $filename;
        
        // Create backups directory if it doesn't exist
        if (!file_exists(__DIR__ . '/backups/')) {
            mkdir(__DIR__ . '/backups/', 0755, true);
        }
        
        if (file_put_contents($filepath, $backup_content)) {
            return ['success' => true, 'filename' => $filename, 'filepath' => $filepath];
        } else {
            return ['success' => false, 'message' => 'Î‘Î´Ï…Î½Î±Î¼Î¯Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… backup'];
        }
        
    } catch (Exception $e) {
        return ['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î±: ' . $e->getMessage()];
    }
}

// ÎÎ•Î‘ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Database Restore
function restoreDatabase($pdo, $backup_file) {
    try {
        if (!file_exists($backup_file)) {
            return ['success' => false, 'message' => 'Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ backup Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ'];
        }
        
        $sql_content = file_get_contents($backup_file);
        if ($sql_content === false) {
            return ['success' => false, 'message' => 'Î‘Î´Ï…Î½Î±Î¼Î¯Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï… backup'];
        }
        
        // Split SQL into individual statements
        $statements = array_filter(array_map('trim', explode(';', $sql_content)));
        
        $pdo->beginTransaction();
        
        foreach ($statements as $statement) {
            if (!empty($statement) && !str_starts_with($statement, '--')) {
                $pdo->exec($statement);
            }
        }
        
        $pdo->commit();
        return ['success' => true, 'message' => 'Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½'];
        
    } catch (Exception $e) {
        $pdo->rollback();
        return ['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚: ' . $e->getMessage()];
    }
}
// ÎÎ•Î‘ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® email
function sendManagerEmail($pdo, $request_id) {
    try {
        // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î·Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚
        $stmt = $pdo->prepare("
            SELECT r.*, u1.ÎŸÎÎŸÎœÎ‘ as EMPLOYEE_NAME, u1.Î•Î Î©ÎÎ¥ÎœÎŸ as EMPLOYEE_SURNAME, 
                   u2.EMAIL as MANAGER_EMAIL, u2.ÎŸÎÎŸÎœÎ‘ as MANAGER_NAME, u2.Î•Î Î©ÎÎ¥ÎœÎŸ as MANAGER_SURNAME
            FROM requests r 
            JOIN users u1 ON r.mitroo = u1.ÎœÎ—Î¤Î¡Î©ÎŸ 
            JOIN users u2 ON r.selected_manager_mitroo = u2.ÎœÎ—Î¤Î¡Î©ÎŸ 
            WHERE r.id = ?
        ");
        $stmt->execute([$request_id]);
        $data = $stmt->fetch();
        
        if (!$data || !$data['MANAGER_EMAIL']) {
            return false;
        }
        
        // Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± email
        $to = $data['MANAGER_EMAIL'];
        $subject = "Î‘Î¯Ï„Î·ÏƒÎ· Î†Î´ÎµÎ¹Î±Ï‚ - " . $data['EMPLOYEE_NAME'] . " " . $data['EMPLOYEE_SURNAME'] . " (ID: " . $request_id . ")";
        
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Ï‰ÏÏÎ½/Î·Î¼ÎµÏÏÎ½
        $hours_text = $data['typos'] == 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' ? $data['wres'] . " ÏÏÎµÏ‚" : $data['meres'] . " Î·Î¼Î­ÏÎµÏ‚";
        
        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚
        $message = "Î‘Î³Î±Ï€Î·Ï„Î­/Î® " . $data['MANAGER_NAME'] . " " . $data['MANAGER_SURNAME'] . ",\n\n";
        $message .= "ÎŸ/Î— " . $data['mitroo'] . " " . $data['EMPLOYEE_NAME'] . " " . $data['EMPLOYEE_SURNAME'];
        $message .= " Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ " . $hours_text . " " . strtolower($data['typos']) . " Î¬Î´ÎµÎ¹Î±Ï‚.\n\n";
        $message .= "Î£Î¤ÎŸÎ™Î§Î•Î™Î‘ Î‘Î™Î¤Î—Î£Î—Î£:\n";
        $message .= "================\n";
        $message .= "Î‘Ï. Î‘Î¯Ï„Î·ÏƒÎ·Ï‚: " . $request_id . "\n";
        $message .= "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î­Î½Î±ÏÎ¾Î·Ï‚: " . date('d/m/Y', strtotime($data['imerominia'])) . "\n";
        $message .= "Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: " . $data['logos'] . "\n";
        $message .= "Î¤ÏŒÏ€Î¿Ï‚ Î´Î¹Î¬Î½Ï…ÏƒÎ·Ï‚: " . $data['topos_dianysis'] . "\n";
        $message .= "Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ Î­Î³ÎºÏÎ¹ÏƒÎ·: " . $data['proistamenos_egkrisi'] . "\n\n";
        
        $message .= "ğŸ”— Î“Î¹Î± Î½Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ·, Ï€Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿:\n";
        $message .= "http://localhost/Intranet_wp/wp-content/themes/twentynineteen-fragarian/manager-popup.php\n\n";
        
        $message .= "ÎŸÎ”Î—Î“Î™Î•Î£ Î‘Î Î‘ÎÎ¤Î—Î£Î—Î£:\n";
        $message .= "==================\n";
        $message .= "â€¢ Î“Î¹Î± Î•Î“ÎšÎ¡Î™Î£Î— Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ link\n";
        $message .= "â€¢ Î‰ Î±Ï€Î±Î½Ï„Î®ÏƒÏ„Îµ Î¼Îµ email: Î•Î“ÎšÎ¡Î™ÎÎ•Î¤Î‘Î™\n";
        $message .= "â€¢ Î“Î¹Î± Î‘Î ÎŸÎ¡Î¡Î™Î¨Î—: Î‘Î ÎŸÎ¡Î¡Î™Î Î¤Î•Î¤Î‘Î™ [Î»ÏŒÎ³Î¿Ï‚]\n\n";
        
        $message .= "---\n";
        $message .= "Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½\n";
        $message .= "Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¯Î± Î•Î»Î»Î¬Î´Î¿Ï‚ v3.1\n";
        $message .= "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: " . date('d/m/Y H:i');
        
        // Headers
        $headers = array(
            'From' => 'tdnagiounikolaou@astynomia.gr',
            'Reply-To' => 'tdnagiounikolaou@astynomia.gr',
            'MIME-Version' => '1.0',
            'Content-Type' => 'text/plain; charset=UTF-8'
        );
        
        $headers_string = '';
        foreach ($headers as $key => $value) {
            $headers_string .= $key . ': ' . $value . "\r\n";
        }
        
        $encoded_subject = '=?UTF-8?B?' . base64_encode($subject) . '?=';
        
        if (mail($to, $encoded_subject, $message, $headers_string)) {
            $update_stmt = $pdo->prepare("UPDATE requests SET email_sent = 1 WHERE id = ?");
            $update_stmt->execute([$request_id]);
            return true;
        }
        
        return false;
        
    } catch (Exception $e) {
        error_log("Email sending error: " . $e->getMessage());
        return false;
    }
}

/**
 * BONUS: Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Ï„ÎµÏƒÏ„ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚ email
 * Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ Ï„Ï‰Î½ SMTP ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½
 */
function testEmailSending($test_email = 'tdnagiounikolaou@astynomia.gr') {
    $subject = 'Test Email - Î£ÏÏƒÏ„Î·Î¼Î± Î‘Î´ÎµÎ¹ÏÎ½';
    $message = "Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± test email.\n\nÎ‘Î½ Ï„Î¿ Î»Î¬Î²Î±Ï„Îµ, Î¿Î¹ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ email Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ ÏƒÏ‰ÏƒÏ„Î¬!\n\nÎ§ÏÏŒÎ½Î¿Ï‚: " . date('d/m/Y H:i:s');
    
    $headers = array(
        'From' => 'tdnagiounikolaou@astynomia.gr',
        'MIME-Version' => '1.0',
        'Content-Type' => 'text/plain; charset=UTF-8'
    );
    
    $headers_string = '';
    foreach ($headers as $key => $value) {
        $headers_string .= $key . ': ' . $value . "\r\n";
    }
    
    $encoded_subject = '=?UTF-8?B?' . base64_encode($subject) . '?=';
    
    return mail($test_email, $encoded_subject, $message, $headers_string);
}
// Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î²Î±Î¸Î¼ÏŒÏ‚ ÏƒÏ„Î¿ adeies_ypoloipa, Î»Î¬Î²Îµ Ï„Î¿Î½ Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± users
if (empty($balance_data['Î²Î±Î¸Î¼Î¿Ï‚'])) {
    $stmtBathmos = $pdo->prepare("SELECT Î’Î‘Î˜ÎœÎŸÎ£ FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
	if (!isset($mitroo)) {
    $mitroo = $_SESSION['user_mitroo'] ?? '';
}
    $stmtBathmos->execute([$mitroo]);
    $userBathmos = $stmtBathmos->fetchColumn();
    
 if ($userBathmos) {
        // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± adeies_ypoloipa Î¼Îµ Ï„Î¿Î½ Î²Î±Î¸Î¼ÏŒ
        $updateBathmos = $pdo->prepare("UPDATE adeies_ypoloipa SET Î²Î±Î¸Î¼Î¿Ï‚ = ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
        $updateBathmos->execute([$userBathmos, $mitroo]);
        
        // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎµ ÎºÎ±Î¹ Ï„Î¿ Ï„Î¿Ï€Î¹ÎºÏŒ Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ (Î¼Îµ Î­Î»ÎµÎ³Ï‡Î¿)
        if (isset($balance_data) && is_array($balance_data)) {
            $balance_data['Î²Î±Î¸Î¼Î¿Ï‚'] = $userBathmos;
        }
    }
}
// Login process
if (isset($_POST['login'])) {
    $mitroo = $_POST['mitroo'];
    $pin = $_POST['pin'];
    
    $stmt = $pdo->prepare("SELECT ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ, ADMINISTRATOR, Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£, GDYE FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND PIN = ?");
    $stmt->execute([$mitroo, $pin]);
    $user = $stmt->fetch();
    
    if ($user) {
        $_SESSION['user_mitroo'] = $user['ÎœÎ—Î¤Î¡Î©ÎŸ'];
        $_SESSION['user_name'] = $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'];
        $_SESSION['is_admin'] = $user['ADMINISTRATOR'];
        $_SESSION['is_manager'] = $user['Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£'];
        $_SESSION['is_gdye'] = $user['GDYE'] ?? 0;
        
        setcookie('last_mitroo', $mitroo, time() + (30 * 24 * 60 * 60), '/');
        
        header("Location: " . $_SERVER['PHP_SELF']);
        exit();
    } else {
        $login_error = "Î›Î±Î½Î¸Î±ÏƒÎ¼Î­Î½Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚";
    }
}

// Logout
if (isset($_GET['logout'])) {
    session_destroy();
    header("Location: " . $_SERVER['PHP_SELF'] . "?page=login");
    exit();
}

// Check if user wants to see login page
$current_page = $_GET['page'] ?? 'main';

if ($current_page == 'login' || !isset($_SESSION['user_mitroo'])) {
    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ login
    ?>
    <!DOCTYPE html>
    <html lang="el">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Î£ÏÎ½Î´ÎµÏƒÎ· - Î£ÏÏƒÏ„Î·Î¼Î± Î‘Î´ÎµÎ¹ÏÎ½ v3.1</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh; display: flex; align-items: center; justify-content: center;
            }
            .login-container {
                background: white; padding: 40px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
                width: 100%; max-width: 400px;
            }
            .login-header { text-align: center; margin-bottom: 30px; }
            .login-header h1 { color: #333; margin-bottom: 10px; }
            .form-group { margin-bottom: 20px; }
            .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
            .form-group input {
                width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: border-color 0.3s;
            }
            .form-group input:focus { outline: none; border-color: #667eea; }
            .btn {
                width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
                padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s;
            }
            .btn:hover { transform: translateY(-2px); }
            .alert-error {
                background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #f5c6cb;
            }
            .home-link {
                display: inline-block; margin-bottom: 20px; color: #667eea; text-decoration: none; font-weight: 600;
                transition: color 0.3s;
            }
            .home-link:hover { color: #5a6fd8; }
        </style>
    </head>
    <body>
        <div class="login-container">
            <a href="../" class="home-link">ğŸ  Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î‘ÏÏ‡Î¹ÎºÎ®</a>
            
            <div class="login-header">
                <h1>Î£ÏÏƒÏ„Î·Î¼Î± Î‘Î´ÎµÎ¹ÏÎ½ & Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½</h1>
                <p>Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÎ±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·</p>
            </div>
            
            <?php if (isset($login_error)): ?>
                <div class="alert-error"><?php echo $login_error; ?></div>
            <?php endif; ?>
            
            <form method="POST">
                <div class="form-group">
                    <label for="mitroo">ÎœÎ·Ï„ÏÏÎ¿:</label>
                    <input type="text" id="mitroo" name="mitroo" value="<?php echo isset($_COOKIE['last_mitroo']) ? htmlspecialchars($_COOKIE['last_mitroo']) : ''; ?>" required>
                </div>
                <div class="form-group">
                    <label for="pin">PIN:</label>
                    <input type="password" id="pin" name="pin" required>
                </div>
                <button type="submit" name="login" class="btn">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
            </form>
        </div>
        
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            var mitrooField = document.getElementById('mitroo');
            var pinField = document.getElementById('pin');
            
            if (mitrooField.value.trim() !== '') {
                pinField.focus();
            } else {
                mitrooField.focus();
            }
        });
        </script>
    </body>
    </html>
    <?php
    exit();
}

// Main application - ÎµÎ´Ï ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÎ¹ Î¼ÏŒÎ½Î¿ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚
checkAuth();

// AJAX endpoints
if (isset($_POST['ajax_action'])) {
    header('Content-Type: application/json');
    
    if ($_POST['ajax_action'] == 'update_balance' && ($_SESSION['is_admin'] || $_SESSION['is_manager'])) { // Î‘Î›Î›Î‘Î“Î—: ÎºÎ±Î¹ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Î¹
        $mitroo = $_POST['mitroo'];
        $field = $_POST['field'];
        $value = (float)$_POST['value'];
        
        $allowed_fields = ['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£', 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î', 'PREVIOUS_YEAR_KANONIKI', 'PREVIOUS_YEAR_VRAHEIA'];
        
        if (in_array($field, $allowed_fields)) {
            try {
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ³Î³ÏÎ±Ï†Î® Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·
                $stmt = $pdo->prepare("SELECT COUNT(*) FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND Î•Î¤ÎŸÎ£ = ?");
                $stmt->execute([$mitroo, date('Y')]);
                $exists = $stmt->fetchColumn() > 0;
                
                if (!$exists) {
                    // Î›Î®ÏˆÎ· Ï€Î»Î®ÏÎ¿Ï…Ï‚ Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚
                    $stmt = $pdo->prepare("SELECT ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
                    $stmt->execute([$mitroo]);
                    $user = $stmt->fetch();
                    $full_name = $user ? $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'] : $mitroo;
                    
                    // Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ•Î£ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚
                    $current_month = date('n');
                    $stmt = $pdo->prepare("INSERT INTO adeies_ypoloipa (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ, YPOTLIPO_HMERES, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î, PREVIOUS_YEAR_KANONIKI, PREVIOUS_YEAR_VRAHEIA, Î•Î¤ÎŸÎ£, TELEUTAIA_ENIMEROSI) VALUES (?, ?, 30, 30, 7, 4, 4, 9, ?, 8, 14, 22, 10, 0, 0, ?, CURDATE())");
                    $stmt->execute([$mitroo, $full_name, $current_month, date('Y')]);
                }
                
                // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï…
                $stmt = $pdo->prepare("UPDATE adeies_ypoloipa SET $field = ?, TELEUTAIA_ENIMEROSI = CURDATE() WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND Î•Î¤ÎŸÎ£ = ?");
                if ($stmt->execute([$value, $mitroo, date('Y')])) {
                    echo json_encode(['success' => true]);
                } else {
                    echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·Ï‚']);
                }
            } catch(Exception $e) {
                echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î± Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½: ' . $e->getMessage()]);
            }
        } else {
            echo json_encode(['success' => false, 'message' => 'ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Ï€ÎµÎ´Î¯Î¿']);
        }
        exit();
    }
    
    if ($_POST['ajax_action'] == 'update_setting' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $setting_name = $_POST['setting_name'];
        $value = $_POST['value'];
        
        $allowed_settings = ['kanoniki_adeia_expiry', 'vraheia_adeia_expiry', 'current_year'];
        
        if (in_array($setting_name, $allowed_settings)) {
            if (updateSystemSetting($pdo, $setting_name, $value, $_SESSION['user_mitroo'])) {
                echo json_encode(['success' => true]);
            } else {
                echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·Ï‚']);
            }
        } else {
            echo json_encode(['success' => false, 'message' => 'ÎœÎ· Î­Î³ÎºÏ…ÏÎ· ÏÏÎ¸Î¼Î¹ÏƒÎ·']);
        }
        exit();
    }
    
    // ÎÎ•ÎŸ: Database Backup AJAX
    if ($_POST['ajax_action'] == 'create_backup' && $_SESSION['is_admin']) {
        $result = createDatabaseBackup($pdo);
        echo json_encode($result);
        exit();
    }
    
    // ÎÎ•ÎŸ: Database Restore AJAX
    if ($_POST['ajax_action'] == 'restore_backup' && $_SESSION['is_admin'] && isset($_FILES['backup_file'])) {
        $upload_dir = __DIR__ . '/backups/';
        $uploaded_file = $upload_dir . basename($_FILES['backup_file']['name']);
        
        if (move_uploaded_file($_FILES['backup_file']['tmp_name'], $uploaded_file)) {
            $result = restoreDatabase($pdo, $uploaded_file);
            unlink($uploaded_file); // Delete uploaded file after restore
        } else {
            $result = ['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…'];
        }
        
        echo json_encode($result);
        exit();
    }
    
    if ($_POST['ajax_action'] == 'get_user_history' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $mitroo = $_POST['mitroo'];
        
        // Î›Î®ÏˆÎ· ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Ï‡ÏÎ®ÏƒÏ„Î·
        $stmt = $pdo->prepare("SELECT ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
        $stmt->execute([$mitroo]);
        $user = $stmt->fetch();
        
        // Î›Î®ÏˆÎ· Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï Î±Î´ÎµÎ¹ÏÎ½
        $stmt = $pdo->prepare("SELECT * FROM requests WHERE mitroo = ? ORDER BY submitted_at DESC LIMIT 50");
        $stmt->execute([$mitroo]);
        $history = $stmt->fetchAll();
        
        // Î›Î®ÏˆÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î±Î½Î¬ Î­Ï„Î¿Ï‚
        $stmt = $pdo->prepare("SELECT * FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? ORDER BY Î•Î¤ÎŸÎ£ DESC");
        $stmt->execute([$mitroo]);
        $balances = $stmt->fetchAll();
        
        echo json_encode([
            'success' => true,
            'user' => $user,
            'history' => $history,
            'balances' => $balances
        ]);
        exit();
		// ÎÎ•ÎŸ: Smart Delete with Balance Restoration (ÎœÎŸÎÎŸ ADMIN)
    if ($_POST['ajax_action'] == 'delete_test_requests' && $_SESSION['is_admin']) {
        try {
            $pdo->beginTransaction();
            
            // Î ÏÏÏ„Î± Î±Ï€Î¿Î¸Î®ÎºÎµÏ…Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± Î¾Î­ÏÎ¿Ï…Î¼Îµ Ï„Î¹ Î½Î± ÎµÏ€Î±Î½Î±Ï†Î­ÏÎ¿Ï…Î¼Îµ
            $stmt = $pdo->prepare("SELECT mitroo, typos, meres, wres FROM requests WHERE status IN ('Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•', 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—')");
            $stmt->execute();
            $approved_requests = $stmt->fetchAll();
            
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î³Î¹Î± ÎºÎ¬Î¸Îµ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î±Î¯Ï„Î·ÏƒÎ·
            foreach ($approved_requests as $request) {
                $mitroo = $request['mitroo'];
                $typos = $request['typos'];
                $meres = $request['meres'];
                $wres = $request['wres'];
                
                // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î²Î¬ÏƒÎµÎ¹ Ï„ÏÏ€Î¿Ï… Î¬Î´ÎµÎ¹Î±Ï‚
                if ($typos == 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£ = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£ + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                } elseif ($typos == 'Î’Î¡Î‘Î§Î•Î™Î‘') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£ = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£ + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                } elseif ($typos == 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£ = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£ + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$wres, $mitroo]);
                } elseif ($typos == 'ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£ = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£ + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                } elseif ($typos == 'Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                } elseif ($typos == 'Î•ÎÎ•Î¤Î‘Î£Î•Î©Î') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                } elseif ($typos == 'Î£Î§ÎŸÎ›Î™ÎšÎ—_Î•Î Î™Î”ÎŸÎ£Î—') {
                    $pdo->prepare("UPDATE adeies_ypoloipa SET Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£ = Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£ + ? WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$meres, $mitroo]);
                }
            }
            
            // Î¤ÏÏÎ± Î´Î¹Î¬Î³ÏÎ±ÏˆÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚
            $stmt = $pdo->prepare("DELETE FROM requests");
            $stmt->execute();
            $deleted_count = $stmt->rowCount();
            
            $pdo->commit();
            echo json_encode(['success' => true, 'message' => "Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎ±Î½ $deleted_count Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±"]);
        } catch(Exception $e) {
            $pdo->rollback();
            echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î±: ' . $e->getMessage()]);
        }
        exit();
    }
    
    if ($_POST['ajax_action'] == 'reset_test_balances' && $_SESSION['is_admin']) {
        try {
            $pdo->beginTransaction();
            
            // Î”Î¹Î±Î³ÏÎ±Ï†Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
            $stmt = $pdo->prepare("DELETE FROM adeies_ypoloipa ORDER BY sort_order ASC, ÎœÎ—Î¤Î¡Î©ÎŸ ASC");
            $stmt->execute();
            $deleted_count = $stmt->rowCount();
            
            // Î•Ï€Î±Î½Î±Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼Îµ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚ Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚
            $users = $pdo->query("SELECT ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ FROM users")->fetchAll();
            foreach ($users as $user) {
                $current_month = date('n');
                $current_year = date('Y');
                $full_name = $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'];
                
                $stmt = $pdo->prepare("INSERT INTO adeies_ypoloipa (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ, YPOTLIPO_HMERES, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î, PREVIOUS_YEAR_KANONIKI, PREVIOUS_YEAR_VRAHEIA, Î•Î¤ÎŸÎ£, TELEUTAIA_ENIMEROSI) VALUES (?, ?, 30, 30, 7, 4, 4, 9, ?, 8, 14, 22, 10, 0, 0, ?, CURDATE())");
                $stmt->execute([$user['ÎœÎ—Î¤Î¡Î©ÎŸ'], $full_name, $current_month, $current_year]);
            }
            
            $pdo->commit();
            echo json_encode(['success' => true, 'message' => "Î•Ï€Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚"]);
        } catch(Exception $e) {
            $pdo->rollback();
            echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î±: ' . $e->getMessage()]);
        }
        exit();
    }
    
    if ($_POST['ajax_action'] == 'reset_test_balances' && $_SESSION['is_admin']) {
        try {
            $pdo->beginTransaction();
            $stmt = $pdo->prepare("DELETE FROM adeies_ypoloipa ORDER BY sort_order ASC, ÎœÎ—Î¤Î¡Î©ÎŸ ASC");
            $stmt->execute();
            $deleted_count = $stmt->rowCount();
            $pdo->commit();
            echo json_encode(['success' => true, 'message' => "Î•Ï€Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ $deleted_count ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½"]);
        } catch(Exception $e) {
            $pdo->rollback();
            echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î±: ' . $e->getMessage()]);
        }
        exit();
		}
    }
    
    // Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— Î±Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚ Î¼Îµ ÏƒÏ‰ÏƒÏ„Î® Î»Î¿Î³Î¹ÎºÎ® Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚
    if ($_POST['ajax_action'] == 'change_year' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $new_year = (int)$_POST['new_year'];
        $current_year = (int)date('Y');
        
        if ($new_year < $current_year || $new_year > $current_year + 1) {
            echo json_encode(['success' => false, 'message' => 'ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î­Ï„Î¿Ï‚']);
            exit();
        }
        
        try {
            $pdo->beginTransaction();
            
            // Î›Î®ÏˆÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½
            $users = $pdo->query("SELECT ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ FROM users")->fetchAll();
            
            foreach ($users as $user) {
                $mitroo = $user['ÎœÎ—Î¤Î¡Î©ÎŸ'];
                $full_name = $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'];
                
                // Î›Î®ÏˆÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î±Ï€ÏŒ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ Î­Ï„Î¿Ï‚
                $stmt = $pdo->prepare("SELECT Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£ FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND Î•Î¤ÎŸÎ£ = ?");
                $stmt->execute([$mitroo, $current_year]);
                $current_balance = $stmt->fetch();
                
                // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· ÎµÎ³Î³ÏÎ±Ï†Î® Î³Î¹Î± Ï„Î¿ Î½Î­Î¿ Î­Ï„Î¿Ï‚
                $stmt = $pdo->prepare("SELECT COUNT(*) FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? AND Î•Î¤ÎŸÎ£ = ?");
                $stmt->execute([$mitroo, $new_year]);
                
                if ($stmt->fetchColumn() == 0) {
                    // Î¤Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚ (ÎœÎŸÎÎŸ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±)
                    $previous_kanoniki = $current_balance ? $current_balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] : 0;
                    $previous_vraheia = $current_balance ? $current_balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] : 0;
                    
                    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î±Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î³Î¹Î± Ï„Î¿ Î½Î­Î¿ Î­Ï„Î¿Ï‚ Î¼Îµ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ•Î£ Ï„Î¹Î¼Î­Ï‚
                    $stmt = $pdo->prepare("INSERT INTO adeies_ypoloipa (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ, YPOTLIPO_HMERES, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î, PREVIOUS_YEAR_KANONIKI, PREVIOUS_YEAR_VRAHEIA, Î•Î¤ÎŸÎ£, TELEUTAIA_ENIMEROSI) VALUES (?, ?, ?, 30, 7, 4, 4, 9, 1, 8, 14, 22, 10, ?, ?, ?, CURDATE())");
                    
                    // Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ = Î½Î­Î¿ Î­Ï„Î¿Ï‚ + Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚
                    $new_total_kanoniki = 30 + $previous_kanoniki;
                    $new_total_vraheia = 7 + $previous_vraheia;
                    
                    $stmt->execute([
                        $mitroo, $full_name, $new_total_kanoniki, $previous_kanoniki, $previous_vraheia, $new_year
                    ]);
                }
            }
            
            // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Î­Ï„Î¿Ï…Ï‚ ÏƒÏ„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
            updateSystemSetting($pdo, 'current_year', $new_year, $_SESSION['user_mitroo']);
            
            $pdo->commit();
            echo json_encode(['success' => true, 'message' => "Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ Î±Î»Î»Î±Î³Î® ÏƒÏ„Î¿ Î­Ï„Î¿Ï‚ $new_year. ÎœÎµÏ„Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚."]);
            
        } catch(Exception $e) {
            $pdo->rollback();
            echo json_encode(['success' => false, 'message' => 'Î£Ï†Î¬Î»Î¼Î±: ' . $e->getMessage()]);
        }
        exit();
    }
}

// Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï†ÏŒÏÎ¼Ï‰Î½
if ($_POST && !isset($_POST['ajax_action'])) {
    $action = $_POST['action'] ?? '';
    
    if ($action == 'submit_request') {
        $mitroo = $_SESSION['user_mitroo'];
        $typos = $_POST['typos'];
        $imerominia = $_POST['imerominia'];
        $meres = (int)$_POST['meres'];
        $imeres_poreias = (int)($_POST['imeres_poreias'] ?? 0);
        $wres = (int)($_POST['wres'] ?? 0);
		// ÎÏÎ± Î­Î½Î±ÏÎ¾Î·Ï‚/Î»Î®Î¾Î·Ï‚ (Î³Î¹Î± ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—/Ï‰ÏÎ¬ÏÎ¹Î¿)
			$ora_enarxis = isset($_POST['ora_enarxis']) && $_POST['ora_enarxis'] !== '' ? $_POST['ora_enarxis'] : null;
			$ora_lixis   = isset($_POST['ora_lixis'])   && $_POST['ora_lixis']   !== '' ? $_POST['ora_lixis']   : null;
        $logos = $_POST['logos'];
        $topos_dianysis = $_POST['topos_dianysis'] ?? '';
        $proistamenos_egkrisi = $_POST['proistamenos_egkrisi'] ?? '';
        
        if (empty(trim($topos_dianysis))) {
            $error = "Î— Î±Î½Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï… Ï„ÏŒÏ€Î¿Ï… Î´Î¹Î¬Î½Ï…ÏƒÎ·Ï‚ Ï„Î·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚ ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ®.";
        }
        
        if (empty($proistamenos_egkrisi)) {
            $error = "Î— Î­Î³ÎºÏÎ¹ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ Î³ÏÎ±Ï†ÎµÎ¯Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ®.";
        }
        
        if (!isset($error)) {
            if ($typos == 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—') {
                if ($wres <= 0 || $wres > 9) {
                    $error = "Î— Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ· Î¬Î´ÎµÎ¹Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î±Ï€ÏŒ 1 Î­Ï‰Ï‚ 9 ÏÏÎµÏ‚.";
                } else {
                    $balance_check = checkLeaveBalance($pdo, $mitroo, $typos, 0, 0, $wres);
                }
            } else {
                $today = new DateTime();
                $request_date = new DateTime($imerominia);
                
                if ($typos == 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—') {
                    $expiry_date = new DateTime(getSystemSetting($pdo, 'kanoniki_adeia_expiry', '2026-03-31'));
                } elseif ($typos == 'Î’Î¡Î‘Î§Î•Î™Î‘') {
                    $expiry_date = new DateTime(getSystemSetting($pdo, 'vraheia_adeia_expiry', '2025-12-31'));
                } else {
                    $expiry_date = new DateTime('2025-12-31');
                }
                
                if (in_array($typos, ['ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—', 'Î’Î¡Î‘Î§Î•Î™Î‘']) && $request_date > $expiry_date) {
                    $error = "Î— Î¬Î´ÎµÎ¹Î± Ï„ÏÏ€Î¿Ï… '$typos' Î­Ï‡ÎµÎ¹ Î»Î®Î¾ÎµÎ¹. ÎœÎ­Î³Î¹ÏƒÏ„Î· Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: " . $expiry_date->format('d/m/Y');
                } else {
                    $balance_check = checkLeaveBalance($pdo, $mitroo, $typos, $meres, $imeres_poreias, $wres);
                }
            }
        }
        
        if (!isset($error) && isset($balance_check) && $balance_check['status']) {
            $selected_manager = $_POST['selected_manager'] ?? '';
			$stmt = $pdo->prepare("
					INSERT INTO requests
					(mitroo, typos, imerominia, wres, meres, logos, topos_dianysis, proistamenos_egkrisi, selected_manager_mitroo, ora_enarxis, ora_lixis, status, submitted_at)
					VALUES
					(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'Î•ÎšÎšÎ¡Î•ÎœÎ•Î™', NOW())
			");
           
            if ($imeres_poreias > 0) {
                $logos .= " | Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: " . $imeres_poreias;
            }
            if ($typos == 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—') {
                $meres = 0;
            }
            
            if ($stmt->execute([$mitroo,$typos,$imerominia,$wres,$meres,$logos,$topos_dianysis,$proistamenos_egkrisi,$selected_manager,$ora_enarxis,$ora_lixis])) {
    $request_id = $pdo->lastInsertId();
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· JavaScript Î³Î¹Î± Î®Ï‡Î¿ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î®
    $play_sound_after_submit = true;
    
    if (sendManagerEmail($pdo, $request_id)) {
        $success = "Î— Î±Î¯Ï„Î·ÏƒÎ· Ï…Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ ÎºÎ±Î¹ ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ email ÏƒÏ„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿!";
    } else {
        $success = "Î— Î±Î¯Ï„Î·ÏƒÎ· Ï…Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!";
    }
} else {
    $error = "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î® Ï„Î·Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚.";
}
        } elseif (isset($balance_check) && !$balance_check['status']) {
            $error = $balance_check['message'];
        }
    }
    
    // 4 Î•Î Î™Î›ÎŸÎ“Î•Î£ Î“Î™Î‘ Î•ÎšÎšÎ¡Î•ÎœÎ•Î™Î£ Î‘Î™Î¤Î—Î£Î•Î™Î£
    if ($action == 'approve_request' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $request_id = $_POST['request_id'];
        
        $stmt = $pdo->prepare("SELECT mitroo, typos, meres, wres, logos FROM requests WHERE id = ?");
        $stmt->execute([$request_id]);
        $request = $stmt->fetch();
        
        if ($request) {
            $stmt = $pdo->prepare("UPDATE requests SET status = 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•' WHERE id = ?");
            $stmt->execute([$request_id]);
            
            $success = "Î— Î±Î¯Ï„Î·ÏƒÎ· ÎµÎ³ÎºÏÎ¯Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!";
        }
    }
    
    if ($action == 'approve_with_modification' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $request_id = $_POST['request_id'];
        $new_typos = $_POST['new_typos'];
        $new_imerominia = $_POST['new_imerominia'];
        $new_meres = (int)$_POST['new_meres'];
        $new_wres = (int)$_POST['new_wres'];
        $new_logos = $_POST['new_logos'];
        $new_topos = $_POST['new_topos'];
        $new_proistamenos_egkrisi = $_POST['new_proistamenos_egkrisi'];
        $new_imeres_poreias = (int)($_POST['new_imeres_poreias'] ?? 0);
        $modification_reason = $_POST['modification_reason'];
        
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î·Î¼ÎµÏÏÎ½ Ï€Î¿ÏÎµÎ¯Î±Ï‚ ÏƒÏ„Î·Î½ Î±Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î± Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½
        if ($new_imeres_poreias > 0) {
            $new_logos .= " | Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: " . $new_imeres_poreias;
        }
        
        $stmt = $pdo->prepare("UPDATE requests SET typos = ?,imerominia = ?,meres = ?,wres = ?,logos = ?,topos_dianysis = ?,proistamenos_egkrisi = ?,ora_enarxis = ?,ora_lixis = ?,status = 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—',modification_reason = ?WHERE id = ?");       
        if ($stmt->execute([$new_typos, $new_imerominia, $new_meres, $new_wres, $new_logos, $new_topos, $new_proistamenos_egkrisi, $modification_reason, $request_id])) {
            $success = "Î— Î±Î¯Ï„Î·ÏƒÎ· ÎµÎ³ÎºÏÎ¯Î¸Î·ÎºÎµ Î¼Îµ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!";
        } else {
            $error = "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î·Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚.";
        }
    }
    
    if ($action == 'request_consultation' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $request_id = $_POST['request_id'];
        $consultation_message = $_POST['consultation_message'];
        
        $stmt = $pdo->prepare("UPDATE requests SET status = 'Î£Î¥ÎÎ•ÎÎÎŸÎ—Î£Î—', consultation_message = ? WHERE id = ?");
        if ($stmt->execute([
    $new_typos,
    $new_imerominia,
    $new_meres,
    $new_wres,
    $new_logos,
    $new_topos_dianysis,
    $new_proistamenos_egkrisi,
    $_POST['new_ora_enarxis'] ?? null,
    $_POST['new_ora_lixis'] ?? null,
    $modification_reason,
    $request_id
])) {
	$success = "Î‘Î¯Ï„Î·Î¼Î± Î³Î¹Î± ÏƒÏ…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ· ÎµÏƒÏ„Î¬Î»Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!";
        } else {
            $error = "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏ…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ·Ï‚.";
        }
    }
    
    if ($action == 'reject_request' && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
        $request_id = $_POST['request_id'];
        $rejection_reason = $_POST['rejection_reason'] ?? '';
        
        $stmt = $pdo->prepare("UPDATE requests SET status = 'Î‘Î ÎŸÎ¡Î¡Î™Î¦Î˜Î—ÎšÎ•', rejection_reason = ? WHERE id = ?");
        $stmt->execute([$rejection_reason, $request_id]);
        
        $success = "Î— Î±Î¯Ï„Î·ÏƒÎ· Î±Ï€Î¿ÏÏÎ¯Ï†Î¸Î·ÎºÎµ.";
    }
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· (Î¼ÏŒÎ½Î¿ Admin)
    if ($action == 'add_user' && $_SESSION['is_admin']) {
        $new_mitroo = $_POST['new_mitroo'];
        $new_onoma = $_POST['new_onoma'];
        $new_eponimo = $_POST['new_eponimo'];
        $new_pin = $_POST['new_pin'];
        $is_admin = isset($_POST['is_admin']) ? 1 : 0;
        $is_manager = isset($_POST['is_manager']) ? 1 : 0;
        $is_gdye = isset($_POST['is_gdye']) ? 1 : 0;
        
        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· Ï„Î¿ Î¼Î·Ï„ÏÏÎ¿
        $stmt = $pdo->prepare("SELECT COUNT(*) FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
        $stmt->execute([$new_mitroo]);
        if ($stmt->fetchColumn() > 0) {
            $error = "Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î·Ï„ÏÏÎ¿!";
        } else {
            try {
                $stmt = $pdo->prepare("INSERT INTO users (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ, PIN, ADMINISTRATOR, Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£, GDYE) VALUES (?, ?, ?, ?, ?, ?, ?)");
                if ($stmt->execute([$new_mitroo, $new_onoma, $new_eponimo, $new_pin, $is_admin, $is_manager, $is_gdye])) {
                    $roles = [];
                    if ($is_admin) $roles[] = 'Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚';
                    if ($is_manager) $roles[] = 'Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚';
                    if ($is_gdye) $roles[] = 'Î“Î”Î¥Î•';
                    $roles_text = empty($roles) ? 'Î‘Ï€Î»ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚' : implode(', ', $roles);
                    
                    $success = "ÎŸ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚ $new_onoma $new_eponimo Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚! Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±: $roles_text";
                } else {
                    $error = "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï.";
                }
            } catch(Exception $e) {
                $error = "Î£Ï†Î¬Î»Î¼Î±: " . $e->getMessage();
            }
        }
    }
    
    // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï‡ÏÎ®ÏƒÏ„Î· (Î¼ÏŒÎ½Î¿ Admin)
    if ($action == 'remove_user' && $_SESSION['is_admin']) {
        $remove_mitroo = $_POST['remove_mitroo'];
        
        if ($remove_mitroo == $_SESSION['user_mitroo']) {
            $error = "Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ ÏƒÎ±Ï‚!";
        } else {
            try {
                // Î”Î¹Î±Î³ÏÎ±Ï†Î® Î±Ï€ÏŒ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï€Î¯Î½Î±ÎºÎµÏ‚
                $pdo->beginTransaction();
                
                $pdo->prepare("DELETE FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?")->execute([$remove_mitroo]);
                $pdo->prepare("DELETE FROM requests WHERE mitroo = ?")->execute([$remove_mitroo]);
                $stmt = $pdo->prepare("DELETE FROM users WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ?");
                $stmt->execute([$remove_mitroo]);
                
                $pdo->commit();
                $success = "ÎŸ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ Î¼Î±Î¶Î¯ Î¼Îµ ÏŒÎ»Î± Ï„Î¿Ï… Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±!";
            } catch(Exception $e) {
                $pdo->rollback();
                $error = "Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®: " . $e->getMessage();
            }
        }
    }
}

// Î›Î®ÏˆÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·
$my_requests = [];
if (isset($_SESSION['user_mitroo'])) {
    $stmt = $pdo->prepare("SELECT * FROM requests WHERE mitroo = ? ORDER BY submitted_at DESC");
    $stmt->execute([$_SESSION['user_mitroo']]);
    $my_requests = $stmt->fetchAll();
}

// Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚
$pending_requests = [];
if (isset($_SESSION['is_manager'], $_SESSION['is_admin']) && ($_SESSION['is_manager'] || $_SESSION['is_admin'])) {
    $stmt = $pdo->prepare("SELECT DISTINCT r.id, r.mitroo, r.typos, r.imerominia, r.wres, r.ora_enarxis, r.ora_lixis, r.meres, r.logos, r.topos_dianysis, r.proistamenos_egkrisi, r.selected_manager_mitroo, r.status, r.submitted_at, r.modification_reason, r.consultation_message, r.rejection_reason, u.ÎŸÎÎŸÎœÎ‘, u.Î•Î Î©ÎÎ¥ÎœÎŸ FROM requests r JOIN users u ON r.mitroo = u.ÎœÎ—Î¤Î¡Î©ÎŸ WHERE r.status IN ('Î•ÎšÎšÎ¡Î•ÎœÎ•Î™', 'Î£Î¥ÎÎ•ÎÎÎŸÎ—Î£Î—') ORDER BY r.submitted_at DESC");
    $stmt->execute();
    $pending_requests = $stmt->fetchAll();
}

// Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ‘ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Ï‡ÏÎ®ÏƒÏ„Î·
$user_balance_data = [];
if (isset($_SESSION['user_mitroo'])) {
    $stmt = $pdo->prepare("SELECT * FROM adeies_ypoloipa WHERE ÎœÎ—Î¤Î¡Î©ÎŸ = ? ORDER BY Î•Î¤ÎŸÎ£ DESC LIMIT 1");
    $stmt->execute([$_SESSION['user_mitroo']]);
    $user_balance_data = $stmt->fetch();

    if (!$user_balance_data) {
        $current_month = date('n');
        $stmt = $pdo->prepare("INSERT INTO adeies_ypoloipa (ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘Î¤Î•Î Î©ÎÎ¥ÎœÎŸ, YPOTLIPO_HMERES, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, Î¤Î•Î›Î•Î¥Î¤Î‘Î™Î‘_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—_ÎœÎ—ÎÎ‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î, PREVIOUS_YEAR_KANONIKI, PREVIOUS_YEAR_VRAHEIA, Î•Î¤ÎŸÎ£, TELEUTAIA_ENIMEROSI) VALUES (?, ?, 30, 30, 7, 4, 4, 9, ?, 8, 14, 22, 10, 0, 0, ?, CURDATE())");
        $stmt->execute([$_SESSION['user_mitroo'], $_SESSION['user_name'], $current_month, date('Y')]);
        
        $user_balance_data = [
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£' => 30, 
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£' => 7, 
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£' => 4,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£' => 4,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£' => 9,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£' => 8,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î' => 14,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£' => 22,
            'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î' => 10,
            'PREVIOUS_YEAR_KANONIKI' => 0,
            'PREVIOUS_YEAR_VRAHEIA' => 0
        ];
    }
}

// Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ‘ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î³Î¹Î± admin ÎºÎ±Î¹ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ (Î‘Î›Î›Î‘Î“Î—: ÎºÎ±Î¹ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Î¹ Î²Î»Î­Ï€Î¿Ï…Î½ ÏŒÎ»Î±)
$all_balances = [];
$selected_year = isset($_GET['year']) ? (int)$_GET['year'] : (int)date('Y');
if ((isset($_SESSION['is_admin']) && $_SESSION['is_admin']) || (isset($_SESSION['is_manager']) && $_SESSION['is_manager'])) {
    $all_balances = $pdo->prepare("
    SELECT u.ÎœÎ—Î¤Î¡Î©ÎŸ, u.ÎŸÎÎŸÎœÎ‘, u.Î•Î Î©ÎÎ¥ÎœÎŸ, u.ADMINISTRATOR, u.Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£, u.GDYE, u.Î’Î‘Î˜ÎœÎŸÎ£,
           a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, 
           a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£,
           a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î,
           a.PREVIOUS_YEAR_KANONIKI, a.PREVIOUS_YEAR_VRAHEIA,
           a.Î•Î¤ÎŸÎ£, a.TELEUTAIA_ENIMEROSI,
           COALESCE(SUM(CASE WHEN r.typos = 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—' AND r.status IN ('Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•', 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—') THEN r.meres ELSE 0 END), 0) AS Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_ÎºÎ±Î½Î¿Î½Î¹ÎºÎ·Ï‚,
           COALESCE(SUM(CASE WHEN r.typos = 'Î’Î¡Î‘Î§Î•Î™Î‘' AND r.status IN ('Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•', 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—') THEN r.meres ELSE 0 END), 0) AS Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_Î²ÏÎ±Ï‡ÎµÎ¹Î±Ï‚
    FROM users u 
    LEFT JOIN (
        SELECT DISTINCT ÎœÎ—Î¤Î¡Î©ÎŸ, 
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£,
               MAX(Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î) as Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î,
               MAX(PREVIOUS_YEAR_KANONIKI) as PREVIOUS_YEAR_KANONIKI,
               MAX(PREVIOUS_YEAR_VRAHEIA) as PREVIOUS_YEAR_VRAHEIA,
               MAX(Î•Î¤ÎŸÎ£) as Î•Î¤ÎŸÎ£,
               MAX(TELEUTAIA_ENIMEROSI) as TELEUTAIA_ENIMEROSI
        FROM adeies_ypoloipa 
        WHERE Î•Î¤ÎŸÎ£ = ?
        GROUP BY ÎœÎ—Î¤Î¡Î©ÎŸ
    ) a ON u.ÎœÎ—Î¤Î¡Î©ÎŸ = a.ÎœÎ—Î¤Î¡Î©ÎŸ
    LEFT JOIN requests r ON u.ÎœÎ—Î¤Î¡Î©ÎŸ = r.mitroo
    GROUP BY 
        u.ÎœÎ—Î¤Î¡Î©ÎŸ, u.ÎŸÎÎŸÎœÎ‘, u.Î•Î Î©ÎÎ¥ÎœÎŸ, u.ADMINISTRATOR, u.Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£, u.GDYE, u.Î’Î‘Î˜ÎœÎŸÎ£, 
        a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£, 
        a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£,
        a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£, a.Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î,
        a.PREVIOUS_YEAR_KANONIKI, a.PREVIOUS_YEAR_VRAHEIA, a.Î•Î¤ÎŸÎ£, a.TELEUTAIA_ENIMEROSI
    ORDER BY 
    CASE 
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î”Î¹ÎµÏ…Î¸Ï…Î½Ï„Î®Ï‚%' THEN 1
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚ Î¥Ï€Î¿Î´Î¹ÎµÏ…Î¸Ï…Î½Ï„Î®Ï‚%' THEN 2
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏƒÏ„Ï…Î½ÏŒÎ¼Î¿Ï‚ Î‘%' THEN 3
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏƒÏ„Ï…Î½ÏŒÎ¼Î¿Ï‚ Î’%' THEN 4
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î¥Ï€Î±ÏƒÏ„Ï…Î½ÏŒÎ¼Î¿Ï‚ Î‘%' THEN 5
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î¥Ï€Î±ÏƒÏ„Ï…Î½ÏŒÎ¼Î¿Ï‚ Î’%' THEN 6
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘Î½Î¸Ï…Ï€Î±ÏƒÏ„Ï…Î½ÏŒÎ¼Î¿Ï‚%' THEN 7
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏÏ‡Î¹Ï†ÏÎ»Î±ÎºÎ±Ï‚%' THEN 8
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î¥Ï€Î±ÏÏ‡Î¹Ï†ÏÎ»Î±ÎºÎ±Ï‚%' THEN 9
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î‘ÏƒÏ„Ï…Ï†ÏÎ»Î±ÎºÎ±Ï‚%' THEN 10
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î•Î¹Î´Î¹ÎºÏŒÏ‚ Î¦ÏÎ¿Ï…ÏÏŒÏ‚%' THEN 11
        WHEN u.Î’Î‘Î˜ÎœÎŸÎ£ LIKE '%Î .Î¥.%' THEN 12
        WHEN u.ÎœÎ—Î¤Î¡Î©ÎŸ = '999999' THEN 99
        ELSE 50
    END,
    CAST(u.ÎœÎ—Î¤Î¡Î©ÎŸ AS UNSIGNED)
");
    $all_balances->execute([$selected_year]);
    $all_balances = $all_balances->fetchAll();
}

// Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î³Î¹Î± Î“Î”Î¥Î•
$approved_requests = [];
if (isset($_SESSION['is_gdye']) && $_SESSION['is_gdye']) {
    $approved_requests = $pdo->query("
         SELECT r.*, u.ÎŸÎÎŸÎœÎ‘, u.Î•Î Î©ÎÎ¥ÎœÎŸ, u.Î’Î‘Î˜ÎœÎŸÎ£, u.Î Î‘Î¤Î¡Î©ÎÎ¥ÎœÎŸ
         FROM requests r
         JOIN users u ON r.mitroo = u.ÎœÎ—Î¤Î¡Î©ÎŸ
         WHERE r.status IN ('Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•', 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—')
         ORDER BY r.imerominia ASC
    ")->fetchAll();
}

// Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
$kanoniki_expiry = getSystemSetting($pdo, 'kanoniki_adeia_expiry', '2026-03-31');
$vraheia_expiry = getSystemSetting($pdo, 'vraheia_adeia_expiry', '2025-12-31');
$current_system_year = (int)getSystemSetting($pdo, 'current_year', date('Y'));
?>

<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ - Î•Î Î™Î§Î•Î™Î¡Î—Î£Î™Î‘ÎšÎ—  Î•ÎšÎ”ÎŸÎ£Î—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5; color: #333;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            padding: 30px; border-radius: 10px; margin-bottom: 30px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .balance-card {
            background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px; text-align: center; min-width: 60px;
            margin: 2px;
        }
        .balance-number { font-size: 16px; font-weight: bold; }
        .balance-label { font-size: 9px; margin-top: 2px; }
        .logout-btn {
            background: rgba(255,255,255,0.2); color: white; padding: 10px 20px;
            border: none; border-radius: 5px; text-decoration: none; cursor: pointer;
        }
        .home-btn {
            background: rgba(255,255,255,0.2); color: white; padding: 12px;
            border: none; border-radius: 50%; text-decoration: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: background-color 0.3s;
        }
        .home-btn:hover { background: rgba(255,255,255,0.3); }
        .home-btn svg { width: 20px; height: 20px; }
        .tabs {
            display: flex; margin-bottom: 20px; background: white; border-radius: 10px;
            overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tab-button {
            flex: 1; padding: 15px 20px; background: white; border: none; cursor: pointer;
            font-size: 14px; transition: background-color 0.3s;
        }
        .tab-button.active { background: #667eea; color: white; }
        .tab-button:hover { background: #f0f0f0; }
        .tab-button.active:hover { background: #5a6fd8; }
        .tab-content { display: none; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;
            font-size: 16px; transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #667eea;
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-row-three { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .btn-danger { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .btn-warning { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); color: #333; }
        .btn-info { background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .requests-table {
            width: 100%; border-collapse: collapse; margin-top: 20px; background: white;
            border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .requests-table th, .requests-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .requests-table th { background: #f8f9fa; font-weight: 600; color: #555; }
        .requests-table tr:hover { background-color: #f8f9fa; }
        .status-badge {
            padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-consultation { background: #cce5ff; color: #004085; }
        .status-modified { background: #e2e3e5; color: #383d41; }
        .action-buttons { display: flex; gap: 5px; flex-wrap: wrap; }
        .enhanced-balance {
            background: #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }
        .enhanced-balance h4 {
            color: #333; margin-bottom: 15px; font-size: 1.1rem;
        }
        .balance-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;
        }
        .balance-item {
            background: white; padding: 12px; border-radius: 8px; text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .balance-value { font-size: 1.4rem; font-weight: bold; color: #667eea; }
        .balance-type { font-size: 0.8rem; color: #666; margin-top: 4px; }
        .balance-previous { font-size: 0.7rem; color: #28a745; margin-top: 2px; font-weight: bold; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: none; width: 80%; max-width: 600px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover, .close:focus { color: black; text-decoration: none; }
        
        /* Admin Table Styles */
        .editable {
            cursor: pointer; padding: 8px; border-radius: 4px; transition: background-color 0.2s;
            border: 1px solid transparent;
        }
        .editable:hover { background-color: #f0f0f0; border-color: #ddd; }
        .editing { background-color: #fff3cd; border-color: #ffc107; }
        .settings-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .settings-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px; align-items: center; }
        
        /* ÎÎ•ÎŸ: Backup Section Styling */
        .backup-section { background: #e7f3ff; border-left: 5px solid #007bff; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .backup-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .backup-info { color: #004085; font-size: 0.9rem; line-height: 1.6; }
        .backup-status { margin-top: 10px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .backup-status.success { background: #d4edda; color: #155724; }
        .backup-status.error { background: #f8d7da; color: #721c24; }
        
        /* Export buttons styling */
        .export-buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-export { display: flex; align-items: center; gap: 8px; }
        
        /* Print styles */
        @media print {
            .header, .tabs, .export-buttons, .btn, .editable { display: none !important; }
            .container { max-width: none; margin: 0; padding: 0; }
            .tab-content { display: block !important; padding: 0; box-shadow: none; }
            .requests-table { width: 100%; font-size: 10px; }
            .requests-table th, .requests-table td { padding: 4px; border: 1px solid #000; }
            body { font-size: 10px; }
            h2 { font-size: 14px; margin-bottom: 10px; }
        }
        
        @media (max-width: 768px) {
            .form-row, .form-row-three, .settings-row, .backup-buttons { grid-template-columns: 1fr; }
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 20px; text-align: center; }
            .user-info { flex-wrap: wrap; justify-content: center; }
            .requests-table { font-size: 12px; }
            .requests-table th, .requests-table td { padding: 8px; }
            .balance-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
            .action-buttons { justify-content: center; }
            .export-buttons { flex-direction: column; }
            .btn-export { justify-content: center; }
        }
    </style>
</head>
<body>

    <div class="container">
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ›ï¸ Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ - Î•Î Î™Î§Î•Î™Î¡Î—Î£Î™Î‘ÎšÎ—  Î•ÎšÎ”ÎŸÎ£Î—</h1>
                <p>ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ, <?php echo htmlspecialchars($_SESSION['user_name'] ?? 'Guest'); ?></p>
                <?php if (isset($_SESSION['is_admin']) && $_SESSION['is_admin']): ?>
                    <span style="font-size: 12px; background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 3px; margin-left: 10px;">Î”Î™Î‘Î§Î•Î™Î¡Î™Î£Î¤Î—Î£</span>
                <?php elseif (isset($_SESSION['is_manager']) && $_SESSION['is_manager']): ?>
                    <span style="font-size: 12px; background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 3px; margin-left: 10px;">Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£</span>
                <?php endif; ?>
                <?php if (isset($_SESSION['is_gdye']) && $_SESSION['is_gdye']): ?>
                    <span style="font-size: 12px; background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 3px; margin-left: 5px;">Î“Î”Î¥Î•</span>
                <?php endif; ?>
            </div>
            
            <div class="user-info">
                <a href="http://localhost/intranet_wp/" class="home-btn" title="Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î‘ÏÏ‡Î¹ÎºÎ®">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>
                    </svg>
                </a>
                
                <?php if ($user_balance_data): ?>
                <div class="balance-card">
                    <div class="balance-number"><?php echo ($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 30) + ($user_balance_data['PREVIOUS_YEAR_KANONIKI'] ?? 0); ?></div>
                    <div class="balance-label">ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®</div>
                </div>
                <div class="balance-card">
                    <div class="balance-number"><?php echo ($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 7) + ($user_balance_data['PREVIOUS_YEAR_VRAHEIA'] ?? 0); ?></div>
                    <div class="balance-label">Î’ÏÎ±Ï‡ÎµÎ¯Î±</div>
                </div>
                <div class="balance-card">
                    <div class="balance-number"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'] ?? 9; ?>ÏÏ</div>
                    <div class="balance-label">ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ·</div>
                </div>
                <div class="balance-card">
                    <div class="balance-number"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 4; ?></div>
                    <div class="balance-label">Î Î¿ÏÎµÎ¯Î± Îš.</div>
                </div>
                <div class="balance-card">
                    <div class="balance-number"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 4; ?></div>
                    <div class="balance-label">Î Î¿ÏÎµÎ¯Î± Î’.</div>
                </div>
                <div class="balance-card">
                    <div class="balance-number"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£'] ?? 8; ?></div>
                    <div class="balance-label">Î£Ï‡Î¿Î». Î .</div>
                </div>
                <?php endif; ?>
                
                <a href="http://localhost/intranet_wp/" onclick="fetch('?logout=1'); return true;" class="logout-btn">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</a>
            </div>
        </div>

        <?php if (isset($success)): ?>
            <div class="alert alert-success"><?php echo $success; ?></div>
        <?php endif; ?>

        <?php if (isset($error)): ?>
            <div class="alert alert-error"><?php echo $error; ?></div>
        <?php endif; ?>

        <div class="tabs">
  <button type="button" class="tab-button active" onclick="openTab(event, 'submit-tab')">Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î¯Ï„Î·ÏƒÎ·Ï‚</button>
  <button type="button" class="tab-button" onclick="openTab(event, 'my-requests-tab')">ÎŸÎ¹ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ ÎœÎ¿Ï…</button>

  <?php if (!empty($_SESSION['is_manager']) || !empty($_SESSION['is_admin'])): ?>
    <button type="button" class="tab-button" onclick="openTab(event, 'pending-tab')">Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚</button>
    <button type="button" class="tab-button" onclick="openTab(event, 'settings-tab')">Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</button>
  <?php endif; ?>

  <?php if (!empty($_SESSION['is_gdye'])): ?>
    <button type="button" class="tab-button" onclick="openTab(event, 'approved-tab')">Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î†Î´ÎµÎ¹ÎµÏ‚</button>
  <?php endif; ?>

  <?php if (!empty($_SESSION['is_admin']) || !empty($_SESSION['is_manager'])): ?>
    <button type="button" class="tab-button" onclick="openTab(event, 'admin-tab')">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½</button>
  <?php endif; ?>

  <?php if (!empty($_SESSION['is_admin']) || !empty($_SESSION['is_gdye'])): ?>
    <button type="button" class="tab-button" onclick="openTab(event, 'excel-upload-tab')">ğŸ“Š Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î‘Î´ÎµÎ¹ÏÎ½</button>
  <?php endif; ?>

  <button type="button" class="tab-button" onclick="window.open('leave-schedule.php', '_blank')" style="background: #28a745;">ğŸ“… Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ Î‘Î´ÎµÎ¹ÏÎ½</button>
</div>

        <!-- Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— ÎšÎ±ÏÏ„Î­Î»Î± Î¥Ï€Î¿Î²Î¿Î»Î®Ï‚ Î‘Î¯Ï„Î·ÏƒÎ·Ï‚ -->
        <div id="submit-tab" class="tab-content active">
            <h2>Î¥Ï€Î¿Î²Î¿Î»Î® ÎÎ­Î±Ï‚ Î‘Î¯Ï„Î·ÏƒÎ·Ï‚ Î†Î´ÎµÎ¹Î±Ï‚ (17 Î¤ÏÏ€Î¿Î¹)</h2>
            
            <!-- Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎŸ ENHANCED BALANCE DISPLAY -->
            <?php if ($user_balance_data): ?>
            <div class="enhanced-balance">
                <h4>ğŸ¦ Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î‘Î´ÎµÎ¹ÏÎ½ - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ‘ Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘</h4>
                <div class="balance-grid">
                    <div class="balance-item">
                        <div class="balance-value"><?php echo ($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 30) + ($user_balance_data['PREVIOUS_YEAR_KANONIKI'] ?? 0); ?></div>
                        <div class="balance-type">ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®</div>
                        <?php if (($user_balance_data['PREVIOUS_YEAR_KANONIKI'] ?? 0) > 0): ?>
                            <div class="balance-previous">+ <?php echo $user_balance_data['PREVIOUS_YEAR_KANONIKI']; ?> Î±Ï€ÏŒ 2024</div>
                        <?php endif; ?>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo ($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 7) + ($user_balance_data['PREVIOUS_YEAR_VRAHEIA'] ?? 0); ?></div>
                        <div class="balance-type">Î’ÏÎ±Ï‡ÎµÎ¯Î±</div>
                        <?php if (($user_balance_data['PREVIOUS_YEAR_VRAHEIA'] ?? 0) > 0): ?>
                            <div class="balance-previous">+ <?php echo $user_balance_data['PREVIOUS_YEAR_VRAHEIA']; ?> Î±Ï€ÏŒ 2024</div>
                        <?php endif; ?>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'] ?? 9; ?>Ï</div>
                        <div class="balance-type">ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ·</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 4; ?></div>
                        <div class="balance-type">Î Î¿ÏÎµÎ¯Î± Îš.</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 4; ?></div>
                        <div class="balance-type">Î Î¿ÏÎµÎ¯Î± Î’.</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£'] ?? 8; ?></div>
                        <div class="balance-type">Î£Ï‡Î¿Î»Î¹ÎºÎ® Î .</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo isset($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î']) ? $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î'] : 14; ?></div>
                        <div class="balance-type">Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo isset($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£']) ? $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£'] : 22; ?></div>
                        <div class="balance-type">ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î±</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-value"><?php echo isset($user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î']) ? $user_balance_data['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î'] : 10; ?></div>
                        <div class="balance-type">Î‘ÏƒÎ¸. Î¤Î­ÎºÎ½Ï‰Î½</div>
                    </div>
                </div>
                <div style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <strong>ğŸ“Œ Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> Î¤Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï„Î¹Ï‚ Î·Î¼Î­ÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚ Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½.
                </div>
            </div>
            <?php endif; ?>
            
            <form method="POST">
                <input type="hidden" name="action" value="submit_request">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="typos">Î¤ÏÏ€Î¿Ï‚ Î†Î´ÎµÎ¹Î±Ï‚ (17 Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿Î¯ Ï„ÏÏ€Î¿Î¹):</label>
                        <select id="typos" name="typos" required onchange="updateExpiryInfo()">
                            <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„ÏÏ€Î¿ Î¬Î´ÎµÎ¹Î±Ï‚</option>
                            <option value="ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—">ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (30 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                            <option value="Î’Î¡Î‘Î§Î•Î™Î‘">Î’ÏÎ±Ï‡ÎµÎ¯Î± Î†Î´ÎµÎ¹Î± (7 Î·Î¼Î­ÏÎµÏ‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                            <option value="ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—">ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ· Î†Î´ÎµÎ¹Î± (9 ÏÏÎµÏ‚/Î¼Î®Î½Î±)</option>
							<option value="Î‘Î™Î¤Î—Î£Î—_Î©Î¡Î‘Î¡Î™ÎŸÎ¥">Î‘Î¯Ï„Î·ÏƒÎ· ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Ï‰ÏÎ¬ÏÎ¹Î¿</option>
                            <option value="Î‘ÎÎ‘Î¡Î¡Î©Î¤Î™ÎšÎ—">Î‘Î½Î±ÏÏÏ‰Ï„Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (Î¥Î³ÎµÎ¹Î¿Î½Î¿Î¼Î¹ÎºÎ® + 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                            <option value="Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎ—">Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (Î•Ï€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÎ®)</option>
                            <option value="ÎœÎ‘ÎšÎ¡Î‘Î£_Î”Î™Î‘Î¡ÎšÎ•Î™Î‘Î£">ÎœÎ±ÎºÏÎ¬Ï‚ Î”Î¹Î¬ÏÎºÎµÎ¹Î±Ï‚ Î‘Î»Î»Î¿Î´Î±Ï€Î® (6 Î¼Î®Î½ÎµÏ‚ Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚)</option>
                            <option value="Î£Î§ÎŸÎ›Î™ÎšÎ—_Î”ÎŸÎšÎ™ÎœÎ©Î">Î£Ï‡Î¿Î»Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± Î”Î¿ÎºÎ¯Î¼Ï‰Î½ (Î•Î¿ÏÏ„Î­Ï‚, Î´Î¹Î±ÎºÎ¿Ï€Î­Ï‚)</option>
                            <option value="Î•ÎÎ•Î¤Î‘Î£Î•Î©Î">Î•Î¹Î´Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½ (14 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚)</option>
                            <option value="ÎœÎ—Î¤Î¡ÎŸÎ¤Î—Î¤Î‘Î£">ÎœÎ·Ï„ÏÏŒÏ„Î·Ï„Î±Ï‚/Î›Î¿Ï‡ÎµÎ¯Î±Ï‚ (2+3 Î¼Î®Î½ÎµÏ‚)</option>
                            <option value="Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£">Î‘Î½Î±Ï„ÏÎ¿Ï†Î®Ï‚ (2 Î­Ï„Î· Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚)</option>
                            <option value="Î™Î‘Î¤Î¡Î™ÎšÎ—_Î‘ÎÎ‘Î Î‘Î¡Î‘Î“Î©Î“Î—">Î™Î±Ï„ÏÎ¹ÎºÎ¬ Î¥Ï€Î¿Î²Î¿Î·Î¸Î¿ÏÎ¼ÎµÎ½Î· Î‘Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®</option>
                            <option value="Î“Î‘ÎœÎŸÎ£">Î†Î´ÎµÎ¹Î± Î“Î¬Î¼Î¿Ï… (5 Î·Î¼Î­ÏÎµÏ‚)</option>
                            <option value="Î Î•ÎÎ˜ÎŸÎ£">Î†Î´ÎµÎ¹Î± Î Î­Î½Î¸Î¿Ï…Ï‚ (5 Î·Î¼Î­ÏÎµÏ‚)</option>
                            <option value="ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘">ÎœÎµÏ„Î±Î³Î³Î¯ÏƒÎµÎ¹Ï‚/ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î± (22 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚)</option>
                            <option value="Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î">Î†Î´ÎµÎ¹Î± Î‘ÏƒÎ¸Î­Î½ÎµÎ¹Î±Ï‚ Î¤Î­ÎºÎ½Ï‰Î½</option>
                            <option value="Î•Î Î™Î Î¡ÎŸÎ£Î˜Î•Î¤Î—_Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£">Î•Ï€Î¹Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î· Î†Î´ÎµÎ¹Î± Î‘Î½Î±Ï„ÏÎ¿Ï†Î®Ï‚</option>
                            <option value="Î£Î§ÎŸÎ›Î™ÎšÎ—_Î•Î Î™Î”ÎŸÎ£Î—">Î Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Î£Ï‡Î¿Î»Î¹ÎºÎ®Ï‚ Î•Ï€Î¯Î´Î¿ÏƒÎ·Ï‚ Î¤Î­ÎºÎ½Î¿Ï…</option>
                        </select>
                        <div id="expiry-info" style="font-size: 12px; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="imerominia">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ½Î±ÏÎ¾Î·Ï‚:</label>
                        <input type="date" id="imerominia" name="imerominia" required>
                        <small id="date-note" style="font-size: 11px; color: #666; display: block; margin-top: 3px;">
                            Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î·Î½ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î­Î½Î±ÏÎ¾Î·Ï‚ Ï„Î·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚
                        </small>
                    </div>
                </div>
                
                <div class="form-row-three">
                    <div class="form-group">
                        <label for="meres">Î—Î¼Î­ÏÎµÏ‚ Î†Î´ÎµÎ¹Î±Ï‚:</label>
                        <input type="number" id="meres" name="meres" min="1" step="1">
                        <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
                            ÎœÏŒÎ½Î¿ Î±ÎºÎ­ÏÎ±Î¹ÎµÏ‚ Î·Î¼Î­ÏÎµÏ‚ (ÏŒÏ‡Î¹ Î´ÎµÎºÎ±Î´Î¹ÎºÎ¬ - ÏŒÏ‡Î¹ Î³Î¹Î± Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·)
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="wres">ÎÏÎµÏ‚:</label>
                        <input type="number" id="wres" name="wres" min="0" max="9">
                        <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
                            Î“Î¹Î± Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ· Î¬Î´ÎµÎ¹Î± (1-9 ÏÏÎµÏ‚)
                        </small>
                    </div>
                    <div class="form-group" id="hour-range-row" style="display:none;">
                         <label>ÎÏÎµÏ‚ (Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ· Î® Î±Î¯Ï„Î·ÏƒÎ· Ï‰ÏÎ±ÏÎ¯Î¿Ï…):</label>
                         <div style="display:flex; gap:10px; align-items:center;">
                             <span>Î‘Ï€ÏŒ:</span>
                             <input type="time" id="ora_enarxis" name="ora_enarxis">
                             <span>ÎˆÏ‰Ï‚:</span>
                             <input type="time" id="ora_lixis" name="ora_lixis">
                         </div>
                         <small style="color:#666; font-size:11px;">Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î±Ï€ÏŒ 12:00 Î­Ï‰Ï‚ 14:00 (2 ÏÏÎµÏ‚)</small>
                    </div>
                    <div class="form-group">
                        <label for="imeres_poreias">Î—Î¼Î­ÏÎµÏ‚ Î Î¿ÏÎµÎ¯Î±Ï‚:</label>
                        <input type="number" id="imeres_poreias" name="imeres_poreias" min="0" max="4" value="0">
                        <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
                            ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®: Î¼Î­Ï‡ÏÎ¹ 4, Î’ÏÎ±Ï‡ÎµÎ¯Î±: Î¼Î­Ï‡ÏÎ¹ 4, Î‘Î½Î±ÏÏÏ‰Ï„Î¹ÎºÎ®: Î¼Î­Ï‡ÏÎ¹ 4
                        </small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="logos">Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±:</label>
                        <textarea id="logos" name="logos" rows="3" placeholder="Î ÎµÏÎ¹Î³ÏÎ¬ÏˆÏ„Îµ Ï„Î¿Î½ Î»ÏŒÎ³Î¿ Ï„Î·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚. Î£Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ· Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·Ï‚ Î½Î± Î±Î½Î±Î³ÏÎ¬Ï†ÎµÏ„Îµ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î±  Î±Ï€Î¿ ...:... Î­Ï‰Ï‚ ...:... ÏÏÎ±" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="topos_dianysis">Î— Î¬Î´ÎµÎ¹Î± Î¼Î¿Ï… Î¸Î± Î´Î¹Î±Î½Ï…Î¸ÎµÎ¯:</label>
                        <input type="text" id="topos_dianysis" name="topos_dianysis" placeholder="Î‘Î½Î±Î³ÏÎ¬ÏˆÏ„Îµ Ï„Î·Î½ Ï€ÏŒÎ»Î· Î® Ï‡ÏÏÎ± Î´Î¹Î¬Î½Ï…ÏƒÎ·Ï‚ Ï„Î·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚" maxlength="100" required>
                        <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
                            <strong>Î¥Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï„ÏÏ€Î¿Ï…Ï‚ Î±Î´ÎµÎ¹ÏÎ½</strong>
                        </small>
                    </div>
                </div>
                
<div class="form-group">
    <label for="proistamenos_egkrisi">ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î±Ï€ÏŒ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ Î“ÏÎ±Ï†ÎµÎ¯Î¿Ï…:</label>
    <select id="proistamenos_egkrisi" name="proistamenos_egkrisi" required>
        <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ...</option>
        <option value="ÎÎ‘Î™">ÎÎ‘Î™ - ÎŸ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î®Î¼ÎµÏÎ¿Ï‚ ÎºÎ±Î¹ ÏƒÏ…Î¼Ï†Ï‰Î½ÎµÎ¯</option>
        <option value="ÎŸÎ§Î™ - Î”ÎµÎ½ Î­Ï‡Ï‰ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿">ÎŸÎ§Î™ - Î”ÎµÎ½ Î­Ï‡Ï‰ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿</option>
        <option value="ÎŸÎ§Î™ - Î”ÎµÎ½ ÏƒÏ…Î¼Ï†Ï‰Î½ÎµÎ¯ Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚">ÎŸÎ§Î™ - Î”ÎµÎ½ ÏƒÏ…Î¼Ï†Ï‰Î½ÎµÎ¯ Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚</option>
        <option value="ÎŸÎ§Î™ - Î“Î¹Î±Ï„Î¯ ÎµÎ³Ï ÎµÎ¯Î¼Î±Î¹ Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ Î³ÏÎ±Ï†ÎµÎ¯Î¿Ï…">ÎŸÎ§Î™ - Î“Î¹Î±Ï„Î¯ ÎµÎ³Ï ÎµÎ¯Î¼Î±Î¹ Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ Î³ÏÎ±Ï†ÎµÎ¯Î¿Ï…</option>
    </select>
    <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
        Î¥Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½ÏŒ ÏƒÎ±Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î®
    </small>
</div>
     <div class="form-group">
    <label for="selected_manager">Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î­Î½Î± Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ Î³Î¹Î± Î½Î± ÏƒÏ„Î±Î»ÎµÎ¯ Î· Î±Î¯Ï„Î·ÏƒÎ· ÏƒÎ±Ï‚:</label>
    <select id="selected_manager" name="selected_manager" required>
        <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ --</option>
        <?php
        $managers = $pdo->query("SELECT ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ, EMAIL FROM users WHERE Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£ = 1 AND ADMINISTRATOR = 0 ORDER BY Î•Î Î©ÎÎ¥ÎœÎŸ, ÎŸÎÎŸÎœÎ‘")->fetchAll();
		foreach ($managers as $manager):
        ?>
            <option value="<?php echo htmlspecialchars($manager['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" data-email="<?php echo htmlspecialchars($manager['EMAIL']); ?>">
                <?php echo htmlspecialchars($manager['ÎœÎ—Î¤Î¡Î©ÎŸ'] . ' - ' . $manager['ÎŸÎÎŸÎœÎ‘'] . ' ' . $manager['Î•Î Î©ÎÎ¥ÎœÎŸ']); ?>
            </option>
        <?php endforeach; ?>
    </select>
    <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">
        Î˜Î± ÏƒÏ„Î±Î»ÎµÎ¯ Email ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·Ï‚ ÏƒÏ„Î¿Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿
    </small>
</div>           
                <button type="submit" class="btn">ğŸš€ Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î¯Ï„Î·ÏƒÎ·Ï‚</button>
            </form>
        </div>

        <!-- Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— ÎšÎ±ÏÏ„Î­Î»Î± Î¤Ï‰Î½ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½ ÎœÎ¿Ï… -->
        <div id="my-requests-tab" class="tab-content">
            <h2>ÎŸÎ¹ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ ÎœÎ¿Ï…</h2>
            
            <?php if (count($my_requests) > 0): ?>
                <div style="margin-bottom: 20px;">
                    <strong>Î£ÏÎ½Î¿Î»Î¿ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½:</strong> <?php echo count($my_requests); ?> | 
                    <span style="color: #856404;">Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚:</span> <?php echo count(array_filter($my_requests, fn($r) => $r['status'] == 'Î•ÎšÎšÎ¡Î•ÎœÎ•Î™')); ?> | 
                    <span style="color: #155724;">Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚:</span> <?php echo count(array_filter($my_requests, fn($r) => in_array($r['status'], ['Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•', 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—']))); ?> | 
                    <span style="color: #721c24;">Î‘Ï€Î¿ÏÏÎ¹Ï†Î¸ÎµÎ¯ÏƒÎµÏ‚:</span> <?php echo count(array_filter($my_requests, fn($r) => $r['status'] == 'Î‘Î ÎŸÎ¡Î¡Î™Î¦Î˜Î—ÎšÎ•')); ?>
                </div>
                
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Î¤ÏÏ€Î¿Ï‚</th>
                            <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
                            <th>Î—Î¼Î­ÏÎµÏ‚</th>
                            <th>ÎÏÎµÏ‚</th>
                            <th>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±</th>
                            <th>Î¤ÏŒÏ€Î¿Ï‚ Î”Î¹Î¬Î½Ï…ÏƒÎ·Ï‚</th>
                            <th>Î ÏÎ¿ÏŠÏƒÏ„. ÎˆÎ³ÎºÏÎ¹ÏƒÎ·</th>
                            <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
                            <th>Î¥Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($my_requests as $request): ?>
                        <tr>
                            <td style="font-weight: bold; color: #1e3c72;"><?php echo htmlspecialchars($request['typos']); ?></td>
                            <td><?php echo $request['imerominia'] ? date('d/m/Y', strtotime($request['imerominia'])) : '-'; ?></td>
                            <td style="text-align: center; font-weight: bold;"><?php echo $request['meres'] ?: '-'; ?></td>
                            <td style="text-align: center; font-weight: bold;"><?php echo $request['wres'] ?: '-'; ?></td>
                            <td style="width: 250px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.4;">
                                    <strong><?php echo htmlspecialchars($request['logos']); ?></strong>
                                    <?php if (strpos($request['logos'], 'Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚:') !== false): ?>
                                        <br><span style="color: #007bff; font-size: 11px; font-weight: bold;">
                                            <?php 
                                            preg_match('/Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: (\d+)/', $request['logos'], $matches);
                                            echo isset($matches[1]) ? 'ğŸš¶ Î Î¿ÏÎµÎ¯Î±: ' . $matches[1] . ' Î·Î¼Î­ÏÎµÏ‚' : '';
                                            ?>
                                        </span>
                                    <?php endif; ?>
                                </div>
                            </td>
                            <td style="width: 120px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.3;">
                                    <?php echo htmlspecialchars($request['topos_dianysis'] ?? '-'); ?>
                                </div>
                            </td>
                            <td style="text-align: center;">
                                <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; 
                                      <?php echo ($request['proistamenos_egkrisi'] ?? '') == 'ÎÎ‘Î™' ? 'background: #d4edda; color: #155724;' : 'background: #f8d7da; color: #721c24;'; ?>">
                                    <?php echo htmlspecialchars($request['proistamenos_egkrisi'] ?? 'ÎŸÎ§Î™'); ?>
                                </span>
                            </td>
                            <td>
                                <span class="status-badge status-<?php 
                                    echo $request['status'] == 'Î•ÎšÎšÎ¡Î•ÎœÎ•Î™' ? 'pending' : 
                                        ($request['status'] == 'Î£Î¥ÎÎ•ÎÎÎŸÎ—Î£Î—' ? 'consultation' :
                                        ($request['status'] == 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—' ? 'modified' :
                                        (in_array($request['status'], ['Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•']) ? 'approved' : 'rejected'))); 
                                ?>">
                                    <?php echo htmlspecialchars($request['status']); ?>
                                </span>
                                <?php if (!empty($request['modification_reason'])): ?>
                                    <small style="display: block; color: #856404; margin-top: 4px; font-weight: bold;">
                                        ğŸ“ Î›ÏŒÎ³Î¿Ï‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚: <?php echo htmlspecialchars($request['modification_reason']); ?>
                                    </small>
                                <?php endif; ?>
                                <?php if (!empty($request['consultation_message'])): ?>
                                    <small style="display: block; color: #0056b3; margin-top: 4px; font-weight: bold;">
                                        ğŸ’¬ ÎœÎ®Î½Ï…Î¼Î±: <?php echo htmlspecialchars($request['consultation_message']); ?>
                                    </small>
                                <?php endif; ?>
                                <?php if (!empty($request['rejection_reason'])): ?>
                                    <small style="display: block; color: #dc3545; margin-top: 4px; font-weight: bold;">
                                        âŒ Î›ÏŒÎ³Î¿Ï‚ Î±Ï€ÏŒÏÏÎ¹ÏˆÎ·Ï‚: <?php echo htmlspecialchars($request['rejection_reason']); ?>
                                    </small>
                                <?php endif; ?>
                            </td>
                            <td><?php echo date('d/m/Y H:i', strtotime($request['submitted_at'])); ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            <?php else: ?>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï…Ï€Î¿Î²Î¬Î»ÎµÎ¹ Î±ÎºÏŒÎ¼Î± Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚.</p>
            <?php endif; ?>
        </div>

        <!-- Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— ÎšÎ±ÏÏ„Î­Î»Î± Î•ÎºÎºÏÎµÎ¼ÏÎ½ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½ Î¼Îµ 4 Î•Î Î™Î›ÎŸÎ“Î•Î£ -->
        <?php if (isset($_SESSION['is_manager'], $_SESSION['is_admin']) && ($_SESSION['is_manager'] || $_SESSION['is_admin'])): ?>
        <div id="pending-tab" class="tab-content">
            <h2>Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î ÏÎ¿Ï‚ ÎˆÎ³ÎºÏÎ¹ÏƒÎ· - 4 Î•Î Î™Î›ÎŸÎ“Î•Î£</h2>
            
            <?php if (count($pending_requests) > 0): ?>
                <div style="margin-bottom: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                    <strong>Î£ÏÎ½Î¿Î»Î¿ Î•ÎºÎºÏÎµÎ¼ÏÎ½ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½:</strong> <?php echo count($pending_requests); ?>
                    <div style="margin-top: 10px; font-size: 14px; color: #495057;">
                        <strong>ğŸ“‹ Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î•Ï€Î¹Î»Î¿Î³Î­Ï‚:</strong> 
                        <span style="color: #28a745;">âœ… ÎˆÎ³ÎºÏÎ¹ÏƒÎ·</span> | 
                        <span style="color: #ffc107;">âœï¸ ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·</span> | 
                        <span style="color: #17a2b8;">ğŸ’¬ Î£Ï…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ·</span> | 
                        <span style="color: #dc3545;">âŒ Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ·</span>
                    </div>
                </div>
                
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Î¥Ï€Î¬Î»Î»Î·Î»Î¿Ï‚</th>
                            <th>Î¤ÏÏ€Î¿Ï‚ Î†Î´ÎµÎ¹Î±Ï‚</th>
                            <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
                            <th>Î—Î¼Î­ÏÎµÏ‚</th>
                            <th>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±</th>
                            <th>Î¤ÏŒÏ€Î¿Ï‚</th>
                            <th>Î ÏÎ¿ÏŠÏƒÏ„. ÎˆÎ³ÎºÏÎ¹ÏƒÎ·</th>
                            <th>Î¥Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ</th>
                            <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ (4 Î•Ï€Î¹Î»Î¿Î³Î­Ï‚)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($pending_requests as $request): ?>
                        <tr>
                            <td>
                                <strong><?php echo htmlspecialchars($request['ÎŸÎÎŸÎœÎ‘'] . ' ' . $request['Î•Î Î©ÎÎ¥ÎœÎŸ']); ?></strong><br>
                                <small style="color: #666;">ÎœÎ·Ï„ÏÏÎ¿: <?php echo htmlspecialchars($request['mitroo']); ?></small>
                            </td>
                            <td style="font-weight: bold; color: #1e3c72;"><?php echo htmlspecialchars($request['typos']); ?></td>
                            <td><?php echo $request['imerominia'] ? date('d/m/Y', strtotime($request['imerominia'])) : '-'; ?></td>
                            <td style="text-align: center; font-weight: bold; color: #007bff;"><?php echo $request['meres'] ?: '-'; ?></td>
                            <td style="width: 200px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.4; cursor: help;" title="<?php echo htmlspecialchars($request['logos']); ?>">
                                    <strong><?php echo htmlspecialchars($request['logos']); ?></strong>
                                    <?php if (strpos($request['logos'], 'Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚:') !== false): ?>
                                        <br><span style="color: #007bff; font-size: 11px; font-weight: bold;">
                                            <?php 
                                            preg_match('/Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: (\d+)/', $request['logos'], $matches);
                                            echo isset($matches[1]) ? 'ğŸš¶ Î Î¿ÏÎµÎ¯Î±: ' . $matches[1] . ' Î·Î¼Î­ÏÎµÏ‚' : '';
                                            ?>
                                        </span>
                                    <?php endif; ?>
                                </div>
                            </td>
                            <td style="width: 120px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.3;">
                                    <?php echo htmlspecialchars($request['topos_dianysis'] ?? '-'); ?>
                                </div>
                            </td>
                            <td style="text-align: center;">
                                <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; 
                                      <?php echo ($request['proistamenos_egkrisi'] ?? '') == 'ÎÎ‘Î™' ? 'background: #d4edda; color: #155724;' : 'background: #f8d7da; color: #721c24;'; ?>">
                                    <?php echo htmlspecialchars($request['proistamenos_egkrisi'] ?? 'ÎŸÎ§Î™'); ?>
                                </span>
                            </td>
                            <td style="font-size: 12px;"><?php echo date('d/m/Y H:i', strtotime($request['submitted_at'])); ?></td>
                            <td>
                                <div class="action-buttons">
                                    <form method="POST" style="display: inline;">
                                        <input type="hidden" name="action" value="approve_request">
                                        <input type="hidden" name="request_id" value="<?php echo $request['id']; ?>">
                                        <button type="submit" class="btn btn-success btn-sm" onclick="return confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ³ÎºÏÎ¯Î½ÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ·;')">âœ… ÎˆÎ³ÎºÏÎ¹ÏƒÎ·</button>
                                    </form>
                                    
                                    <button type="button" class="btn btn-warning btn-sm" onclick="openModificationModal(<?php echo $request['id']; ?>, '<?php echo addslashes($request['typos']); ?>', '<?php echo $request['imerominia']; ?>', <?php echo $request['meres']; ?>, <?php echo $request['wres']; ?>, '<?php echo addslashes($request['logos']); ?>', '<?php echo addslashes($request['topos_dianysis'] ?? ''); ?>', '<?php echo addslashes($request['proistamenos_egkrisi'] ?? ''); ?>')">âœï¸ ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·</button>
                                    
                                    <button type="button" class="btn btn-info btn-sm" onclick="openConsultationModal(<?php echo $request['id']; ?>)">ğŸ’¬ Î£Ï…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ·</button>
                                    
                                    <button type="button" class="btn btn-danger btn-sm" onclick="openRejectionModal(<?php echo $request['id']; ?>)">âŒ Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ·</button>
                                </div>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            <?php else: ?>
                <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚.</p>
            <?php endif; ?>
        </div>

        <!-- Modal Î³Î¹Î± Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î‘Î¯Ï„Î·ÏƒÎ·Ï‚ -->
        <div id="modificationModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <span class="close" onclick="closeModal('modificationModal')">&times;</span>
                <h3>ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· - Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î Î»Î®ÏÎ¿Ï…Ï‚ Î‘Î¯Ï„Î·ÏƒÎ·Ï‚</h3>
                <p style="color: #666; margin-bottom: 20px;">ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î± Ï„Î·Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÎ³ÎºÏÎ¯Î½ÎµÏ„Îµ.</p>
                
                <form method="POST">
                    <input type="hidden" name="action" value="approve_with_modification">
                    <input type="hidden" name="request_id" id="mod_request_id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><strong>Î¤ÏÏ€Î¿Ï‚ Î†Î´ÎµÎ¹Î±Ï‚:</strong></label>
                            <select name="new_typos" id="mod_typos" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—">ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (30 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                                <option value="Î’Î¡Î‘Î§Î•Î™Î‘">Î’ÏÎ±Ï‡ÎµÎ¯Î± Î†Î´ÎµÎ¹Î± (7 Î·Î¼Î­ÏÎµÏ‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                                <option value="ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—">ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ· Î†Î´ÎµÎ¹Î± (9 ÏÏÎµÏ‚/Î¼Î®Î½Î±)</option>
                                <option value="Î‘ÎÎ‘Î¡Î¡Î©Î¤Î™ÎšÎ—">Î‘Î½Î±ÏÏÏ‰Ï„Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (Î¥Î³ÎµÎ¹Î¿Î½Î¿Î¼Î¹ÎºÎ® + 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚)</option>
                                <option value="Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎ—">Î•ÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± (Î•Ï€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÎ®)</option>
                                <option value="ÎœÎ‘ÎšÎ¡Î‘Î£_Î”Î™Î‘Î¡ÎšÎ•Î™Î‘Î£">ÎœÎ±ÎºÏÎ¬Ï‚ Î”Î¹Î¬ÏÎºÎµÎ¹Î±Ï‚ Î‘Î»Î»Î¿Î´Î±Ï€Î® (6 Î¼Î®Î½ÎµÏ‚ Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚)</option>
                                <option value="Î£Î§ÎŸÎ›Î™ÎšÎ—_Î”ÎŸÎšÎ™ÎœÎ©Î">Î£Ï‡Î¿Î»Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± Î”Î¿ÎºÎ¯Î¼Ï‰Î½ (Î•Î¿ÏÏ„Î­Ï‚, Î´Î¹Î±ÎºÎ¿Ï€Î­Ï‚)</option>
                                <option value="Î•ÎÎ•Î¤Î‘Î£Î•Î©Î">Î•Î¹Î´Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½ (14 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚)</option>
                                <option value="ÎœÎ—Î¤Î¡ÎŸÎ¤Î—Î¤Î‘Î£">ÎœÎ·Ï„ÏÏŒÏ„Î·Ï„Î±Ï‚/Î›Î¿Ï‡ÎµÎ¯Î±Ï‚ (2+3 Î¼Î®Î½ÎµÏ‚)</option>
                                <option value="Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£">Î‘Î½Î±Ï„ÏÎ¿Ï†Î®Ï‚ (2 Î­Ï„Î· Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚)</option>
                                <option value="Î™Î‘Î¤Î¡Î™ÎšÎ—_Î‘ÎÎ‘Î Î‘Î¡Î‘Î“Î©Î“Î—">Î™Î±Ï„ÏÎ¹ÎºÎ¬ Î¥Ï€Î¿Î²Î¿Î·Î¸Î¿ÏÎ¼ÎµÎ½Î· Î‘Î½Î±Ï€Î±ÏÎ±Î³Ï‰Î³Î®</option>
                                <option value="Î“Î‘ÎœÎŸÎ£">Î†Î´ÎµÎ¹Î± Î“Î¬Î¼Î¿Ï… (5 Î·Î¼Î­ÏÎµÏ‚)</option>
                                <option value="Î Î•ÎÎ˜ÎŸÎ£">Î†Î´ÎµÎ¹Î± Î Î­Î½Î¸Î¿Ï…Ï‚ (5 Î·Î¼Î­ÏÎµÏ‚)</option>
                                <option value="ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘">ÎœÎµÏ„Î±Î³Î³Î¯ÏƒÎµÎ¹Ï‚/ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î± (22 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚)</option>
                                <option value="Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î">Î†Î´ÎµÎ¹Î± Î‘ÏƒÎ¸Î­Î½ÎµÎ¹Î±Ï‚ Î¤Î­ÎºÎ½Ï‰Î½</option>
                                <option value="Î•Î Î™Î Î¡ÎŸÎ£Î˜Î•Î¤Î—_Î‘ÎÎ‘Î¤Î¡ÎŸÎ¦Î—Î£">Î•Ï€Î¹Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î· Î†Î´ÎµÎ¹Î± Î‘Î½Î±Ï„ÏÎ¿Ï†Î®Ï‚</option>
                                <option value="Î£Î§ÎŸÎ›Î™ÎšÎ—_Î•Î Î™Î”ÎŸÎ£Î—">Î Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Î£Ï‡Î¿Î»Î¹ÎºÎ®Ï‚ Î•Ï€Î¯Î´Î¿ÏƒÎ·Ï‚ Î¤Î­ÎºÎ½Î¿Ï…</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ½Î±ÏÎ¾Î·Ï‚:</strong></label>
                            <input type="date" name="new_imerominia" id="mod_date" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                        </div>
                    </div>
                    
                    <div class="form-row-three">
                        <div class="form-group">
                            <label><strong>Î—Î¼Î­ÏÎµÏ‚ Î†Î´ÎµÎ¹Î±Ï‚:</strong></label>
                            <input type="number" name="new_meres" id="mod_days" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                            <small style="color: #666; font-size: 11px;">ÎœÏŒÎ½Î¿ Î±ÎºÎ­ÏÎ±Î¹ÎµÏ‚ Î·Î¼Î­ÏÎµÏ‚ (ÏŒÏ‡Î¹ Î³Î¹Î± Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·)</small>
                        </div>
                        <div class="form-group">
                            <label><strong>ÎÏÎµÏ‚:</strong></label>
                            <input type="number" name="new_wres" id="mod_hours" min="0" max="9" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                            <small style="color: #666; font-size: 11px;">Î“Î¹Î± Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ· Î¬Î´ÎµÎ¹Î± (1-9 ÏÏÎµÏ‚)</small>
                        </div>
                        <div class="form-group">
                            <label><strong>Î—Î¼Î­ÏÎµÏ‚ Î Î¿ÏÎµÎ¯Î±Ï‚:</strong></label>
                            <input type="number" name="new_imeres_poreias" id="mod_travel_days" min="0" max="4" value="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                            <small style="color: #666; font-size: 11px;">ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®: Î¼Î­Ï‡ÏÎ¹ 4, Î’ÏÎ±Ï‡ÎµÎ¯Î±: Î¼Î­Ï‡ÏÎ¹ 4, Î‘Î½Î±ÏÏÏ‰Ï„Î¹ÎºÎ®: Î¼Î­Ï‡ÏÎ¹ 4</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><strong>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±:</strong></label>
                        <textarea name="new_logos" id="mod_reason" rows="3" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><strong>Î¤ÏŒÏ€Î¿Ï‚ Î”Î¹Î¬Î½Ï…ÏƒÎ·Ï‚:</strong></label>
                            <input type="text" name="new_topos" id="mod_location" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                        </div>
                        <div class="form-group">
                            <label><strong>ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î±Ï€ÏŒ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿:</strong></label>
                            <select name="new_proistamenos_egkrisi" id="mod_manager_approval" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="ÎÎ‘Î™">ÎÎ‘Î™ - Î•Î½Î®Î¼ÎµÏÎ¿Ï‚ ÎºÎ±Î¹ ÏƒÏ…Î¼Ï†Ï‰Î½ÎµÎ¯</option>
                                <option value="ÎŸÎ§Î™">ÎŸÎ§Î™ - Î”ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î®Î¼ÎµÏÎ¿Ï‚</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><strong>Î›ÏŒÎ³Î¿Ï‚ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚:</strong></label>
                        <textarea name="modification_reason" rows="3" placeholder="Î‘Î½Î±Ï†Î­ÏÎµÏ„Îµ Ï„Î¿Î½ Î»ÏŒÎ³Î¿ Ï„Î·Ï‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï..." required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;"></textarea>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="submit" class="btn btn-warning" style="font-size: 16px; padding: 12px 30px;">âœï¸ ÎˆÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·</button>
                        <button type="button" class="btn" onclick="closeModal('modificationModal')" style="background: #6c757d; margin-left: 10px;">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Î³Î¹Î± Î£Ï…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ· -->
        <div id="consultationModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('consultationModal')">&times;</span>
                <h3>Î‘Î¯Ï„Î·Î¼Î± Î£Ï…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ·Ï‚</h3>
                <form method="POST">
                    <input type="hidden" name="action" value="request_consultation">
                    <input type="hidden" name="request_id" id="cons_request_id">
                    
                    <div class="form-group">
                        <label>ÎœÎ®Î½Ï…Î¼Î± Î³Î¹Î± Ï„Î¿Î½ Ï…Ï€Î¬Î»Î»Î·Î»Î¿:</label>
                        <textarea name="consultation_message" rows="4" placeholder="Î ÎµÏÎ¹Î³ÏÎ¬ÏˆÏ„Îµ Ï„Î¹ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÏƒÏ…Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ..." required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-info">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î‘Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î£Ï…Î½ÎµÎ½Î½ÏŒÎ·ÏƒÎ·Ï‚</button>
                </form>
            </div>
        </div>

        <!-- Modal Î³Î¹Î± Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ· -->
        <div id="rejectionModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('rejectionModal')">&times;</span>
                <h3>Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ· Î‘Î¯Ï„Î·ÏƒÎ·Ï‚</h3>
                <form method="POST">
                    <input type="hidden" name="action" value="reject_request">
                    <input type="hidden" name="request_id" id="rej_request_id">
                    
                    <div class="form-group">
                        <label>Î›ÏŒÎ³Î¿Ï‚ Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ·Ï‚:</label>
                        <textarea name="rejection_reason" rows="4" placeholder="Î‘Î½Î±Ï†Î­ÏÎµÏ„Îµ Ï„Î¿Î½ Î»ÏŒÎ³Î¿ Ï„Î·Ï‚ Î±Ï€ÏŒÏÏÎ¹ÏˆÎ·Ï‚..." required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-danger">Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ· Î‘Î¯Ï„Î·ÏƒÎ·Ï‚</button>
                </form>
            </div>
        </div>
        <?php endif; ?>

        <!-- ÎšÎ±ÏÏ„Î­Î»Î± Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î‘Î´ÎµÎ¹ÏÎ½ (Î“Î”Î¥Î•) -->
        <?php if (isset($_SESSION['is_gdye']) && $_SESSION['is_gdye']): ?>
        <div id="approved-tab" class="tab-content">
            <h2>ğŸ“‹ Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î†Î´ÎµÎ¹ÎµÏ‚ Î±Ï€ÏŒ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ Î³Î¹Î± ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h2>
            <p style="color: #666; margin-bottom: 20px;">
                <strong>Î“Î”Î¥Î• Î“ÏÎ±Ï†ÎµÎ¯Î¿:</strong> Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ ÏŒÎ»ÎµÏ‚ Î¿Î¹ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎµÎ³ÎºÏÎ¹Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·.
            </p>
            
            <?php if (count($approved_requests) > 0): ?>
                <div style="margin-bottom: 20px; padding: 15px; background: #d4edda; border-radius: 8px; border-left: 5px solid #28a745;">
                    <strong>ğŸ“Š Î£Ï…Î½Î¿Î»Î¹ÎºÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î•Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î‘Î´ÎµÎ¹ÏÎ½:</strong> <?php echo count($approved_requests); ?> | 
                    <span style="color: #155724;">âœ… Î‘Ï€Î»Î­Ï‚ Î•Î³ÎºÏÎ¯ÏƒÎµÎ¹Ï‚:</span> <?php echo count(array_filter($approved_requests, fn($r) => $r['status'] == 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•')); ?> | 
                    <span style="color: #856404;">âœï¸ Î•Î³ÎºÏÎ¯ÏƒÎµÎ¹Ï‚ Î¼Îµ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·:</span> <?php echo count(array_filter($approved_requests, fn($r) => $r['status'] == 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—')); ?>
                </div>
                
                <table class="requests-table">
                    <thead>
    <tr>
        <th style="width: 180px;">Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚</th>
        <th style="width: 130px;">Î¤ÏÏ€Î¿Ï‚ Î†Î´ÎµÎ¹Î±Ï‚</th>
        <th style="width: 100px;">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ½Î±ÏÎ¾Î·Ï‚</th>
        <th style="width: 70px;">Î—Î¼Î­ÏÎµÏ‚</th>
        <th style="width: 60px;">ÎÏÎµÏ‚</th>
        <th style="width: 250px;">Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±</th>
        <th style="width: 120px;">Î¤ÏŒÏ€Î¿Ï‚ Î”Î¹Î¬Î½Ï…ÏƒÎ·Ï‚</th>
        <th style="width: 90px;">Î ÏÎ¿ÏŠÏƒÏ„. ÎˆÎ³ÎºÏ.</th>
        <th style="width: 130px;">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
        <th style="width: 120px;">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ³ÎºÏÎ¹ÏƒÎ·Ï‚</th>
        <th style="width: 80px;">Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
    </tr>
</thead>
                    <tbody>
                        <?php foreach ($approved_requests as $request): ?>
                        <tr style="<?php echo $request['status'] == 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• ÎœÎ• Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—Î£Î—' ? 'background-color: #fff3cd;' : ''; ?>">
                            <td>
                                <strong><?php echo htmlspecialchars($request['ÎŸÎÎŸÎœÎ‘'] . ' ' . $request['Î•Î Î©ÎÎ¥ÎœÎŸ']); ?></strong><br>
                                <small style="color: #666; font-weight: bold;">ÎœÎ·Ï„ÏÏÎ¿: <?php echo htmlspecialchars($request['mitroo']); ?></small>
                            </td>
                            <td style="font-weight: bold; color: #1e3c72;">
                                <?php echo htmlspecialchars($request['typos']); ?>
                            </td>
                            <td style="text-align: center; font-weight: bold; color: #007bff;">
                                <?php echo $request['imerominia'] ? date('d/m/Y', strtotime($request['imerominia'])) : '-'; ?>
                            </td>
                            <td style="text-align: center; font-weight: bold; color: #28a745;">
                                <?php echo $request['meres'] ?: '-'; ?>
                            </td>
                            <td style="text-align: center; font-weight: bold; color: #fd7e14;">
                                <?php echo $request['wres'] ?: '-'; ?>
                            </td>
                            <td style="width: 250px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.4;">
                                    <strong><?php echo htmlspecialchars($request['logos']); ?></strong>
                                    <?php if (strpos($request['logos'], 'Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚:') !== false): ?>
                                        <br><span style="color: #007bff; font-size: 11px; font-weight: bold;">
                                            <?php 
                                            preg_match('/Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: (\d+)/', $request['logos'], $matches);
                                            echo isset($matches[1]) ? 'ğŸš¶ Î Î¿ÏÎµÎ¯Î±: ' . $matches[1] . ' Î·Î¼Î­ÏÎµÏ‚' : '';
                                            ?>
                                        </span>
                                    <?php endif; ?>
                                </div>
                            </td>
                            <td style="width: 120px; word-wrap: break-word;">
                                <div style="white-space: normal; line-height: 1.3;">
                                    <?php echo htmlspecialchars($request['topos_dianysis'] ?? '-'); ?>
                                </div>
                            </td>
                            <td style="text-align: center;">
                                <span style="padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; 
                                      <?php echo ($request['proistamenos_egkrisi'] ?? '') == 'ÎÎ‘Î™' ? 'background: #d4edda; color: #155724;' : 'background: #f8d7da; color: #721c24;'; ?>">
                                    <?php echo htmlspecialchars($request['proistamenos_egkrisi'] ?? 'ÎŸÎ§Î™'); ?>
                                </span>
                            </td>
                            <td>
<span class="status-badge status-<?php 
                                    echo $request['status'] == 'Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•' ? 'approved' : 'modified'; 
                                ?>">
                                    <?php echo htmlspecialchars($request['status']); ?>
                                </span>
                                <?php if (!empty($request['modification_reason'])): ?>
                                    <small style="display: block; color: #856404; margin-top: 4px; font-weight: bold;">
                                        âœï¸ Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ·: <?php echo htmlspecialchars($request['modification_reason']); ?>
                                    </small>
                                <?php endif; ?>
                            <td style="font-size: 12px; text-align: center;">
    <?php echo date('d/m/Y', strtotime($request['submitted_at'])); ?>
</td>
<td style="text-align: center;">
    <?php
// Î¦Ï„Î¹Î¬Ï‡Î½Î¿Ï…Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Î±Ï€ÏŒ Ï„Î± Ï€ÎµÎ´Î¯Î± Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚
$employee_name = ($request['ÎŸÎÎŸÎœÎ‘'] ?? '') . ' ' . ($request['Î•Î Î©ÎÎ¥ÎœÎŸ'] ?? '');
$employee_name = trim($employee_name);
?>
<button type="button" 
        class="btn btn-sm"
        style="background: #28a745; padding: 6px 12px; font-size: 11px;"
        onclick="printLeaveRequest(
                '<?php echo (int)$request['id']; ?>',
                '<?php echo addslashes($request['ÎŸÎÎŸÎœÎ‘'] . ' ' . $request['Î•Î Î©ÎÎ¥ÎœÎŸ']); ?>',
                '<?php echo addslashes($request['typos']); ?>',
                '<?php echo $request['imerominia']; ?>',
                '<?php echo (int)$request['meres']; ?>',
                '<?php echo addslashes($request['logos']); ?>',
                '<?php echo addslashes($request['topos_dianysis']); ?>',
                '<?php echo (int)$request['wres']; ?>',
                '<?php echo $request['ora_enarxis'] ?? ''; ?>',
                '<?php echo $request['ora_lixis'] ?? ''; ?>',
                '<?php echo addslashes($request['mitroo'] ?? ''); ?>',
                '<?php echo addslashes($request['Î’Î‘Î˜ÎœÎŸÎ£'] ?? ''); ?>'
            )"
       title="Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î†Î´ÎµÎ¹Î±Ï‚">
    ğŸ–¨ï¸ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·
</button>
</td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #cce5ff; border-radius: 8px; border-left: 5px solid #007bff;">
                    <h4 style="color: #004085; margin-bottom: 10px;">ğŸ“ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Î“Î”Î¥Î• Î“ÏÎ±Ï†ÎµÎ¯Î¿:</h4>
                    <ul style="color: #004085; margin-left: 20px; line-height: 1.6;">
                        <li><strong>ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·:</strong> ÎŒÎ»ÎµÏ‚ Î¿Î¹ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Î¬Î´ÎµÎ¹ÎµÏ‚ Î­Ï‡Î¿Ï…Î½ ÎµÎ³ÎºÏÎ¹Î¸ÎµÎ¯ ÎºÎ±Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¸Î¿ÏÎ½ ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±.</li>
                        <li><strong>Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚:</strong> ÎŸÎ¹ Î¬Î´ÎµÎ¹ÎµÏ‚ Î¼Îµ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ Ï†ÏŒÎ½Ï„Î¿ Î­Ï‡Î¿Ï…Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿.</li>
                        <li><strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚:</strong> Î ÏÎ¿ÏƒÎ­Î¾Ï„Îµ Ï„Î¹Ï‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚ Î­Î½Î±ÏÎ¾Î·Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Î±Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î± ÎºÎ¬Î¸Îµ Î¬Î´ÎµÎ¹Î±Ï‚.</li>
                        <li><strong>Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±:</strong> Î£Îµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Î±Ï€Î¿ÏÎ¯Î±Ï‚, ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿ Ï€Î¿Ï… ÎµÎ½Î­ÎºÏÎ¹Î½Îµ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î±.</li>
                    </ul>
                </div>
            <?php else: ?>
                <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px; border: 2px dashed #dee2e6;">
                    <h3 style="color: #6c757d; margin-bottom: 15px;">ğŸ“‹ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€ÏÎ¿Ï‚ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</h3>
                    <p style="color: #6c757d;">ÎŒÏ„Î±Î½ Î¿ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ ÎµÎ³ÎºÏÎ¯Î½ÎµÎ¹ Î¬Î´ÎµÎ¹ÎµÏ‚, Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ ÎµÎ´Ï Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î±Ï€ÏŒ Ï„Î¿ Î“Î”Î¥Î• Î³ÏÎ±Ï†ÎµÎ¯Î¿.</p>
                </div>
            <?php endif; ?>
        </div>
        <?php endif; ?>

        <!-- Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— ÎšÎ±ÏÏ„Î­Î»Î± Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ -->
        <?php if (isset($_SESSION['is_manager'], $_SESSION['is_admin']) && ($_SESSION['is_manager'] || $_SESSION['is_admin'])): ?>
        <div id="settings-tab" class="tab-content">
            <h2>Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚</h2>
            
            <div class="settings-section">
                <h3>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚ Î›Î®Î¾Î·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½</h3>
                <p style="color: #666; margin-bottom: 15px;">ÎŸÏÎ¯ÏƒÏ„Îµ Î¼Î­Ï‡ÏÎ¹ Ï€ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï…Ï€Î¿Î²Î»Î·Î¸Î¿ÏÎ½ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ Ï„ÏÏ€Î¿ Î¬Î´ÎµÎ¹Î±Ï‚.</p>
                
                <div class="settings-row">
                    <div>
                        <label><strong>ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Î†Î´ÎµÎ¹Î± - Î›Î®Î¾Î·:</strong></label>
                        <input type="date" id="kanoniki_expiry" value="<?php echo $kanoniki_expiry; ?>" onchange="updateSetting('kanoniki_adeia_expiry', this.value)">
                    </div>
                    <div>
                        <label><strong>Î’ÏÎ±Ï‡ÎµÎ¯Î± Î†Î´ÎµÎ¹Î± - Î›Î®Î¾Î·:</strong></label>
                        <input type="date" id="vraheia_expiry" value="<?php echo $vraheia_expiry; ?>" onchange="updateSetting('vraheia_adeia_expiry', this.value)">
                    </div>
                    <div>
                        <div id="settings-status" style="font-size: 12px; color: #28a745; margin-top: 10px;"></div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ—“ï¸ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎˆÏ„Î¿Ï…Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— Î›ÎŸÎ“Î™ÎšÎ—</h3>
                <p style="color: #666; margin-bottom: 15px;">Î‘Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚ Î¼Îµ ÏƒÏ‰ÏƒÏ„Î® Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚.</p>
                
                <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #007bff;">
                    <h4 style="color: #004085; margin-bottom: 15px;">ğŸ“‹ Î¤ÏÎ­Ï‡Î¿Î½ ÎˆÏ„Î¿Ï‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚: <?php echo $current_system_year; ?></h4>
                    <p style="color: #004085; margin-bottom: 15px; line-height: 1.6;">
                        <strong>Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— Î›Î¿Î³Î¹ÎºÎ® Î‘Î»Î»Î±Î³Î®Ï‚ ÎˆÏ„Î¿Ï…Ï‚:</strong><br>
                        â€¢ ÎšÎ¬Î¸Îµ Î­Ï„Î¿Ï‚: ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® 30 Î·Î¼Î­ÏÎµÏ‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚, Î’ÏÎ±Ï‡ÎµÎ¯Î± 7 Î·Î¼Î­ÏÎµÏ‚ + Î­Ï‰Ï‚ 4 Ï€Î¿ÏÎµÎ¯Î±Ï‚<br>
                        â€¢ Î¤Î± Î±Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚<br>
                        â€¢ ÎšÎ¬Î¸Îµ Î¬Î´ÎµÎ¹Î± Î±Î½Î®ÎºÎµÎ¹ ÏƒÏ„Î¿ Î­Ï„Î¿Ï‚ Ï„Î·Ï‚ (Î´ÎµÎ½ Î±Î¸ÏÎ¿Î¯Î¶Î¿Î½Ï„Î±Î¹, Ï€Î±ÏÎ±Î¼Î­Î½Î¿Ï…Î½ Ï‡Ï‰ÏÎ¹ÏƒÏ„Î¬)<br>
                        â€¢ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: 5 Î·Î¼Î­ÏÎµÏ‚ Î±Ï€ÏŒ 2024 + 30 Î·Î¼Î­ÏÎµÏ‚ Ï„Î¿Ï… 2025 = ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ 35 Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚
                    </p>
                    
                    <div style="display: flex; gap: 15px; align-items: end;">
                        <div style="flex: 1;">
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">ÎÎ­Î¿ ÎˆÏ„Î¿Ï‚:</label>
                            <select id="new_year" style="padding: 10px; border: 2px solid #007bff; border-radius: 6px; width: 100%;">
                                <?php 
                                $next_year = (int)date('Y') + 1;
                                $current_year = (int)date('Y');
                                ?>
                                <option value="<?php echo $current_year; ?>" <?php echo $current_system_year == $current_year ? 'selected' : ''; ?>>
                                    <?php echo $current_year; ?> (Î¤ÏÎ­Ï‡Î¿Î½)
                                </option>
                                <option value="<?php echo $next_year; ?>" <?php echo $current_system_year == $next_year ? 'selected' : ''; ?>>
                                    <?php echo $next_year; ?> (Î•Ï€ÏŒÎ¼ÎµÎ½Î¿)
                                </option>
                            </select>
                        </div>
                        <div>
                            <button onclick="changeYear()" class="btn" style="background: #007bff; padding: 10px 20px;">
                                ğŸ—“ï¸ Î‘Î»Î»Î±Î³Î® ÎˆÏ„Î¿Ï…Ï‚
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 5px solid #ffc107;">
                    <h5 style="color: #856404; margin-bottom: 10px;">âš ï¸ Î ÏÎ¿ÏƒÎ¿Ï‡Î® - Î£Î·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ ÎŸÎ´Î·Î³Î¯ÎµÏ‚:</h5>
                    <ul style="color: #856404; margin-left: 20px; line-height: 1.6;">
                        <li><strong>Backup:</strong> Î Î¬ÏÏ„Îµ Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚</li>
                        <li><strong>Timing:</strong> ÎšÎ¬Î½Ï„Îµ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Î¼ÎµÏ„Î¬ Ï„Î·Î½ 31/12 ÎºÎ±Î¹ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÏ€Î±Î½Î­Î½Î±ÏÎ¾Î· Ï„Ï‰Î½ Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½</li>
                        <li><strong>ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬:</strong> ÎœÏŒÎ½Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î± Î¬Î´ÎµÎ¹Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ - ÏŒÎ»ÎµÏ‚ Î¿Î¹ Î¬Î»Î»ÎµÏ‚ Î¼Î·Î´ÎµÎ½Î¯Î¶Î¿Î½Ï„Î±Î¹</li>
                        <li><strong>ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚:</strong> Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏÎ½ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î±Î»Î»Î±Î³Î®</li>
                        <li><strong>Î‘Î½Î±ÏƒÏ„ÏÎµÏˆÎ¹Î¼ÏŒÏ„Î·Ï„Î±:</strong> Î— Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±ÎºÎ»Î·Î¸ÎµÎ¯ ÎµÏÎºÎ¿Î»Î±</li>
                    </ul>
                </div>
            </div>

            <?php if (isset($_SESSION['is_admin']) && $_SESSION['is_admin']): ?>
			<!-- ÎÎ•ÎŸ: Delete Test Data Section - ÎœÎŸÎÎŸ ADMIN -->
<div style="background: #ffe6e6; border-left: 5px solid #dc3545; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <h3>ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î”Î¿ÎºÎ¹Î¼Î®Ï‚</h3>
    <p style="color: #721c24; margin-bottom: 15px;">
        <strong>âš ï¸ Î Î¡ÎŸÎ£ÎŸÎ§Î—:</strong> Î”Î¹Î±Î³ÏÎ±Ï†Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î´Î¿ÎºÎ¹Î¼Î®Ï‚ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ·. Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ Î¼Î· Î±Î½Î±ÏƒÏ„ÏÎ­ÏˆÎ¹Î¼Î·!
    </p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
        <div>
            <h4 style="color: #dc3545; margin-bottom: 10px;">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½</h4>
            <button onclick="deleteTestRequests()" class="btn btn-danger" style="width: 100%;">
                ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½
            </button>
            <small style="color: #721c24; display: block; margin-top: 5px;">
                Î”Î¹Î±Î³ÏÎ¬Ï†ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Î´ÎµÎ¹ÏÎ½
            </small>
        </div>
        
        <div>
            <h4 style="color: #dc3545; margin-bottom: 10px;">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½</h4>
            <button onclick="deleteTestBalances()" class="btn btn-danger" style="width: 100%;">
                ğŸ—‘ï¸ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
            </button>
            <small style="color: #721c24; display: block; margin-top: 5px;">
                Î•Ï€Î±Î½Î±Ï†Î­ÏÎµÎ¹ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚
            </small>
        </div>
    </div>
    
    <div id="delete-status" style="display: none; margin-top: 15px;"></div>
</div>
            <!-- ÎÎ•ÎŸ: Database Backup & Restore Section -->
            <div class="backup-section">
                <h3>ğŸ’¾ Backup & Restore Î’Î¬ÏƒÎ·Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</h3>
                <p class="backup-info">
                    <strong>Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ:</strong> Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î±ÎºÏ„Î¹ÎºÎ¬ Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÎµÎ¹Î´Î¹ÎºÎ¬ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚ ÏŒÏ€Ï‰Ï‚ Î±Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚ Î® Î¼Î±Î¶Î¹ÎºÎ­Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚.
                </p>
                
                <div class="backup-buttons">
                    <div>
                        <h4 style="color: #007bff; margin-bottom: 10px;">ğŸ“¤ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Backup</h4>
                        <button onclick="createBackup()" class="btn" style="background: #28a745; width: 100%;">
                            ğŸ’¾ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Backup
                        </button>
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Ï€Î»Î®ÏÎµÏ‚ Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï€Î¹Î½Î¬ÎºÏ‰Î½
                        </small>
                    </div>
                    
                    <div>
                        <h4 style="color: #dc3545; margin-bottom: 10px;">ğŸ“¥ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î±Ï€ÏŒ Backup</h4>
                        <form id="restore-form" enctype="multipart/form-data">
                            <input type="file" id="backup-file" accept=".sql" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                            <button type="button" onclick="restoreBackup()" class="btn btn-danger" style="width: 100%;">
                                ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Backup
                            </button>
                        </form>
                        <small style="color: #dc3545; display: block; margin-top: 5px;">
                            âš ï¸ Î ÏÎ¿ÏƒÎ¿Ï‡Î®: Î˜Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ ÏŒÎ»Î± Ï„Î± Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±!
                        </small>
                    </div>
                </div>
                
                <div id="backup-status" style="display: none;"></div>
                
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #17a2b8;">
                    <h5 style="color: #17a2b8; margin-bottom: 8px;">ğŸ“‹ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Backup:</h5>
                    <ul style="color: #495057; font-size: 0.9rem; margin-left: 15px; line-height: 1.4;">
                        <li><strong>Î ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î± Backup:</strong> ÎšÎ¬Î½Ï„Îµ backup Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î¼Î¯Î± Ï†Î¿ÏÎ¬ Ï„Î·Î½ ÎµÎ²Î´Î¿Î¼Î¬Î´Î±</li>
                        <li><strong>Î ÏÎ¹Î½ Î±Ï€ÏŒ Î±Î»Î»Î±Î³Î­Ï‚:</strong> Î Î¬Î½Ï„Î± backup Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Î±Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚ Î® Î¼ÎµÎ³Î¬Î»ÎµÏ‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚</li>
                        <li><strong>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·:</strong> Î¦Ï…Î»Î¬Î¾Ï„Îµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± backup ÏƒÎµ Î±ÏƒÏ†Î±Î»Î­Ï‚ Î¼Î­ÏÎ¿Ï‚ (ÎµÎºÏ„ÏŒÏ‚ server)</li>
                        <li><strong>Î”Î¿ÎºÎ¹Î¼Î®:</strong> Î ÎµÏÎ¹Î¿Î´Î¹ÎºÎ¬ Î´Î¿ÎºÎ¹Î¼Î¬Î¶ÎµÏ„Îµ Ï„Î·Î½ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ test Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½</li>
                    </ul>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¿Ï</h3>
                <p style="color: #666; margin-bottom: 15px;">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î½Î­Î¿Ï… Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï Î® Î±Ï†Î±Î¯ÏÎµÏƒÎ· ÎºÎ¬Ï€Î¿Î¹Î¿Ï… Ï€Î¿Ï… Î­Ï†Ï…Î³Îµ.</p>
                
                <!-- Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #28a745; margin-bottom: 15px;">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï</h4>
                    <form method="POST" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
                        <input type="hidden" name="action" value="add_user">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">ÎœÎ·Ï„ÏÏÎ¿:</label>
                            <input type="text" name="new_mitroo" placeholder="Ï€.Ï‡. 12345" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 100%;">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">ÎŒÎ½Î¿Î¼Î±:</label>
                            <input type="text" name="new_onoma" placeholder="ÎŒÎ½Î¿Î¼Î±" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 100%;">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">Î•Ï€ÏÎ½Ï…Î¼Î¿:</label>
                            <input type="text" name="new_eponimo" placeholder="Î•Ï€ÏÎ½Ï…Î¼Î¿" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 100%;">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">PIN:</label>
                            <input type="password" name="new_pin" placeholder="ÎµÏ‰Ï‚ 6ÏˆÎ®Ï†Î¹Î¿ PIN" maxlength="6" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 100%;">
                        </div>
                        <div>
                            <button type="submit" class="btn btn-success" style="padding: 10px 15px;">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
                        </div>
                        <div style="grid-column: 1 / -1; margin-top: 10px;">
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±:</label>
                            <div style="display: flex; gap: 20px;">
                                <label><input type="checkbox" name="is_admin" value="1"> Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚</label>
                                <label><input type="checkbox" name="is_manager" value="1"> Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚</label>
                                <label><input type="checkbox" name="is_gdye" value="1"> Î“Î”Î¥Î• Î“ÏÎ±Ï†ÎµÎ¯Î¿</label>
                            </div>
                            <small style="color: #666; font-size: 11px; margin-top: 5px;">
                                <strong>Î“Î”Î¥Î•:</strong> Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚ ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î±Î´ÎµÎ¹ÏÎ½ â€¢ <strong>Î ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Î“Î”Î¥Î• Î¼Î·Ï„ÏÏÎ±:</strong> 270325, 268256, 255421
                            </small>
                        </div>
                    </form>
                </div>

                <!-- Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 8px;">
                    <h4 style="color: #856404; margin-bottom: 15px;">ğŸ—‘ï¸ Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï</h4>
                    <?php 
                    // Î›Î®ÏˆÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î³Î¹Î± Ï„Î·Î½ dropdown
                    $all_users = $pdo->query("SELECT ÎœÎ—Î¤Î¡Î©ÎŸ, ÎŸÎÎŸÎœÎ‘, Î•Î Î©ÎÎ¥ÎœÎŸ, ADMINISTRATOR, Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£, GDYE FROM users ORDER BY Î•Î Î©ÎÎ¥ÎœÎŸ, ÎŸÎÎŸÎœÎ‘")->fetchAll();
                    ?>
                    <form method="POST" style="display: flex; gap: 15px; align-items: end;">
                        <input type="hidden" name="action" value="remove_user">
                        <div style="flex: 1;">
                            <label style="font-weight: 600; margin-bottom: 5px; display: block;">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒ:</label>
                            <select name="remove_mitroo" required style="padding: 10px; border: 2px solid #ddd; border-radius: 6px; width: 100%;">
                                <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒ --</option>
                                <?php foreach ($all_users as $user): ?>
                                    <?php 
                                    $roles = [];
                                    if ($user['ADMINISTRATOR'] == 1) $roles[] = 'ADMIN';
                                    if ($user['Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£'] == 1) $roles[] = 'Î Î¡ÎŸÎªÎ£Î¤.';
                                    if (isset($user['GDYE']) && $user['GDYE'] == 1) $roles[] = 'Î“Î”Î¥Î•';
                                    $roles_text = empty($roles) ? '' : ' [' . implode(', ', $roles) . ']';
                                    ?>
                                    <option value="<?php echo htmlspecialchars($user['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>">
                                        <?php echo htmlspecialchars($user['ÎœÎ—Î¤Î¡Î©ÎŸ'] . ' - ' . $user['ÎŸÎÎŸÎœÎ‘'] . ' ' . $user['Î•Î Î©ÎÎ¥ÎœÎŸ'] . $roles_text); ?>
                                    </option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-danger" style="padding: 10px 15px;" onclick="return confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒ; Î— ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¹ÏÎµÎ¸ÎµÎ¯!');">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
                        </div>
                    </form>
                    <small style="color: #856404; font-style: italic;">âš ï¸ Î ÏÎ¿ÏƒÎ¿Ï‡Î®: Î— Î´Î¹Î±Î³ÏÎ±Ï†Î® ÎµÎ¯Î½Î±Î¹ Î¼ÏŒÎ½Î¹Î¼Î· ÎºÎ±Î¹ Î¸Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î¿Ï… Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿Ï!</small>
                </div>
            </div>
            <?php endif; ?>
        </div>
        <?php endif; ?>

        <!-- Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— ÎšÎ±ÏÏ„Î­Î»Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (ÎšÎ±Î¹ Î³Î¹Î± Î ÏÎ¿ÏŠÏƒÏ„Î±Î¼Î­Î½Î¿Ï…Ï‚) -->
        <?php if ((isset($_SESSION['is_admin']) && $_SESSION['is_admin']) || (isset($_SESSION['is_manager']) && $_SESSION['is_manager'])): ?>
        <div id="admin-tab" class="tab-content">
            <h2>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î†Î´ÎµÎ¹Î±Ï‚ - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— Î¼Îµ Î Î¡ÎŸÎ—Î“ÎŸÎ¥ÎœÎ•ÎÎŸ Î•Î¤ÎŸÎ£</h2>
            <p style="color: #666; margin-bottom: 20px;">
                <strong>Î ÏÏŒÏƒÎ²Î±ÏƒÎ·:</strong> <?php echo $_SESSION['is_admin'] ? 'Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚' : 'Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚'; ?> | 
                <strong>Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±:</strong> Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ | 
                <strong>ÎŸÎ´Î·Î³Î¯ÎµÏ‚:</strong> ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î±ÏÎ¹Î¸Î¼ÏŒ Î³Î¹Î± Î½Î± Ï„Î¿Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„ÎµÎ¯Ï„Îµ.
            </p>
            
            <?php if (count($all_balances) > 0): ?>
                <div class="export-buttons">
                    <button onclick="exportToExcel()" class="btn btn-export" style="background: #28a745;">
                        ğŸ“Š Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ Excel
                    </button>
                    <button onclick="exportToPDF()" class="btn btn-export" style="background: #dc3545;">
                        ğŸ“„ Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ PDF
                    </button>
                    <button onclick="printTable()" class="btn btn-export" style="background: #6c757d;">
                        ğŸ–¨ï¸ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·
                    </button>
                </div>
                
                <table class="requests-table" id="balances-table">
                    <thead>
                        <tr>
                            <th>Î¥Ï€Î¬Î»Î»Î·Î»Î¿Ï‚</th>
                            <th>ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®</th>
                            <th>Î’ÏÎ±Ï‡ÎµÎ¯Î±</th>
                            <th>ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ·</th>
                            <th>Î Î¿ÏÎµÎ¯Î± Îš.</th>
                            <th>Î Î¿ÏÎµÎ¯Î± Î’.</th>
                            <th>Î£Ï‡Î¿Î»Î¹ÎºÎ® Î .</th>
                            <th>Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½</th>
                            <th>ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î±</th>
                            <th>Î‘ÏƒÎ¸. Î¤Î­ÎºÎ½Ï‰Î½</th>
                            <th>Î ÏÎ¿Î·Î³. ÎˆÏ„Î¿Ï‚ Îš.</th>
                            <th>Î ÏÎ¿Î·Î³. ÎˆÏ„Î¿Ï‚ Î’.</th>
                            <th>ÎˆÏ„Î¿Ï‚</th>
                            <th>Î¤ÎµÎ». Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($all_balances as $balance): ?>
                        <tr>
                            <td>
                                <?php echo htmlspecialchars(($balance['ÎŸÎÎŸÎœÎ‘'] ?? '') . ' ' . ($balance['Î•Î Î©ÎÎ¥ÎœÎŸ'] ?? '')); ?><br>
<small style="color: #666;"><?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?></small>
<?php if (!empty($balance['Î’Î‘Î˜ÎœÎŸÎ£'])): ?>
    <br><small style="color: #007bff; font-weight: bold;"><?php echo htmlspecialchars($balance['Î’Î‘Î˜ÎœÎŸÎ£']); ?></small>
<?php endif; ?>
                                <?php 
                                $badges = [];
                                if ($balance['ADMINISTRATOR'] == 1) $badges[] = '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px;">ADMIN</span>';
                                if ($balance['Î Î¡ÎŸÎ™Î£Î¤Î‘ÎœÎ•ÎÎŸÎ£'] == 1) $badges[] = '<span style="background: #ffc107; color: black; padding: 2px 6px; border-radius: 10px; font-size: 10px;">Î Î¡ÎŸÎªÎ£Î¤.</span>';
                                if (isset($balance['GDYE']) && $balance['GDYE'] == 1) $badges[] = '<span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px;">Î“Î”Î¥Î•</span>';
                                if (!empty($badges)) echo '<br><div style="margin-top: 4px;">' . implode(' ', $badges) . '</div>';
                                ?>
                            </td>
                            <td>
    <span class="editable" 
          data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
          data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£" 
          data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 30; ?>"
          onclick="makeEditable(this)">
        <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 30; ?>
    </span>
    <?php if (($balance['PREVIOUS_YEAR_KANONIKI'] ?? 0) > 0): ?>
        <small style="display: block; color: #28a745; font-weight: bold;">+<?php echo $balance['PREVIOUS_YEAR_KANONIKI']; ?> Î±Ï€ÏŒ 2024</small>
    <?php endif; ?>
    <?php if (isset($balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_ÎºÎ±Î½Î¿Î½Î¹ÎºÎ·Ï‚']) && $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_ÎºÎ±Î½Î¿Î½Î¹ÎºÎ·Ï‚'] > 0): ?>
        <small style="display: block; color: #dc3545; font-weight: bold;">-<?php echo $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_ÎºÎ±Î½Î¿Î½Î¹ÎºÎ·Ï‚']; ?> Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚</small>
        <small style="display: block; color: #007bff; font-weight: bold; margin-top: 2px; border-top: 1px dashed #ccc; padding-top: 2px;">
            = <?php echo ($balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 30) + ($balance['PREVIOUS_YEAR_KANONIKI'] ?? 0) - $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_ÎºÎ±Î½Î¿Î½Î¹ÎºÎ·Ï‚']; ?> Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚
        </small>
    <?php endif; ?>
</td>
                            <td>
    <span class="editable" 
          data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
          data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£" 
          data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 7; ?>"
          onclick="makeEditable(this)">
        <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 7; ?>
    </span>
    <?php if (($balance['PREVIOUS_YEAR_VRAHEIA'] ?? 0) > 0): ?>
        <small style="display: block; color: #28a745; font-weight: bold;">+<?php echo $balance['PREVIOUS_YEAR_VRAHEIA']; ?> Î±Ï€ÏŒ 2024</small>
    <?php endif; ?>
    <?php if (isset($balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_Î²ÏÎ±Ï‡ÎµÎ¹Î±Ï‚']) && $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_Î²ÏÎ±Ï‡ÎµÎ¹Î±Ï‚'] > 0): ?>
        <small style="display: block; color: #dc3545; font-weight: bold;">-<?php echo $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_Î²ÏÎ±Ï‡ÎµÎ¹Î±Ï‚']; ?> Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚</small>
        <small style="display: block; color: #007bff; font-weight: bold; margin-top: 2px; border-top: 1px dashed #ccc; padding-top: 2px;">
            = <?php echo ($balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 7) + ($balance['PREVIOUS_YEAR_VRAHEIA'] ?? 0) - $balance['Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¼ÎµÎ½ÎµÏ‚_Î²ÏÎ±Ï‡ÎµÎ¹Î±Ï‚']; ?> Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚
        </small>
    <?php endif; ?>
</td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'] ?? 9; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo ($balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£'] ?? 9) . 'Ï'; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 4; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£'] ?? 4; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 4; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î ÎŸÎ¡Î•Î™Î‘Î£_Î’Î¡Î‘Î§Î•Î™Î‘Î£'] ?? 4; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£'] ?? 8; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î£Î§ÎŸÎ›Î™ÎšÎ—Î£_Î ÎŸÎ¡Î•Î™Î‘Î£'] ?? 8; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î'] ?? 14; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î•ÎÎ•Î¤Î‘Î£Î•Î©Î'] ?? 14; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£'] ?? 22; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎÎŸÎ£Î—Î›Î•Î™Î‘Î£'] ?? 22; ?>
                                </span>
                            </td>
                            <td>
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î" 
                                      data-value="<?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î'] ?? 10; ?>"
                                      onclick="makeEditable(this)">
                                    <?php echo $balance['Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_Î‘Î£Î˜Î•ÎÎ•Î™Î‘Î£_Î¤Î•ÎšÎÎ©Î'] ?? 10; ?>
                                </span>
                            </td>
                            <td style="background: #e7f3ff;">
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="PREVIOUS_YEAR_KANONIKI" 
                                      data-value="<?php echo $balance['PREVIOUS_YEAR_KANONIKI'] ?? 0; ?>"
                                      onclick="makeEditable(this)"
                                      style="color: #007bff; font-weight: bold;">
                                    <?php echo $balance['PREVIOUS_YEAR_KANONIKI'] ?? 0; ?>
                                </span>
                            </td>
                            <td style="background: #e7f3ff;">
                                <span class="editable" 
                                      data-mitroo="<?php echo htmlspecialchars($balance['ÎœÎ—Î¤Î¡Î©ÎŸ']); ?>" 
                                      data-field="PREVIOUS_YEAR_VRAHEIA" 
                                      data-value="<?php echo $balance['PREVIOUS_YEAR_VRAHEIA'] ?? 0; ?>"
                                      onclick="makeEditable(this)"
                                      style="color: #007bff; font-weight: bold;">
                                    <?php echo $balance['PREVIOUS_YEAR_VRAHEIA'] ?? 0; ?>
                                </span>
                            </td>
                            <td><?php echo $balance['Î•Î¤ÎŸÎ£'] ?? date('Y'); ?></td>
                            <td><?php echo $balance['TELEUTAIA_ENIMEROSI'] ? date('d/m/Y', strtotime($balance['TELEUTAIA_ENIMEROSI'])) : 'ÎœÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿'; ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #cce5ff; border-radius: 8px; border-left: 5px solid #007bff;">
                    <h4 style="color: #004085; margin-bottom: 10px;">ğŸ“Œ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚:</h4>
                    <ul style="color: #004085; margin-left: 20px; line-height: 1.6;">
                        <li><strong>Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±:</strong> ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î±ÏÎ¹Î¸Î¼ÏŒ Î³Î¹Î± Î½Î± Ï„Î¿Î½ Î±Î»Î»Î¬Î¾ÎµÏ„Îµ</li>
                        <li><strong>Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÎˆÏ„Î¿Ï‚:</strong> ÎŸÎ¹ ÏƒÏ„Î®Î»ÎµÏ‚ Î¼Îµ Î¼Ï€Î»Îµ Ï†ÏŒÎ½Ï„Î¿ Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î±Ï€ÏŒ Ï„Î¿ 2024</li>
                        <li><strong>Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±:</strong> ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® = Î¤ÏÎ­Ï‡Î¿Î½ Î­Ï„Î¿Ï‚ + Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚</li>
                        <li><strong>Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·:</strong> ÎŸÎ¹ Î±Î»Î»Î±Î³Î­Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Î±Î¼Î­ÏƒÏ‰Ï‚</li>
                    </ul>
                </div>
            <?php else: ?>
                <p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½.</p>
            <?php endif; ?>
        </div>
        <?php endif; ?>
    </div>

    <script>
        // Tab functionality
        function openTab(evt, tabName) {
  try {
    if (evt && typeof evt.preventDefault === 'function') {
      evt.preventDefault();
    }
    // ÎšÏÏÏˆÎµ ÏŒÎ»Î± Ï„Î± tab contents
    var tabcontent = document.getElementsByClassName("tab-content");
    for (var i = 0; i < tabcontent.length; i++) {
      tabcontent[i].classList.remove("active");
    }
    // Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ ÏŒÎ»Î± Ï„Î± tab buttons
    var tabbuttons = document.getElementsByClassName("tab-button");
    for (var j = 0; j < tabbuttons.length; j++) {
      tabbuttons[j].classList.remove("active");
    }
    // Î’ÏÎµÏ‚ ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î¿ tab
    var target = document.getElementById(tabName);
    if (!target) {
      console.warn('Tab not found:', tabName);
      return false;  // â† Î•Î´Ï Î®Ï„Î±Î½ Î¼ÏŒÎ½Î¿ return
    }
    target.classList.add("active");
    // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ ÎºÎ±Î¹ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Ï€Î¿Ï… Ï€Î±Ï„Î®Î¸Î·ÎºÎµ (fallback Î±Î½ Î»ÎµÎ¯Ï€ÎµÎ¹ currentTarget)
    if (evt && evt.currentTarget) {
      evt.currentTarget.classList.add("active");
    } else {
      for (var k = 0; k < tabbuttons.length; k++) {
        var oc = (tabbuttons[k].getAttribute('onclick') || '');
        if (oc.indexOf("'" + tabName + "'") !== -1) {
          tabbuttons[k].classList.add("active");
          break;
        }
      }
    }
    return false;  // â† Î‘Ï…Ï„ÏŒ Î­Î»ÎµÎ¹Ï€Îµ
  } catch (e) {
    console.error('openTab error:', e);
    return false;  // â† Î‘Ï…Ï„ÏŒ Î­Î»ÎµÎ¹Ï€Îµ
  }
}
        
        // Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ— Update expiry info based on leave type
        function updateExpiryInfo() {
            var typos = document.getElementById('typos').value;
            var infoDiv = document.getElementById('expiry-info');
            
            if (typos === 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—') {
                infoDiv.innerHTML = 'ğŸ–ï¸ 30 Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚ + 4 Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚ â€¢ â° Î›Î®Î³ÎµÎ¹: <?php echo date('d/m/Y', strtotime($kanoniki_expiry)); ?>';
                infoDiv.style.color = '#007bff';
            } else if (typos === 'Î’Î¡Î‘Î§Î•Î™Î‘') {
                infoDiv.innerHTML = 'âš¡ 7 Î·Î¼Î­ÏÎµÏ‚ + 4 Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚ â€¢ â° Î›Î®Î³ÎµÎ¹: <?php echo date('d/m/Y', strtotime($vraheia_expiry)); ?>';
                infoDiv.style.color = '#28a745';
            } else if (typos === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—') {
                infoDiv.innerHTML = 'â° 3 ÏÏÎµÏ‚/Î·Î¼Î­ÏÎ±, 9 ÏÏÎµÏ‚/Î¼Î®Î½Î±, 30 ÏÏÎµÏ‚/Î­Ï„Î¿Ï‚';
                infoDiv.style.color = '#fd7e14';
            } else if (typos === 'Î‘ÎÎ‘Î¡Î¡Î©Î¤Î™ÎšÎ—') {
                infoDiv.innerHTML = 'ğŸ¥ Î¡Ï…Î¸Î¼Î¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Î¥Î³ÎµÎ¹Î¿Î½Î¿Î¼Î¹ÎºÎ® Î•Ï€Î¹Ï„ÏÎ¿Ï€Î® + 4 Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚';
                infoDiv.style.color = '#dc3545';
            } else if (typos === 'Î•ÎšÎ Î‘Î™Î”Î•Î¥Î¤Î™ÎšÎ—') {
                infoDiv.innerHTML = 'ğŸ“š Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÎ® ÎµÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· â€¢ Î”Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î­Ï‰Ï‚ 50 Î·Î¼Î­ÏÎµÏ‚';
                infoDiv.style.color = '#6f42c1';
            } else if (typos === 'Î•ÎÎ•Î¤Î‘Î£Î•Î©Î') {
                infoDiv.innerHTML = 'ğŸ“ ÎˆÏ‰Ï‚ 14 ÎµÏÎ³Î¬ÏƒÎ¹Î¼ÎµÏ‚ Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚ â€¢ 2 Î·Î¼Î­ÏÎµÏ‚/Î·Î¼Î­ÏÎ± ÎµÎ¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½';
                infoDiv.style.color = '#fd7e14';
            } else if (typos === 'Î“Î‘ÎœÎŸÎ£') {
                infoDiv.innerHTML = 'ğŸ’’ 5 Î·Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚ â€¢ Î ÏÎ¹Î½ Î® Î¼ÎµÏ„Î¬ Ï„Î¿Î½ Î³Î¬Î¼Î¿';
                infoDiv.style.color = '#e83e8c';
            } else if (typos === 'Î Î•ÎÎ˜ÎŸÎ£') {
                infoDiv.innerHTML = 'âš« 5 Î·Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Ï€Î¿Î´Î¿Ï‡Î­Ï‚ â€¢ Î£Ï…Î³Î³ÎµÎ½ÎµÎ¯Ï‚ Î­Ï‰Ï‚ Î²\' Î²Î±Î¸Î¼Î¿Ï';
                infoDiv.style.color = '#6c757d';
            } else if (typos === 'ÎœÎ•Î¤Î‘Î“Î“Î™Î£Î•Î™Î£_ÎÎŸÎ£Î—Î›Î•Î™Î‘') {
                infoDiv.innerHTML = 'ğŸ¥ ÎˆÏ‰Ï‚ 22 ÎµÏÎ³Î¬ÏƒÎ¹Î¼ÎµÏ‚ Î·Î¼Î­ÏÎµÏ‚/Î­Ï„Î¿Ï‚ â€¢ Î“Î¹Î± ÎµÏƒÎ¬Ï‚ Î® Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±';
                infoDiv.style.color = '#dc3545';
            } else if (typos === 'Î‘Î£Î˜Î•ÎÎ•Î™Î‘_Î¤Î•ÎšÎÎ©Î') {
                infoDiv.innerHTML = 'ğŸ¤’ 4 Î·Î¼Î­ÏÎµÏ‚ Î³Î¿Î½Î­Î± â€¢ 7-10 Ï„ÏÎ¯Ï„ÎµÎºÎ½Î¿Ï…Ï‚/Ï€Î¿Î»ÏÏ„ÎµÎºÎ½Î¿Ï…Ï‚ â€¢ 8 Î¼Î¿Î½Î¿Î³Î¿Î½ÎµÎ¯Ï‚';
                infoDiv.style.color = '#ffc107';
             } else {
                 infoDiv.innerHTML = '';
             }
            // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Ï€ÎµÎ´Î¯Ï‰Î½ ÏÏÎ±Ï‚ Î³Î¹Î± ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î— Î® Î‘Î™Î¤Î—Î£Î—_Î©Î¡Î‘Î¡Î™ÎŸÎ¥
            var hourRow = document.getElementById('hour-range-row');
            var fromEl  = document.getElementById('ora_enarxis');
            var toEl    = document.getElementById('ora_lixis');
            if (hourRow && fromEl && toEl) {
                if (typos === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' || typos === 'Î‘Î™Î¤Î—Î£Î—_Î©Î¡Î‘Î¡Î™ÎŸÎ¥') {
                    hourRow.style.display = '';
                    fromEl.required = true;  toEl.required = true;
                } else {
                   hourRow.style.display = 'none';
                   fromEl.required = false; toEl.required = false;
                   fromEl.value = '';        toEl.value = '';
               }
           }
        }

        // Modal functions Î³Î¹Î± Ï€ÏÎ¿ÏŠÏƒÏ„Î±Î¼Î­Î½Î¿Ï…Ï‚
        function openModificationModal(requestId, typos, date, days, hours, reason, location, managerApproval) {
            document.getElementById('mod_request_id').value = requestId;
            document.getElementById('mod_typos').value = typos;
            document.getElementById('mod_date').value = date;
            document.getElementById('mod_days').value = days;
            document.getElementById('mod_hours').value = hours;
            document.getElementById('mod_reason').value = reason;
            document.getElementById('mod_location').value = location;
            document.getElementById('mod_manager_approval').value = managerApproval || 'ÎÎ‘Î™';
            
            // Î•Î¾Î±Î³Ï‰Î³Î® Î·Î¼ÎµÏÏÎ½ Ï€Î¿ÏÎµÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ Î±Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±
            var travelDaysMatch = reason.match(/Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: (\d+)/);
            var travelDays = travelDaysMatch ? travelDaysMatch[1] : 0;
            document.getElementById('mod_travel_days').value = travelDays;
            
            // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î±Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Ï€Î¿ÏÎµÎ¯Î±Ï‚ Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ· ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
            var cleanReason = reason.replace(/ \| Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: \d+/, '');
            document.getElementById('mod_reason').value = cleanReason;
            
            document.getElementById('modificationModal').style.display = 'block';
        }

        function openConsultationModal(requestId) {
            document.getElementById('cons_request_id').value = requestId;
            document.getElementById('consultationModal').style.display = 'block';
        }

        function openRejectionModal(requestId) {
            document.getElementById('rej_request_id').value = requestId;
            document.getElementById('rejectionModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            var modals = document.getElementsByClassName('modal');
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = 'none';
                }
            }
        }
        
        // Admin functions Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (Admin ÎšÎ‘Î™ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Î¹)
        <?php if ((isset($_SESSION['is_admin']) && $_SESSION['is_admin']) || (isset($_SESSION['is_manager']) && $_SESSION['is_manager'])): ?>
        function makeEditable(element) {
            if (element.classList.contains('editing')) return;
            
            var originalValue = element.dataset.value;
            var mitroo = element.dataset.mitroo;
            var field = element.dataset.field;
            
            element.classList.add('editing');
            
            var input = document.createElement('input');
            input.type = 'number';
            input.value = originalValue;
            input.step = '0.5';
            input.style.width = '80px';
            input.style.padding = '4px';
            input.style.border = '1px solid #007bff';
            input.style.borderRadius = '4px';
            
            input.onblur = function() { saveEdit(element, mitroo, field, input.value, originalValue); };
            input.onkeypress = function(e) { 
                if (e.key === 'Enter') { 
                    saveEdit(element, mitroo, field, input.value, originalValue); 
                } else if (e.key === 'Escape') {
                    cancelEdit(element, originalValue, field);
                }
            };
            
            element.innerHTML = '';
            element.appendChild(input);
            input.focus();
            input.select();
        }
        
        function saveEdit(element, mitroo, field, newValue, originalValue) {
            if (newValue === originalValue) {
                cancelEdit(element, originalValue, field);
                return;
            }
            
            fetch('', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `ajax_action=update_balance&mitroo=${mitroo}&field=${field}&value=${newValue}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    element.dataset.value = newValue;
                    element.innerHTML = field === 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£' ? newValue + 'Ï' : newValue;
                    element.classList.remove('editing');
                    element.style.backgroundColor = '#d4edda';
                    setTimeout(() => element.style.backgroundColor = '', 2000);
                } else {
                    alert('Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±'));
                    cancelEdit(element, originalValue, field);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…');
                cancelEdit(element, originalValue, field);
            });
        }
        
        function cancelEdit(element, originalValue, field) {
            element.innerHTML = field === 'Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ_ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£_ÎœÎ—ÎÎ‘Î£' ? originalValue + 'Ï' : originalValue;
            element.classList.remove('editing');
        }
        
        // ÎÎ•Î‘: Î‘Î»Î»Î±Î³Î® Î­Ï„Î¿Ï…Ï‚ Î¼Îµ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— Î»Î¿Î³Î¹ÎºÎ®
        function changeYear() {
            var newYear = document.getElementById('new_year').value;
            
            if (!confirm(`Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ ÏƒÏ„Î¿ Î­Ï„Î¿Ï‚ ${newYear}? Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î¸Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ ÎºÎ±Î¹ Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚ ÎºÎ±Î¹ Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î½Î­Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ¿ÏÏ‚.`)) {
                return;
            }
            
            fetch('', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `ajax_action=change_year&new_year=${newYear}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±: ' + data.message);
                    location.reload(); // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î½ Ï„Î± Î½Î­Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
                } else {
                    alert('Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…');
            });
        }
        <?php endif; ?>
        
        // ÎÎ•Î‘: Database Backup Functions (ÎœÏŒÎ½Î¿ Admin)
        <?php if (isset($_SESSION['is_admin']) && $_SESSION['is_admin']): ?>
        function createBackup() {
            var statusDiv = document.getElementById('backup-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="backup-status">ğŸ”„ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± backup...</div>';
            
            fetch('', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'ajax_action=create_backup'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.innerHTML = '<div class="backup-status success">âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± backup: ' + data.filename + '</div>';
                    // Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ download Ï„Î¿Ï… backup
                    if (data.filepath) {
                        var link = document.createElement('a');
                        link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent('Backup created successfully: ' + data.filename);
                        link.download = data.filename;
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                } else {
                    statusDiv.innerHTML = '<div class="backup-status error">âŒ Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î± backup') + '</div>';
                }
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.innerHTML = '<div class="backup-status error">âŒ Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± backup</div>';
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            });
        }
        
        function restoreBackup() {
            var fileInput = document.getElementById('backup-file');
            var file = fileInput.files[0];
            
            if (!file) {
                alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ backup (.sql)');
                return;
            }
            
            if (!file.name.endsWith('.sql')) {
                alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ Î±ÏÏ‡ÎµÎ¯Î¿ SQL backup');
                return;
            }
            
            if (!confirm('Î Î¡ÎŸÎ£ÎŸÎ§Î—: Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î¸Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î— Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Îµ Ï„Î¿ backup. Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÏ„Îµ;')) {
                return;
            }
            
            var formData = new FormData();
            formData.append('ajax_action', 'restore_backup');
            formData.append('backup_file', file);
            
            var statusDiv = document.getElementById('backup-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="backup-status">ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ backup...</div>';
            
            fetch('', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.innerHTML = '<div class="backup-status success">âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ backup!</div>';
                    setTimeout(() => {
                        location.reload(); // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î¼ÎµÏ„Î¬ Ï„Î·Î½ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬
                    }, 2000);
                } else {
                    statusDiv.innerHTML = '<div class="backup-status error">âŒ Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±') + '</div>';
                }
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.innerHTML = '<div class="backup-status error">âŒ Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ backup</div>';
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            });
        }
        <?php endif; ?>
        
        // Export Functions Î³Î¹Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ (Admin ÎºÎ±Î¹ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Î¹)
        <?php if ((isset($_SESSION['is_admin']) && $_SESSION['is_admin']) || (isset($_SESSION['is_manager']) && $_SESSION['is_manager'])): ?>
        function exportToExcel() {
            var table = document.getElementById('balances-table');
            if (!table) {
                alert('Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î¿ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î³Î¹Î± ÎµÎ¾Î±Î³Ï‰Î³Î®');
                return;
            }
            
            let csv = '\uFEFF'; // UTF-8 BOM for Greek characters
            
            // Headers
            var headers = ['ÎœÎ·Ï„ÏÏÎ¿', 'ÎŒÎ½Î¿Î¼Î±', 'Î•Ï€ÏÎ½Ï…Î¼Î¿', 'Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±', 'ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®', 'Î’ÏÎ±Ï‡ÎµÎ¯Î±', 'ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ·', 'Î Î¿ÏÎµÎ¯Î± Îš.', 'Î Î¿ÏÎµÎ¯Î± Î’.', 'Î£Ï‡Î¿Î»Î¹ÎºÎ® Î .', 'Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½', 'ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î±', 'Î‘ÏƒÎ¸. Î¤Î­ÎºÎ½Ï‰Î½', 'Î ÏÎ¿Î·Î³. ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®', 'Î ÏÎ¿Î·Î³. Î’ÏÎ±Ï‡ÎµÎ¯Î±', 'ÎˆÏ„Î¿Ï‚', 'Î¤ÎµÎ». Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·'];
            csv += headers.join(',') + '\n';
            
            // Data rows
            var rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                var cells = row.querySelectorAll('td');
                var rowData = [];
                
                // Extract data from each cell
                cells.forEach((cell, index) => {
                    if (index === 0) {
                        // First cell - extract name and mitroo
                        var lines = cell.textContent.trim().split('\n');
                        var nameAndMitroo = lines[0].trim();
                        var mitroo = lines[1] ? lines[1].trim() : '';
                        var badges = cell.querySelector('div') ? cell.querySelector('div').textContent : '';
                        
                        var nameParts = nameAndMitroo.split(' ');
                        var lastName = nameParts.pop() || '';
                        var firstName = nameParts.join(' ') || '';
                        
                        rowData.push(mitroo, firstName, lastName, badges);
                    } else if (index < 13) {
                        // Balance cells - get actual values
                        var span = cell.querySelector('span');
                        let value = span ? span.textContent.trim() : cell.textContent.trim();
                        value = value.replace('Ï', ''); // Remove Ï from hours
                        rowData.push(value);
                    } else {
                        // Other cells
                        rowData.push(cell.textContent.trim());
                    }
                });
                
                csv += rowData.map(field => `"${field.replace(/"/g, '""')}"`).join(',') + '\n';
            });
            
            // Create and download file
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'Ypoloipa_Adeion_UPDATED_' + new Date().toISOString().slice(0,10) + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function exportToPDF() {
            // Create a print-friendly version
            var printWindow = window.open('', '_blank');
            var table = document.getElementById('balances-table');
            
            if (!table || !printWindow) {
                alert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® PDF');
                return;
            }
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î‘Î´ÎµÎ¹ÏÎ½ Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ‘ - ${new Date().toLocaleDateString('el-GR')}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            font-size: 9px;
                            margin: 15px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 15px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 8px;
                        }
                        .header h1 { 
                            color: #333; 
                            margin-bottom: 3px;
                            font-size: 16px;
                        }
                        .header p { 
                            color: #666; 
                            margin: 0;
                            font-size: 10px;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 8px;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 3px; 
                            text-align: left;
                            font-size: 8px;
                        }
                        th { 
                            background-color: #f8f9fa; 
                            font-weight: bold;
                            text-align: center;
                        }
                        .badge {
                            font-size: 6px;
                            padding: 1px 2px;
                            border-radius: 2px;
                            color: white;
                        }
                        .admin { background: #dc3545; }
                        .manager { background: #ffc107; color: black; }
                        .gdye { background: #007bff; }
                        .previous-year { background: #e7f3ff; color: #007bff; font-weight: bold; }
                        .footer {
                            margin-top: 15px;
                            text-align: center;
                            font-size: 7px;
                            color: #666;
                            border-top: 1px solid #ddd;
                            padding-top: 8px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ›ï¸ Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ v3.1 - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎŸ</h1>
                        <p><strong>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î‘Î´ÎµÎ¹ÏÎ½ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¿Ï Î¼Îµ Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÎˆÏ„Î¿Ï‚ - ÎˆÏ„Î¿Ï‚ ${new Date().getFullYear()}</strong></p>
                        <p>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎµÎ¾Î±Î³Ï‰Î³Î®Ï‚: ${new Date().toLocaleDateString('el-GR')} ÏƒÏ„Î¹Ï‚ ${new Date().toLocaleTimeString('el-GR')}</p>
                        <p>Î•Î¾Î®Ï‡Î¸Î· Î±Ï€ÏŒ: <?php echo $_SESSION['user_name']; ?> (<?php echo $_SESSION['is_admin'] ? 'Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚' : 'Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚'; ?>)</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚</th>
                                <th>ÎœÎ·Ï„ÏÏÎ¿</th>
                                <th>Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±</th>
                                <th>ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®</th>
                                <th>Î’ÏÎ±Ï‡ÎµÎ¯Î±</th>
                                <th>ÎŸÎ»Î¹Î³ÏŒÏ‰ÏÎ·</th>
                                <th>Î Î¿ÏÎµÎ¯Î± Îš.</th>
                                <th>Î Î¿ÏÎµÎ¯Î± Î’.</th>
                                <th>Î£Ï‡Î¿Î». Î .</th>
                                <th>Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ‰Î½</th>
                                <th>ÎÎ¿ÏƒÎ·Î»ÎµÎ¯Î±</th>
                                <th>Î‘ÏƒÎ¸. Î¤Î­ÎºÎ½.</th>
                                <th style="background: #e7f3ff;">Î ÏÎ¿Î·Î³. Îš.</th>
                                <th style="background: #e7f3ff;">Î ÏÎ¿Î·Î³. Î’.</th>
                                <th>Î¤ÎµÎ». Î•Î½Î·Î¼.</th>
                            </tr>
                        </thead>
                        <tbody>
            `);
            
            // Add table rows
            var rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                var cells = row.querySelectorAll('td');
                printWindow.document.write('<tr>');
                
                cells.forEach((cell, index) => {
                    if (index === 0) {
                        // First cell - name and mitroo
                        var lines = cell.textContent.trim().split('\n');
                        var nameAndMitroo = lines[0].trim();
                        var mitroo = lines[1] ? lines[1].trim() : '';
                        var badgeDiv = cell.querySelector('div');
                        let badges = '';
                        
                        if (badgeDiv) {
                            var badgeSpans = badgeDiv.querySelectorAll('span');
                            var badgeTexts = [];
                            badgeSpans.forEach(span => {
                                var text = span.textContent.trim();
                                let className = '';
                                if (text === 'ADMIN') className = 'admin';
                                else if (text === 'Î Î¡ÎŸÎªÎ£Î¤.') className = 'manager';
                                else if (text === 'Î“Î”Î¥Î•') className = 'gdye';
                                badgeTexts.push(`<span class="badge ${className}">${text}</span>`);
                            });
                            badges = badgeTexts.join(' ');
                        }
                        
                        printWindow.document.write(`<td>${nameAndMitroo}</td>`);
                        printWindow.document.write(`<td>${mitroo}</td>`);
                        printWindow.document.write(`<td>${badges}</td>`);
                    } else if (index < 13) {
                        // Balance cells (including previous year columns)
                        var span = cell.querySelector('span');
                        var value = span ? span.textContent.trim() : cell.textContent.trim();
                        var isPreviousYear = index >= 10 && index <= 11;
                        var cellClass = isPreviousYear ? 'previous-year' : '';
                        printWindow.document.write(`<td class="${cellClass}" style="text-align: center; font-weight: bold;">${value}</td>`);
                    } else if (index === 13) {
                        // Last update
                        printWindow.document.write(`<td style="text-align: center;">${cell.textContent.trim()}</td>`);
                    }
                });
                
                printWindow.document.write('</tr>');
            });
            
            printWindow.document.write(`
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong>Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ v3.1 - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎŸ</strong> | Î£Ï…Î½Î¿Î»Î¹ÎºÏŒÏ‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏÎ½: ${rows.length}</p>
                        <p><strong>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> ÎŸÎ¹ ÏƒÏ„Î®Î»ÎµÏ‚ "Î ÏÎ¿Î·Î³. Îš." ÎºÎ±Î¹ "Î ÏÎ¿Î·Î³. Î’." Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î­Ï„Î¿Ï‚ Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½</p>
                        <p>Î‘Ï…Ï„ÏŒ Ï„Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait a bit then print
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 1000);
        }
        
        function printTable() {
            // Simple print function
            window.print();
        }
		// Î“Î”Î¥Î• Print function for approved leaves
		function printLeaveRequest(requestId, employeeName, leaveType, startDate, days, reason, location, hours, oraStart, oraEnd, mitroo, bathmos) {
    console.log('ğŸ–¨ï¸ Print function called with arguments.length:', arguments.length);
    console.log('ğŸ–¨ï¸ Parameters:', {requestId, employeeName, leaveType, startDate, days, reason, location, hours, oraStart, oraEnd, mitroo, bathmos});
    
    var printWindow = window.open('', '_blank');
    
    if (!printWindow) {
        alert('Î‘Î´Ï…Î½Î±Î¼Î¯Î± Î±Î½Î¿Î¯Î³Î¼Î±Ï„Î¿Ï‚ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï… ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Ï„Î± pop-ups.');
        return;
    }
    
    // Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î£Ï‰ÏƒÏ„Î® Ï‡ÏÎ®ÏƒÎ· Ï„Ï‰Î½ parameters
    var finalRequestId = requestId || 'N/A';
    var finalEmployeeName = employeeName || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚';
    var finalLeaveType = leaveType || 'Î‘Î“ÎÎ©Î£Î¤Î—';
    var finalStartDate = startDate || new Date().toISOString().split('T')[0];
    var finalDays = days || '0';
    var finalReason = reason || 'Î”ÎµÎ½ Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎµ';
    var finalLocation = location || 'Î”ÎµÎ½ Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎµ';
    var finalHours = hours || '0';
    var finalOraStart = oraStart || '';
    var finalOraEnd = oraEnd || '';
    var finalMitroo = mitroo || 'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ';
    var finalBathmos = bathmos || 'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ';
    
    // Format date
    var formattedDate = new Date(finalStartDate).toLocaleDateString('el-GR');
    var printDate = new Date().toLocaleDateString('el-GR');
    
    // Extract travel days from reason if exists
    var travelDays = 0;
    var travelMatch = finalReason.match(/Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: (\d+)/);
    if (travelMatch) {
        travelDays = parseInt(travelMatch[1]);
    }
    
    // Create form title based on leave type
    var formTitle = '';
    var durationText = '';
    
    switch(finalLeaveType) {
        case 'ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—':
            formTitle = 'Î‘Î™Î¤Î—Î£Î— ÎšÎ‘ÎÎŸÎÎ™ÎšÎ—Î£ Î‘Î”Î•Î™Î‘Î£';
            durationText = finalDays + ' ' + (Number(finalDays) === 1 ? 'Î·Î¼Î­ÏÎ±' : 'Î·Î¼Î­ÏÎµÏ‚') + ' ÎºÎ±Î½Î¿Î½Î¹ÎºÎ®Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚';
            break;
        case 'Î’Î¡Î‘Î§Î•Î™Î‘':
            formTitle = 'Î‘Î™Î¤Î—Î£Î— Î’Î¡Î‘Î§Î•Î™Î‘Î£ Î‘Î”Î•Î™Î‘Î£';
            durationText = finalDays + ' ' + (Number(finalDays) === 1 ? 'Î·Î¼Î­ÏÎ±' : 'Î·Î¼Î­ÏÎµÏ‚') + ' Î²ÏÎ±Ï‡ÎµÎ¯Î±Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚';
            break;
        case 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—':
            formTitle = 'Î‘Î™Î¤Î—Î£Î— ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—Î£ Î‘Î”Î•Î™Î‘Î£';
            durationText = finalHours + ' ' + (Number(finalHours) === 1 ? 'ÏÏÎ±' : 'ÏÏÎµÏ‚') + ' Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚';
            break;
        default:
            formTitle = 'Î‘Î™Î¤Î—Î£Î— ' + finalLeaveType + ' Î‘Î”Î•Î™Î‘Î£';
            durationText = finalLeaveType === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' ? 
                (finalHours + ' ' + (Number(finalHours) === 1 ? 'ÏÏÎ±' : 'ÏÏÎµÏ‚')) : 
                (finalDays + ' ' + (Number(finalDays) === 1 ? 'Î·Î¼Î­ÏÎ±' : 'Î·Î¼Î­ÏÎµÏ‚'));
    }
    
    // Split employee name
    var nameParts = finalEmployeeName.split(' ');
    var lastName = nameParts.pop() || '';
    var firstName = nameParts.join(' ') || '';
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Î‘Î¯Ï„Î·ÏƒÎ· Î†Î´ÎµÎ¹Î±Ï‚ - ${finalEmployeeName}</title>
            <style>
                @page { 
                    size: A4; 
                    margin: 2cm; 
                }
                body { 
                    font-family: 'Times New Roman', serif; 
                    font-size: 12pt; 
                    line-height: 1.6;
                    margin: 0;
                    padding: 20px;
                    color: #000;
                }
                .header {
                    text-align: center;
                    border-bottom: 2px solid #000;
                    padding-bottom: 15px;
                    margin-bottom: 25px;
                }
                .header h1 {
                    font-size: 16pt;
                    margin: 10px 0;
                    text-decoration: underline;
                    font-weight: bold;
                }
                .header .date {
                    text-align: right;
                    font-size: 11pt;
                    margin-top: 15px;
                }
                .form-section {
                    margin: 20px 0;
                    padding: 15px;
                    border: 1px solid #000;
                }
                .form-field {
                    margin: 10px 0;
                    padding: 5px 0;
                }
                .employee-info {
                    display: flex;
                    justify-content: space-between;
                    margin: 20px 0;
                    gap: 20px;
                }
                .employee-details {
                    flex: 1;
                }
                .field-group {
                    display: flex;
                    margin: 8px 0;
                    align-items: center;
                }
                .field-label {
                    font-weight: bold;
                    width: 120px;
                }
                .field-value {
                    border-bottom: 1px solid #000;
                    min-width: 150px;
                    padding-bottom: 2px;
                }
                .address-section {
                    flex: 0 0 200px;
                }
                .address-box {
                    border: 1px solid #000;
                    padding: 15px;
                    text-align: center;
                    background: #f9f9f9;
                }
                .approval-section {
                    margin: 30px 0;
                    padding: 20px;
                    border: 2px solid #000;
                    background: #f9f9f9;
                }
                .approval-row {
                    display: flex;
                    justify-content: space-between;
                    margin: 15px 0;
                    align-items: center;
                }
                .approval-label {
                    font-weight: bold;
                    flex: 1;
                }
                .approval-checkbox {
                    display: flex;
                    gap: 20px;
                }
                .approval-checkbox label {
                    font-weight: bold;
                }
                .signature-area {
                    margin-top: 50px;
                    text-align: center;
                }
                .signature-line {
                    margin-top: 60px;
                    border-top: 1px solid #000;
                    width: 200px;
                    margin-left: auto;
                    margin-right: auto;
                    padding-top: 5px;
                }
                .print-info {
                    position: fixed;
                    bottom: 10px;
                    right: 10px;
                    font-size: 8pt;
                    color: #666;
                }
                .official-header {
                    text-align: center;
                    font-size: 10pt;
                    margin-bottom: 20px;
                    border: 1px solid #000;
                    padding: 5px;
                    background: #f0f0f0;
                }
                @media print { 
                    body { margin: 0; padding: 15px; } 
                    .print-info { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="official-header">
                Î¥Î ÎŸÎ”Î•Î™Î“ÎœÎ‘ Î -66/8Î²
            </div>
            
            <div class="header">
                <div style="font-size: 20pt;">ğŸ›ï¸</div>
                <h1>${formTitle}</h1>
                <div class="date">Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚, ${printDate}</div>
            </div>
            
            <div class="employee-info">
                <div class="employee-details">
                    <div class="field-group">
                        <span class="field-label">ÎœÎ·Ï„ÏÏÎ¿:</span>
                        <span class="field-value">${finalMitroo}</span>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Î’Î±Î¸Î¼ÏŒÏ‚:</span>
                        <span class="field-value">${finalBathmos}</span>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Î•Î Î©ÎÎ¥ÎœÎŸ:</span>
                        <span class="field-value">${lastName}</span>
                    </div>
                    <div class="field-group">
                        <span class="field-label">ÎŒÎ½Î¿Î¼Î±:</span>
                        <span class="field-value">${firstName}</span>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Î Î±Ï„ÏÏÎ½Ï…Î¼Î¿:</span>
                        <span class="field-value">_________________</span>
                    </div>
                </div>
                
                <div class="address-section">
                    <div class="address-box">
                        <strong>Î Î¡ÎŸÎ£</strong><br><br>
                        Î¤Î—Î Î”Î™Î•Î¥Î˜Î¥ÎÎ£Î—<br>
                        Î‘Î£Î¤Î¥ÎÎŸÎœÎ™Î‘Î£ Î›Î‘Î£Î™Î˜Î™ÎŸÎ¥<br>
                        Î•ÎÎ¤Î‘Î¥Î˜Î‘
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="field-group">
                    <span class="field-label">Î¥Ï€Î·ÏÎµÏƒÎ¯Î± Ï€Î¿Ï… Ï…Ï€Î·ÏÎµÏ„Ï:</span>
                    <span class="field-value">Î•Ï€Î¹Ï„ÎµÎ»ÎµÎ¯Î¿ Î”/Î½ÏƒÎ·Ï‚ Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¯Î±Ï‚ Î›Î±ÏƒÎ¹Î¸Î¯Î¿Ï…</span>
                </div>
                <br>
                <div class="form-field">
                    <strong>Î§Î¿ÏÎ®Î³Î·ÏƒÎ·:</strong> ${durationText}
                    ${travelDays > 0 ? ` Î¼Îµ ${travelDays} Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚` : ''}
                </div>
                ${finalLeaveType === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' ? `
                    <div class="form-field">
                        <strong>ÎÏÎµÏ‚:</strong> Î±Ï€ÏŒ ${finalOraStart || 'â€”'} Î­Ï‰Ï‚ ${finalOraEnd || 'â€”'}
                    </div>
                    <div class="form-field">
                        <em>Î£Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ· Î¿Î»Î¹Î³ÏŒÏ‰ÏÎ·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚ Î±Î½Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î±: Î±Ï€ÏŒ ....:.... Î­Ï‰Ï‚ ....:.... ÏÏÎ±</em>
                    </div>
                ` : ''}
                <div class="form-field">
                    <strong>ÎˆÏ„Î¿Ï‚:</strong> ${new Date().getFullYear()}
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-field">
                    <strong>1.</strong> Î Î±ÏÎ±ÎºÎ±Î»Ï Î½Î± Î¼Î¿Ï… Ï‡Î¿ÏÎ·Î³Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î· Î¬Î´ÎµÎ¹Î± Î³Î¹Î± Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¿ÏÏ‚ Î»ÏŒÎ³Î¿Ï…Ï‚.
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-field">
                    <strong>2.</strong> ÎˆÎ½Î±ÏÎ¾Î· Ï„Î·Ï‚ Î¬Î´ÎµÎ¹Î±Ï‚ ÎµÏ€Î¹Î¸Ï…Î¼Ï Î½Î± ÎºÎ¬Î½Ï‰ Ï„Î·Î½:
                </div>
                <div style="margin-left: 20px; margin-top: 10px; border-bottom: 1px solid #000; display: inline-block; min-width: 200px; padding-bottom: 2px;">
                    ${formattedDate}
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-field">
                    <strong>3.</strong> Î— Î¬Î´ÎµÎ¹Î± Î¼Î¿Ï… Î¸Î± Î´Î¹Î±Î½Ï…Î¸ÎµÎ¯:
                </div>
                <div style="margin-left: 20px; margin-top: 10px; border-bottom: 1px solid #000; display: inline-block; min-width: 300px; padding-bottom: 2px;">
                    ${finalLocation}
                </div>
            </div>
            
            ${finalReason ? `
            <div class="form-section">
                <div class="form-field">
                    <strong>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±:</strong> ${finalReason.replace(/\| Î—Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚: \d+/, '').trim()}
                </div>
            </div>
            ` : ''}
            
            <div class="approval-section">
                <h3 style="text-align: center; margin-bottom: 20px; text-decoration: underline;">Î•Î“ÎšÎ¡Î™Î£Î•Î™Î£</h3>
                
                <div class="approval-row">
                    <span class="approval-label">Î•Î½Î­ÎºÏÎ¹Î½Îµ Î¿ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ Î“ÏÎ±Ï†ÎµÎ¯Î¿Ï…:</span>
                    <div class="approval-checkbox">
                        <label>â˜‘ ÎÎ‘Î™</label>
                        <label>â˜ ÎŸÎ§Î™</label>
                    </div>
                </div>
                
                <div class="approval-row">
                    <span class="approval-label">Î•Î½Î­ÎºÏÎ¹Î½Îµ Î¿ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿Ï‚ Î•Ï€Î¹Ï„ÎµÎ»ÎµÎ¯Î¿Ï… Î”.Î‘. Î›Î±ÏƒÎ¹Î¸Î¯Î¿Ï…:</span>
                    <div class="approval-checkbox">
                        <label>â˜‘ Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ•</label>
                        <label>â˜ Î‘Î ÎŸÎ¡Î¡Î™Î¦Î˜Î—ÎšÎ•</label>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <div class="field-group">
                        <span class="field-label">Î¥Ï€Î¿Î³ÏÎ±Ï†Î® Î ÏÎ¿ÏŠÏƒÏ„Î±Î¼Î­Î½Î¿Ï…:</span>
                        <span class="field-value">_________________________</span>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ³ÎºÏÎ¹ÏƒÎ·Ï‚:</span>
                        <span class="field-value">${printDate}</span>
                    </div>
                </div>
            </div>
            
            <div class="signature-area">
                <div style="margin-top: 40px;">
                    <strong>ÎŸ/Î— Î•Î½Î´Î¹Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½Î¿Ï‚/Î·</strong>
                </div>
                <div class="signature-line">
                    ${finalEmployeeName}<br>
                    ${finalBathmos}
                </div>
            </div>
            
            <div class="print-info">
                Î•ÎºÏ„Ï…Ï€ÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ Î“Î”Î¥Î• - ${printDate} - Î‘Î¯Ï„Î·ÏƒÎ· #${finalRequestId}
            </div>
        </body>
        </html>
    `);
    
    printWindow.document.close();
    
    // Wait a bit then print
    setTimeout(() => {
        printWindow.print();
        printWindow.close();
    }, 1000);
}

console.log('âœ… Î£Ï‰ÏƒÏ„Î® printLeaveRequest function Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ!');

// ===== Î“Î¹Î± debugging - Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Ï…Ï„ÏŒ ÎµÏ€Î¯ÏƒÎ·Ï‚ =====
console.log('âœ… printLeaveRequest function updated and ready!');
        <?php endif; ?>
        
        // Settings functions Î³Î¹Î± Ï€ÏÎ¿ÏŠÏƒÏ„Î±Î¼Î­Î½Î¿Ï…Ï‚/admin
<?php if ((isset($_SESSION['is_manager']) && $_SESSION['is_manager']) || (isset($_SESSION['is_admin']) && $_SESSION['is_admin'])): ?>
function updateSetting(settingName, value) {
    var statusDiv = document.getElementById('settings-status');
    statusDiv.innerHTML = 'Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·...';
    statusDiv.style.color = '#ffc107';
    
    fetch('', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `ajax_action=update_setting&setting_name=${settingName}&value=${value}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = 'âœ“ Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚';
            statusDiv.style.color = '#28a745';
            setTimeout(() => statusDiv.innerHTML = '', 3000);
        } else {
            statusDiv.innerHTML = 'âœ— Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±');
            statusDiv.style.color = '#dc3545';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        statusDiv.innerHTML = 'âœ— Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…';
        statusDiv.style.color = '#dc3545';
    });
}
<?php endif; ?>

// Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÎºÎ¬Î¸Îµ 30 Î»ÎµÏ€Ï„Î¬ (Î³Î¹Î± Î½Î­ÎµÏ‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚)
setInterval(() => {
    // ÎœÏŒÎ½Î¿ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î·Î½ ÎºÎ±ÏÏ„Î­Î»Î± Ï„Ï‰Î½ ÎµÎºÎºÏÎµÎ¼ÏÎ½ Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½
    if (document.getElementById('pending-tab').classList.contains('active')) {
        // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÎºÎ¬Î¸Îµ 30 Î»ÎµÏ€Ï„Î¬ Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î³Î¹Î± Î½Î­ÎµÏ‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚
        console.log('ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Î½Î­ÎµÏ‚ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚...');
    }
}, 1800000); // 30 Î»ÎµÏ€Ï„Î¬ = 1800000ms

// Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚
document.addEventListener('DOMContentLoaded', function() {
    // Î‘Î¯Ï„Î·ÏƒÎ· Î³Î¹Î± notifications (Î¼ÏŒÎ½Î¿ Î³Î¹Î± managers)
    <?php if (isset($_SESSION['is_manager']) && $_SESSION['is_manager']): ?>
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                console.log('âœ… Notifications ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±');
            } else {
                console.log('âŒ Notifications Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±');
            }
        });
    }
    <?php endif; ?>
    
    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚ ÎºÎ±Î»Ï‰ÏƒÎ¿ÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ Ï€ÏÏÏ„Î· Ï†Î¿ÏÎ¬
    if (!sessionStorage.getItem('welcome_shown')) {
        setTimeout(() => {
            console.log('ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î¿ Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î‘Î´ÎµÎ¹ÏÎ½ v3.1 - Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎŸ');
            sessionStorage.setItem('welcome_shown', 'true');
        }, 1000);
    }
    
    // Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÏƒÏ„Î¯Î±ÏƒÎ· ÏƒÏ„Î¿ Ï€ÏÏÏ„Î¿ Ï€ÎµÎ´Î¯Î¿ Ï„Î·Ï‚ Ï†ÏŒÏÎ¼Î±Ï‚ Ï…Ï€Î¿Î²Î¿Î»Î®Ï‚
    var firstInput = document.querySelector('#submit-tab input, #submit-tab select');
    if (firstInput) {
        firstInput.focus();
    }
});
</script>

<script>
let lastRequestCount = 0;
let isFirstCheck = true;

function checkNewRequests() {
    fetch('check-new-requests.php')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.log('Error checking requests:', data.error);
                return;
            }
            
            var currentCount = data.count; // Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ ÎµÎºÎºÏÎµÎ¼Î®
            var recentCount = data.recent_count; // Î ÏÏŒÏƒÏ†Î±Ï„Î± (Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± 10 Î»ÎµÏ€Ï„Î¬)
            
            console.log(`Î£ÏÎ½Î¿Î»Î¿ ÎµÎºÎºÏÎµÎ¼ÏÎ½: ${currentCount}, Î ÏÏŒÏƒÏ†Î±Ï„Î±: ${recentCount}`);
            
            // Î Î‘ÎÎ¤Î‘ ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î¼Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ
            updateManagerButtonText(currentCount);
            
            // Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¿ Ï€ÏÏÏ„Î¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ±Î¹ Î­Ï‡Î¿Ï…Î¼Îµ Î½Î­Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î±
            if (!isFirstCheck && currentCount > lastRequestCount) {
                var newRequestsFound = currentCount - lastRequestCount;
                
                // Î Î±Î¯Î¾Îµ Î®Ï‡Î¿
                playNotificationSound();
                
                // Î”ÎµÎ¯Î¾Îµ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·
                if (newRequestsFound === 1) {
                    console.log('ğŸ”” ÎÎ­Î¿ Î±Î¯Ï„Î·Î¼Î± Î¬Î´ÎµÎ¹Î±Ï‚!');
                    showNotificationMessage('ÎÎ­Î¿ Î±Î¯Ï„Î·Î¼Î± Î¬Î´ÎµÎ¹Î±Ï‚!');
                } else {
                    console.log(`ğŸ”” ${newRequestsFound} Î½Î­Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î¬Î´ÎµÎ¹Î±Ï‚!`);
                    showNotificationMessage(`${newRequestsFound} Î½Î­Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î¬Î´ÎµÎ¹Î±Ï‚!`);
                }
                
                // ÎšÎ¬Î½Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î½Î± Î±Î½Î±Î²Î¿ÏƒÎ²Î®Î½ÎµÎ¹
                blinkManagerButton();
            }
            
            lastRequestCount = currentCount;
            isFirstCheck = false;
            
        })
        .catch(error => {
            console.error('Error checking for new requests:', error);
        });
}

function playNotificationSound() {
    try {
        // Î ÏÏÏ„Î± Î´Î¿ÎºÎ¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ Î½Î± Ï€Î±Î¯Î¾Î¿Ï…Î¼Îµ Î®Ï‡Î¿ Î¼Îµ AudioContext
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÏÎ¿ beeps
        function createBeep(frequency, startTime, duration) {
            var oscillator = audioContext.createOscillator();
            var gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, startTime);
            gainNode.gain.setValueAtTime(0.3, startTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + duration);
        }
        
        // Î Î±Î¯Î¶Î¿Ï…Î¼Îµ 2 beeps
        createBeep(800, audioContext.currentTime, 0.2);
        createBeep(1000, audioContext.currentTime + 0.3, 0.2);
        
        console.log('ğŸ”Š Î‰Ï‡Î¿Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï€Î±Î¯Ï‡Ï„Î·ÎºÎµ');
        
    } catch (e) {
        console.log('Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎµ Î½Î± Ï€Î±Î¯Î¾ÎµÎ¹ Î¿ Î®Ï‡Î¿Ï‚ AudioContext:', e);
        
        // Fallback - Î´Î¿ÎºÎ¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ alert
        try {
            // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ Î±Ï€Î»Î¿Ï beep Î¼Îµ Ï„Î¿Î½ Ï€Î±Î»Î¹ÏŒ Ï„ÏÏŒÏ€Î¿
            var audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmOPF');
            audio.play().catch(() => {
                console.log('ÎšÎ±Î¹ Ï„Î¿ audio fallback Î±Ï€Î­Ï„Ï…Ï‡Îµ');
            });
        } catch (audioError) {
            console.log('Fallback audio error:', audioError);
        }
    }
}

function showNotificationMessage(message) {
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Ï notification div
    var notification = document.createElement('div');
    notification.innerHTML = `ğŸ”” ${message}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        font-weight: bold;
        animation: slideIn 0.3s ease-out;
    `;
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· animation CSS
    if (!document.getElementById('notification-styles')) {
        var style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
    
    document.body.appendChild(notification);
    
    // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 4 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 4000);
}

function blinkManagerButton() {
    var managerButton = document.querySelector('a[href="manager-popup.php"]');
    if (managerButton) {
        let blinkCount = 0;
        var blinkInterval = setInterval(() => {
            managerButton.style.backgroundColor = blinkCount % 2 === 0 ? '#dc3545' : '#28a745';
            blinkCount++;
            if (blinkCount >= 6) { // 3 Ï€Î»Î®ÏÎ· blinks
                clearInterval(blinkInterval);
                managerButton.style.backgroundColor = '#28a745'; // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ Ï‡ÏÏÎ¼Î±
            }
        }, 300);
    }
}

function updateManagerButtonText(count) {
    var managerButton = document.querySelector('a[href="manager-popup.php"]');
    if (managerButton) {
        if (count > 0) {
            managerButton.innerHTML = `ğŸ”” Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ (${count})`;
            managerButton.style.backgroundColor = '#dc3545'; // ÎšÏŒÎºÎºÎ¹Î½Î¿ ÏŒÏ„Î±Î½ Î­Ï‡ÎµÎ¹ ÎµÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚
        } else {
            managerButton.innerHTML = 'ğŸ”” Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ (0)';
            managerButton.style.backgroundColor = '#28a745'; // Î ÏÎ¬ÏƒÎ¹Î½Î¿ ÏŒÏ„Î±Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹
        }
    }
}

// ÎœÏŒÎ½Î¿ Î³Î¹Î± managers
<?php if (isset($_SESSION['is_manager']) && $_SESSION['is_manager']): ?>
// ÎÎµÎºÎ¹Î½Î¬ÎµÎ¹ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ ÎºÎ¬Î¸Îµ 20 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
setInterval(checkNewRequests, 20000);

// Î ÏÏÏ„Î¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 3 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
setTimeout(checkNewRequests, 3000);

console.log('ğŸ”” Î£ÏÏƒÏ„Î·Î¼Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± managers ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿!');
<?php endif; ?>
</script>

<?php if (isset($play_sound_after_submit) && $play_sound_after_submit && isset($_SESSION['is_manager']) && $_SESSION['is_manager']): ?>
<script>
// Î Î±Î¯Î¾Îµ Î®Ï‡Î¿ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î® Î±Î¯Ï„Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿
setTimeout(function() {
    playNotificationSound();
    showNotificationMessage('Î— Î±Î¯Ï„Î·ÏƒÎ® ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ ÎºÎ±Î¹ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¹Ï‚ ÎµÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚!');
}, 500);
</script>
<?php endif; ?>

<?php if (isset($_SESSION['is_admin']) && $_SESSION['is_admin']): ?>
<script>
// ÎÎ•ÎŸ: Delete Test Data Functions (ÎœÎŸÎÎŸ ADMIN)
function deleteTestRequests() {
    if (!confirm('âš ï¸ Î Î¡ÎŸÎ£ÎŸÎ§Î—: Î˜Î± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ ÎŸÎ›Î•Î£ Î¿Î¹ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ·!\n\nÎ‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¹ÏÎµÎ¸ÎµÎ¯!\n\nÎ•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹;')) {
        return;
    }
    
    var statusDiv = document.getElementById('delete-status');
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = '<div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px;">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½...</div>';
    
    fetch('', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'ajax_action=delete_test_requests'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = '<div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; font-weight: bold;">âœ… ' + data.message + '</div>';
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            statusDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; font-weight: bold;">âŒ Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±') + '</div>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        statusDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; font-weight: bold;">âŒ Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…</div>';
    });
}

function deleteTestBalances() {
    if (!confirm('âš ï¸ Î Î¡ÎŸÎ£ÎŸÎ§Î—: Î˜Î± ÎµÏ€Î±Î½Î±Ï†ÎµÏÎ¸Î¿ÏÎ½ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚!\n\nÎ‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î¸Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½ÎµÏ‚ Î±Î»Î»Î±Î³Î­Ï‚!\n\nÎ•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹;')) {
        return;
    }
    
    var statusDiv = document.getElementById('delete-status');
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = '<div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px;">ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½...</div>';
    
    fetch('', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'ajax_action=reset_test_balances'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = '<div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; font-weight: bold;">âœ… ' + data.message + '</div>';
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            statusDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; font-weight: bold;">âŒ Î£Ï†Î¬Î»Î¼Î±: ' + (data.message || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ ÏƒÏ†Î¬Î»Î¼Î±') + '</div>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        statusDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; font-weight: bold;">âŒ Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…</div>';
    });
}
</script>
<?php endif; ?>

<!-- Manager Check Button - Î”ÎµÎ½ Ï‡Î±Î»Î¬ÎµÎ¹ Ï„Î¹Ï‚ ÎºÎ±ÏÏ„Î­Î»ÎµÏ‚ -->
<?php if (isset($_SESSION['is_manager']) && $_SESSION['is_manager']): ?>
<div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    <a href="manager-popup.php" target="_blank" 
       style="background: #28a745; color: white; border: none; padding: 12px 16px; 
              border-radius: 25px; text-decoration: none; box-shadow: 0 3px 8px rgba(0,0,0,0.3);
              display: inline-block; font-weight: bold;">
        ğŸ”” Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÎ¹Ï‚
    </a>
</div>
<?php endif; ?>

<!-- ÎÎ•Î‘: ÎšÎ±ÏÏ„Î­Î»Î± Upload Excel -->
<?php if ((isset($_SESSION['is_admin']) && $_SESSION['is_admin']) || (isset($_SESSION['is_gdye']) && $_SESSION['is_gdye'])): ?>
<div id="excel-upload-tab" class="tab-content">
    <h2>ğŸ“Š Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î‘Î´ÎµÎ¹ÏÎ½ Î±Ï€ÏŒ Excel</h2>
    <p style="color: #666; margin-bottom: 20px;">
        <strong>Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±:</strong> <?php echo $_SESSION['is_admin'] ? 'Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚' : 'Î“Î”Î¥Î•'; ?> | 
        <strong>Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±:</strong> Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½ Î±Ï€ÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ Excel
    </p>
    
    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #ffc107;">
        <h4 style="color: #856404; margin-bottom: 15px;">ğŸ“‹ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î§ÏÎ®ÏƒÎ·Ï‚</h4>
        <ul style="color: #856404; margin-left: 20px; line-height: 1.6;">
            <li><strong>ÎœÎ¿ÏÏ†Î® Excel:</strong> Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î· Î´Î¿Î¼Î®: ÎœÎ·Ï„ÏÏÎ¿, Î•Ï€ÏÎ½Ï…Î¼Î¿, ÎŒÎ½Î¿Î¼Î±, ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®, Î’ÏÎ±Ï‡ÎµÎ¯Î±</li>
            <li><strong>Î£Ï„Î®Î»ÎµÏ‚:</strong> "X ÎºÎ±Î¹ Y Î¼Î­ÏÎµÏ‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚" Î³Î¹Î± ÎºÎ¬Î¸Îµ Ï„ÏÏ€Î¿ Î¬Î´ÎµÎ¹Î±Ï‚</li>
            <li><strong>Î›Î¿Î³Î¹ÎºÎ®:</strong> Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î¸Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î¹Ï‚ Î·Î¼Î­ÏÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Ï€Î¬ÏÎµÎ¹ Î±Ï€ÏŒ Ï„Î± Î±ÏÏ‡Î¹ÎºÎ¬ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±</li>
            <li><strong>Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±:</strong> Î Î±Î¯ÏÎ½ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± backup Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</li>
        </ul>
    </div>
    
    <div style="background: white; padding: 25px; border-radius: 10px; border: 2px dashed #ddd;">
        <form id="excel-upload-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="excel-file" style="font-size: 18px; font-weight: bold; color: #333;">
                    ğŸ“ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ Excel (.xls Î® .xlsx)
                </label>
                <input type="file" id="excel-file" name="excel_file" accept=".xls,.xlsx" required
                       style="width: 100%; padding: 15px; border: 2px solid #007bff; border-radius: 8px; font-size: 16px;">
                <small style="color: #666; margin-top: 10px; display: block;">
                    Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±ÏÏ‡ÎµÎ¯Î± .xls ÎºÎ±Î¹ .xlsx Î¼Î­Ï‡ÏÎ¹ 10MB
                </small>
            </div>
            
            <div style="margin: 20px 0;">
                <label>
                    <input type="checkbox" id="backup-confirm" required style="margin-right: 10px;">
                    <strong>Î£Ï…Î¼Ï†Ï‰Î½Ï Î½Î± Î³Î¯Î½ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± backup Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</strong>
                </label>
            </div>
            
            <div style="margin: 20px 0;">
                <label>
                    <input type="checkbox" id="preview-confirm" required style="margin-right: 10px;">
                    <strong>Î˜Î­Î»Ï‰ Î½Î± Î´Ï‰ Ï€ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Ï„Ï‰Î½ Î±Î»Î»Î±Î³ÏÎ½ Ï€ÏÎ¹Î½ Ï„Î·Î½ Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ® ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</strong>
                </label>
            </div>
            
            <div style="text-align: center;">
                <button type="button" onclick="uploadAndProcessExcel()" class="btn" 
                        style="font-size: 18px; padding: 15px 30px; background: linear-gradient(135deg, #28a745, #20c997);">
                    ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ· Excel ÎºÎ±Î¹ Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ·
                </button>
            </div>
        </form>
        
        <div id="upload-progress" style="display: none; margin-top: 20px;">
            <div style="background: #e9ecef; border-radius: 8px; padding: 10px;">
                <div style="background: #007bff; height: 20px; border-radius: 6px; width: 0%; transition: width 0.3s;" id="progress-bar"></div>
            </div>
            <p id="progress-text" style="text-align: center; margin-top: 10px;">Î‘Î½Î±Î»ÏÏ‰ Î±ÏÏ‡ÎµÎ¯Î¿...</p>
        </div>
        
        <div id="excel-preview" style="display: none; margin-top: 25px;">
            <!-- Î•Î´Ï Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Î· Ï€ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· -->
        </div>
    </div>
</div>
<?php endif; ?>

<?php if (isset($_SESSION['is_gdye']) && $_SESSION['is_gdye']): ?>
<script>
	function printLeaveRequest(requestId, employeeName, leaveType, startDate, days, reason, location, hours, oraStart, oraEnd) {
		var printWindow = window.open('', '_blank');
    
    if (!printWindow) {
        alert('Î‘Î´Ï…Î½Î±Î¼Î¯Î± Î±Î½Î¿Î¯Î³Î¼Î±Ï„Î¿Ï‚ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï… ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Ï„Î± pop-ups.');
        return;
    }
    
    var formattedDate = new Date(startDate).toLocaleDateString('el-GR');
    var printDate = new Date().toLocaleDateString('el-GR');
    
    printWindow.document.write(`
        <html>
        <head>
            <title>Î†Î´ÎµÎ¹Î± - ${employeeName}</title>
            <style>
                @page { size: A4; margin: 2cm; }
                body { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.5; margin: 0; padding: 20px; }
                .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 25px; }
                .header h1 { font-size: 16pt; margin: 10px 0; text-decoration: underline; }
                .form-section { margin: 20px 0; padding: 15px; border: 1px solid #000; }
                .form-field { margin: 8px 0; padding: 5px 0; }
                .signature-area { margin-top: 50px; text-align: center; }
                .signature-line { margin-top: 80px; border-top: 1px solid #000; width: 200px; margin: 0 auto; padding-top: 5px; }
                .approval-section { margin: 30px 0; padding: 20px; border: 2px solid #000; background: #f9f9f9; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>Î‘Î™Î¤Î—Î£Î— Î‘Î”Î•Î™Î‘Î£ - ${leaveType}</h1>
                <div style="text-align: right; font-size: 11pt;">Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚, ${printDate}</div>
            </div>
            
            <div class="form-section">
                <div class="form-field"><strong>ÎœÎ·Ï„ÏÏÎ¿:</strong> ${mitroo}</div>
                 <div class="form-field"><strong>Î’Î±Î¸Î¼ÏŒÏ‚:</strong> ${bathmos}</div>
                 <div class="form-field"><strong>Î•Ï€ÏÎ½Ï…Î¼Î¿:</strong> ${employeeName.split(' ').pop()}</div>
                 <div class="form-field"><strong>ÎŒÎ½Î¿Î¼Î±:</strong> ${employeeName.split(' ').slice(0, -1).join(' ')}</div>
                 <div class="form-field"><strong>Î¥Ï€Î·ÏÎµÏƒÎ¯Î±:</strong> Î”/Î½ÏƒÎ· Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¯Î±Ï‚ Î›Î±ÏƒÎ¹Î¸Î¯Î¿Ï…</div>
            </div>
            
            <div class="form-section">
  <div class="form-field"><strong>Î¤ÏÏ€Î¿Ï‚ Î†Î´ÎµÎ¹Î±Ï‚:</strong> ${leaveType}</div>
  <div class="form-field"><strong>Î”Î¹Î¬ÏÎºÎµÎ¹Î±:</strong> ${
     (leaveType === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' && Number(hours) > 0)
       ? (hours + ' ' + (Number(hours) === 1 ? 'ÏÏÎ±' : 'ÏÏÎµÏ‚'))
       : (days + ' ' + (Number(days) === 1 ? 'Î·Î¼Î­ÏÎ±' : 'Î·Î¼Î­ÏÎµÏ‚'))
   }</div>
  ${leaveType === 'ÎŸÎ›Î™Î“ÎŸÎ©Î¡Î—' ? `
    <div class="form-field"><strong>ÎÏÎµÏ‚:</strong> Î±Ï€ÏŒ ${oraStart || 'â€”'} Î­Ï‰Ï‚ ${oraEnd || 'â€”'}</div>
  ` : ''}
  <div class="form-field"><strong>ÎˆÎ½Î±ÏÎ¾Î· Î¬Î´ÎµÎ¹Î±Ï‚:</strong> ${formattedDate}</div>
  <div class="form-field"><strong>Î¤ÏŒÏ€Î¿Ï‚ Î´Î¹Î¬Î½Ï…ÏƒÎ·Ï‚:</strong> ${location || 'Î”ÎµÎ½ Î±Î½Î±Ï†Î­ÏÎ¸Î·ÎºÎµ'}</div>
  <div class="form-field"><strong>Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±:</strong> ${reason}</div>
</div>
            
            <div class="approval-section">
                <h3 style="text-align: center; margin-bottom: 20px;">Î•Î“ÎšÎ¡Î™Î£Î•Î™Î£</h3>
                <div style="margin: 15px 0;"><strong>âœ… Î•Î“ÎšÎ¡Î™Î˜Î—ÎšÎ• Î±Ï€ÏŒ Ï„Î¿Î½ Î ÏÎ¿ÏŠÏƒÏ„Î¬Î¼ÎµÎ½Î¿</strong></div>
                <div style="margin-top: 20px;"><strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎˆÎ³ÎºÏÎ¹ÏƒÎ·Ï‚:</strong> ${printDate}</div>
            </div>
            
            <div class="signature-area">
                <div style="margin-top: 60px;"><strong>ÎŸ/Î— Î•Î½Î´Î¹Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½Î¿Ï‚/Î·</strong></div>
                <div class="signature-line">${employeeName}</div>
            </div>
            
            <div style="position: fixed; bottom: 10px; right: 10px; font-size: 8pt; color: #666;">
                Î“Î”Î¥Î• - ${printDate} - Î‘Î¯Ï„Î·ÏƒÎ· #${requestId}
            </div>
        </body>
        </html>
    `);
    
    printWindow.document.close();
    
    setTimeout(() => {
        printWindow.print();
        printWindow.close();
    }, 1000);
}
</script>
<?php endif; ?>
<script>
function openTab(evt, tabName) {
  try {
    if (evt) evt.preventDefault();
    
    // ÎšÏÏÏˆÎµ ÏŒÎ»Î± Ï„Î± tabs
    var tabs = document.getElementsByClassName("tab-content");
    for (var i = 0; i < tabs.length; i++) {
      tabs[i].classList.remove("active");
    }
    
    // Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ ÏŒÎ»Î± Ï„Î± buttons
    var buttons = document.getElementsByClassName("tab-button");
    for (var j = 0; j < buttons.length; j++) {
      buttons[j].classList.remove("active");
    }
    
    // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î¿ tab
    var target = document.getElementById(tabName);
    if (target) target.classList.add("active");
    
    // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ button
    if (evt && evt.currentTarget) {
      evt.currentTarget.classList.add("active");
    }
    
    return false;
  } catch (e) {
    console.error('openTab error:', e);
    return false;
  }
}
</script>
<script>
console.log('ğŸ” Searching for printLeaveRequest function...');
if (typeof printLeaveRequest === 'function') {
    console.log('âœ… printLeaveRequest function EXISTS');
} else {
    console.log('âŒ printLeaveRequest function NOT FOUND');
}

// Î’ÏÎµÏ‚ ÏŒÎ»Î± Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Ï€Î¿Ï… ÎºÎ±Î»Î¿ÏÎ½ Ï„Î·Î½ function
var buttons = document.querySelectorAll('button[onclick*="printLeaveRequest"]');
console.log('ğŸ” Found', buttons.length, 'print buttons');
buttons.forEach((btn, index) => {
    console.log('Button', index + 1, ':', btn.onclick.toString());
});
</script>
</body>
</html>
